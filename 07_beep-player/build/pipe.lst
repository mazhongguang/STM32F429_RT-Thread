ARM GAS  /tmp/ccD7W85H.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"pipe.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.rt_pipe_control,"ax",%progbits
  18              		.align	1
  19              		.global	rt_pipe_control
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  23              		.fpu fpv4-sp-d16
  25              	rt_pipe_control:
  26              	.LFB23:
  27              		.file 1 "rt-thread/components/drivers/src/pipe.c"
   1:rt-thread/components/drivers/src/pipe.c **** /*
   2:rt-thread/components/drivers/src/pipe.c ****  * Copyright (c) 2006-2018, RT-Thread Development Team
   3:rt-thread/components/drivers/src/pipe.c ****  *
   4:rt-thread/components/drivers/src/pipe.c ****  * SPDX-License-Identifier: Apache-2.0
   5:rt-thread/components/drivers/src/pipe.c ****  *
   6:rt-thread/components/drivers/src/pipe.c ****  * Change Logs:
   7:rt-thread/components/drivers/src/pipe.c ****  * Date           Author       Notes
   8:rt-thread/components/drivers/src/pipe.c ****  * 2012-09-30     Bernard      first version.
   9:rt-thread/components/drivers/src/pipe.c ****  * 2017-11-08     JasonJiaJie  fix memory leak issue when close a pipe.
  10:rt-thread/components/drivers/src/pipe.c ****  */
  11:rt-thread/components/drivers/src/pipe.c **** #include <rthw.h>
  12:rt-thread/components/drivers/src/pipe.c **** #include <rtdevice.h>
  13:rt-thread/components/drivers/src/pipe.c **** #include <stdint.h>
  14:rt-thread/components/drivers/src/pipe.c **** 
  15:rt-thread/components/drivers/src/pipe.c **** #if defined(RT_USING_POSIX)
  16:rt-thread/components/drivers/src/pipe.c **** #include <dfs_file.h>
  17:rt-thread/components/drivers/src/pipe.c **** #include <dfs_posix.h>
  18:rt-thread/components/drivers/src/pipe.c **** #include <dfs_poll.h>
  19:rt-thread/components/drivers/src/pipe.c **** 
  20:rt-thread/components/drivers/src/pipe.c **** static int pipe_fops_open(struct dfs_fd *fd)
  21:rt-thread/components/drivers/src/pipe.c **** {
  22:rt-thread/components/drivers/src/pipe.c ****     int rc = 0;
  23:rt-thread/components/drivers/src/pipe.c ****     rt_device_t device;
  24:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
  25:rt-thread/components/drivers/src/pipe.c **** 
  26:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)fd->data;
  27:rt-thread/components/drivers/src/pipe.c ****     if (!pipe) return -1;
  28:rt-thread/components/drivers/src/pipe.c **** 
  29:rt-thread/components/drivers/src/pipe.c ****     device = &(pipe->parent);
  30:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
  31:rt-thread/components/drivers/src/pipe.c **** 
ARM GAS  /tmp/ccD7W85H.s 			page 2


  32:rt-thread/components/drivers/src/pipe.c ****     if (device->ref_count == 0)
  33:rt-thread/components/drivers/src/pipe.c ****     {
  34:rt-thread/components/drivers/src/pipe.c ****         pipe->fifo = rt_ringbuffer_create(pipe->bufsz);
  35:rt-thread/components/drivers/src/pipe.c ****         if (pipe->fifo == RT_NULL)
  36:rt-thread/components/drivers/src/pipe.c ****         {
  37:rt-thread/components/drivers/src/pipe.c ****             rc = -RT_ENOMEM;
  38:rt-thread/components/drivers/src/pipe.c ****             goto __exit;
  39:rt-thread/components/drivers/src/pipe.c ****         }
  40:rt-thread/components/drivers/src/pipe.c ****     }
  41:rt-thread/components/drivers/src/pipe.c **** 
  42:rt-thread/components/drivers/src/pipe.c ****     switch (fd->flags & O_ACCMODE)
  43:rt-thread/components/drivers/src/pipe.c ****     {
  44:rt-thread/components/drivers/src/pipe.c ****     case O_RDONLY:
  45:rt-thread/components/drivers/src/pipe.c ****         pipe->readers ++;
  46:rt-thread/components/drivers/src/pipe.c ****         break;
  47:rt-thread/components/drivers/src/pipe.c ****     case O_WRONLY:
  48:rt-thread/components/drivers/src/pipe.c ****         pipe->writers ++;
  49:rt-thread/components/drivers/src/pipe.c ****         break;
  50:rt-thread/components/drivers/src/pipe.c ****     case O_RDWR:
  51:rt-thread/components/drivers/src/pipe.c ****         pipe->readers ++;
  52:rt-thread/components/drivers/src/pipe.c ****         pipe->writers ++;
  53:rt-thread/components/drivers/src/pipe.c ****         break;
  54:rt-thread/components/drivers/src/pipe.c ****     }
  55:rt-thread/components/drivers/src/pipe.c ****     device->ref_count ++;
  56:rt-thread/components/drivers/src/pipe.c **** 
  57:rt-thread/components/drivers/src/pipe.c **** __exit:
  58:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&(pipe->lock));
  59:rt-thread/components/drivers/src/pipe.c **** 
  60:rt-thread/components/drivers/src/pipe.c ****     return rc;
  61:rt-thread/components/drivers/src/pipe.c **** }
  62:rt-thread/components/drivers/src/pipe.c **** 
  63:rt-thread/components/drivers/src/pipe.c **** static int pipe_fops_close(struct dfs_fd *fd)
  64:rt-thread/components/drivers/src/pipe.c **** {
  65:rt-thread/components/drivers/src/pipe.c ****     rt_device_t device;
  66:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
  67:rt-thread/components/drivers/src/pipe.c **** 
  68:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)fd->data;
  69:rt-thread/components/drivers/src/pipe.c ****     if (!pipe) return -1;
  70:rt-thread/components/drivers/src/pipe.c **** 
  71:rt-thread/components/drivers/src/pipe.c ****     device = &(pipe->parent);
  72:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
  73:rt-thread/components/drivers/src/pipe.c **** 
  74:rt-thread/components/drivers/src/pipe.c ****     switch (fd->flags & O_ACCMODE)
  75:rt-thread/components/drivers/src/pipe.c ****     {
  76:rt-thread/components/drivers/src/pipe.c ****     case O_RDONLY:
  77:rt-thread/components/drivers/src/pipe.c ****         pipe->readers --;
  78:rt-thread/components/drivers/src/pipe.c ****         break;
  79:rt-thread/components/drivers/src/pipe.c ****     case O_WRONLY:
  80:rt-thread/components/drivers/src/pipe.c ****         pipe->writers --;
  81:rt-thread/components/drivers/src/pipe.c ****         break;
  82:rt-thread/components/drivers/src/pipe.c ****     case O_RDWR:
  83:rt-thread/components/drivers/src/pipe.c ****         pipe->readers --;
  84:rt-thread/components/drivers/src/pipe.c ****         pipe->writers --;
  85:rt-thread/components/drivers/src/pipe.c ****         break;
  86:rt-thread/components/drivers/src/pipe.c ****     }
  87:rt-thread/components/drivers/src/pipe.c **** 
  88:rt-thread/components/drivers/src/pipe.c ****     if (pipe->writers == 0)
ARM GAS  /tmp/ccD7W85H.s 			page 3


  89:rt-thread/components/drivers/src/pipe.c ****     {
  90:rt-thread/components/drivers/src/pipe.c ****         rt_wqueue_wakeup(&(pipe->reader_queue), (void*)(POLLIN | POLLERR | POLLHUP));
  91:rt-thread/components/drivers/src/pipe.c ****     }
  92:rt-thread/components/drivers/src/pipe.c **** 
  93:rt-thread/components/drivers/src/pipe.c ****     if (pipe->readers == 0)
  94:rt-thread/components/drivers/src/pipe.c ****     {
  95:rt-thread/components/drivers/src/pipe.c ****         rt_wqueue_wakeup(&(pipe->writer_queue), (void*)(POLLOUT | POLLERR | POLLHUP));
  96:rt-thread/components/drivers/src/pipe.c ****     }
  97:rt-thread/components/drivers/src/pipe.c **** 
  98:rt-thread/components/drivers/src/pipe.c ****     if (device->ref_count == 1)
  99:rt-thread/components/drivers/src/pipe.c ****     {
 100:rt-thread/components/drivers/src/pipe.c ****         if (pipe->fifo != RT_NULL)
 101:rt-thread/components/drivers/src/pipe.c ****             rt_ringbuffer_destroy(pipe->fifo);
 102:rt-thread/components/drivers/src/pipe.c ****         pipe->fifo = RT_NULL;
 103:rt-thread/components/drivers/src/pipe.c ****     }
 104:rt-thread/components/drivers/src/pipe.c ****     device->ref_count --;
 105:rt-thread/components/drivers/src/pipe.c **** 
 106:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&(pipe->lock));
 107:rt-thread/components/drivers/src/pipe.c **** 
 108:rt-thread/components/drivers/src/pipe.c ****     if (device->ref_count == 0 && pipe->is_named == RT_FALSE)
 109:rt-thread/components/drivers/src/pipe.c ****     {
 110:rt-thread/components/drivers/src/pipe.c ****         /* delete the unamed pipe */
 111:rt-thread/components/drivers/src/pipe.c ****         rt_pipe_delete(device->parent.name);
 112:rt-thread/components/drivers/src/pipe.c ****     }
 113:rt-thread/components/drivers/src/pipe.c **** 
 114:rt-thread/components/drivers/src/pipe.c ****     return 0;
 115:rt-thread/components/drivers/src/pipe.c **** }
 116:rt-thread/components/drivers/src/pipe.c **** 
 117:rt-thread/components/drivers/src/pipe.c **** static int pipe_fops_ioctl(struct dfs_fd *fd, int cmd, void *args)
 118:rt-thread/components/drivers/src/pipe.c **** {
 119:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
 120:rt-thread/components/drivers/src/pipe.c ****     int ret = 0;
 121:rt-thread/components/drivers/src/pipe.c **** 
 122:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)fd->data;
 123:rt-thread/components/drivers/src/pipe.c **** 
 124:rt-thread/components/drivers/src/pipe.c ****     switch (cmd)
 125:rt-thread/components/drivers/src/pipe.c ****     {
 126:rt-thread/components/drivers/src/pipe.c ****     case FIONREAD:
 127:rt-thread/components/drivers/src/pipe.c ****         *((int*)args) = rt_ringbuffer_data_len(pipe->fifo);
 128:rt-thread/components/drivers/src/pipe.c ****         break;
 129:rt-thread/components/drivers/src/pipe.c ****     case FIONWRITE:
 130:rt-thread/components/drivers/src/pipe.c ****         *((int*)args) = rt_ringbuffer_space_len(pipe->fifo);
 131:rt-thread/components/drivers/src/pipe.c ****         break;
 132:rt-thread/components/drivers/src/pipe.c ****     default:
 133:rt-thread/components/drivers/src/pipe.c ****         ret = -EINVAL;
 134:rt-thread/components/drivers/src/pipe.c ****         break;
 135:rt-thread/components/drivers/src/pipe.c ****     }
 136:rt-thread/components/drivers/src/pipe.c **** 
 137:rt-thread/components/drivers/src/pipe.c ****     return ret;
 138:rt-thread/components/drivers/src/pipe.c **** }
 139:rt-thread/components/drivers/src/pipe.c **** 
 140:rt-thread/components/drivers/src/pipe.c **** static int pipe_fops_read(struct dfs_fd *fd, void *buf, size_t count)
 141:rt-thread/components/drivers/src/pipe.c **** {
 142:rt-thread/components/drivers/src/pipe.c ****     int len = 0;
 143:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
 144:rt-thread/components/drivers/src/pipe.c **** 
 145:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)fd->data;
ARM GAS  /tmp/ccD7W85H.s 			page 4


 146:rt-thread/components/drivers/src/pipe.c **** 
 147:rt-thread/components/drivers/src/pipe.c ****     /* no process has the pipe open for writing, return end-of-file */
 148:rt-thread/components/drivers/src/pipe.c ****     if (pipe->writers == 0)
 149:rt-thread/components/drivers/src/pipe.c ****         return 0;
 150:rt-thread/components/drivers/src/pipe.c **** 
 151:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 152:rt-thread/components/drivers/src/pipe.c **** 
 153:rt-thread/components/drivers/src/pipe.c ****     while (1)
 154:rt-thread/components/drivers/src/pipe.c ****     {
 155:rt-thread/components/drivers/src/pipe.c ****         if (pipe->writers == 0)
 156:rt-thread/components/drivers/src/pipe.c ****         {
 157:rt-thread/components/drivers/src/pipe.c ****             goto out;
 158:rt-thread/components/drivers/src/pipe.c ****         }
 159:rt-thread/components/drivers/src/pipe.c **** 
 160:rt-thread/components/drivers/src/pipe.c ****         len = rt_ringbuffer_get(pipe->fifo, buf, count);
 161:rt-thread/components/drivers/src/pipe.c **** 
 162:rt-thread/components/drivers/src/pipe.c ****         if (len > 0)
 163:rt-thread/components/drivers/src/pipe.c ****         {
 164:rt-thread/components/drivers/src/pipe.c ****             break;
 165:rt-thread/components/drivers/src/pipe.c ****         }
 166:rt-thread/components/drivers/src/pipe.c ****         else
 167:rt-thread/components/drivers/src/pipe.c ****         {
 168:rt-thread/components/drivers/src/pipe.c ****             if (fd->flags & O_NONBLOCK)
 169:rt-thread/components/drivers/src/pipe.c ****             {
 170:rt-thread/components/drivers/src/pipe.c ****                 len = -EAGAIN;
 171:rt-thread/components/drivers/src/pipe.c ****                 goto out;
 172:rt-thread/components/drivers/src/pipe.c ****             }
 173:rt-thread/components/drivers/src/pipe.c **** 
 174:rt-thread/components/drivers/src/pipe.c ****             rt_mutex_release(&pipe->lock);
 175:rt-thread/components/drivers/src/pipe.c ****             rt_wqueue_wakeup(&(pipe->writer_queue), (void*)POLLOUT);
 176:rt-thread/components/drivers/src/pipe.c ****             rt_wqueue_wait(&(pipe->reader_queue), 0, -1);
 177:rt-thread/components/drivers/src/pipe.c ****             rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 178:rt-thread/components/drivers/src/pipe.c ****         }
 179:rt-thread/components/drivers/src/pipe.c ****     }
 180:rt-thread/components/drivers/src/pipe.c **** 
 181:rt-thread/components/drivers/src/pipe.c ****     /* wakeup writer */
 182:rt-thread/components/drivers/src/pipe.c ****     rt_wqueue_wakeup(&(pipe->writer_queue), (void*)POLLOUT);
 183:rt-thread/components/drivers/src/pipe.c **** 
 184:rt-thread/components/drivers/src/pipe.c **** out:
 185:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&pipe->lock);
 186:rt-thread/components/drivers/src/pipe.c ****     return len;
 187:rt-thread/components/drivers/src/pipe.c **** }
 188:rt-thread/components/drivers/src/pipe.c **** 
 189:rt-thread/components/drivers/src/pipe.c **** static int pipe_fops_write(struct dfs_fd *fd, const void *buf, size_t count)
 190:rt-thread/components/drivers/src/pipe.c **** {
 191:rt-thread/components/drivers/src/pipe.c ****     int len;
 192:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
 193:rt-thread/components/drivers/src/pipe.c ****     int wakeup = 0;
 194:rt-thread/components/drivers/src/pipe.c ****     int ret = 0;
 195:rt-thread/components/drivers/src/pipe.c ****     uint8_t *pbuf;
 196:rt-thread/components/drivers/src/pipe.c **** 
 197:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)fd->data;
 198:rt-thread/components/drivers/src/pipe.c **** 
 199:rt-thread/components/drivers/src/pipe.c ****     if (pipe->readers == 0)
 200:rt-thread/components/drivers/src/pipe.c ****     {
 201:rt-thread/components/drivers/src/pipe.c ****         ret = -EPIPE;
 202:rt-thread/components/drivers/src/pipe.c ****         goto out;
ARM GAS  /tmp/ccD7W85H.s 			page 5


 203:rt-thread/components/drivers/src/pipe.c ****     }
 204:rt-thread/components/drivers/src/pipe.c **** 
 205:rt-thread/components/drivers/src/pipe.c ****     if (count == 0)
 206:rt-thread/components/drivers/src/pipe.c ****         return 0;
 207:rt-thread/components/drivers/src/pipe.c **** 
 208:rt-thread/components/drivers/src/pipe.c ****     pbuf = (uint8_t*)buf;
 209:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&pipe->lock, -1);
 210:rt-thread/components/drivers/src/pipe.c **** 
 211:rt-thread/components/drivers/src/pipe.c ****     while (1)
 212:rt-thread/components/drivers/src/pipe.c ****     {
 213:rt-thread/components/drivers/src/pipe.c ****         if (pipe->readers == 0)
 214:rt-thread/components/drivers/src/pipe.c ****         {
 215:rt-thread/components/drivers/src/pipe.c ****             if (ret == 0)
 216:rt-thread/components/drivers/src/pipe.c ****                 ret = -EPIPE;
 217:rt-thread/components/drivers/src/pipe.c ****             break;
 218:rt-thread/components/drivers/src/pipe.c ****         }
 219:rt-thread/components/drivers/src/pipe.c **** 
 220:rt-thread/components/drivers/src/pipe.c ****         len = rt_ringbuffer_put(pipe->fifo, pbuf, count - ret);
 221:rt-thread/components/drivers/src/pipe.c ****         ret +=  len;
 222:rt-thread/components/drivers/src/pipe.c ****         pbuf += len;
 223:rt-thread/components/drivers/src/pipe.c ****         wakeup = 1;
 224:rt-thread/components/drivers/src/pipe.c **** 
 225:rt-thread/components/drivers/src/pipe.c ****         if (ret == count)
 226:rt-thread/components/drivers/src/pipe.c ****         {
 227:rt-thread/components/drivers/src/pipe.c ****             break;
 228:rt-thread/components/drivers/src/pipe.c ****         }
 229:rt-thread/components/drivers/src/pipe.c ****         else
 230:rt-thread/components/drivers/src/pipe.c ****         {
 231:rt-thread/components/drivers/src/pipe.c ****             if (fd->flags & O_NONBLOCK)
 232:rt-thread/components/drivers/src/pipe.c ****             {
 233:rt-thread/components/drivers/src/pipe.c ****                 if (ret == 0)
 234:rt-thread/components/drivers/src/pipe.c ****                 {
 235:rt-thread/components/drivers/src/pipe.c ****                     ret = -EAGAIN;
 236:rt-thread/components/drivers/src/pipe.c ****                 }
 237:rt-thread/components/drivers/src/pipe.c **** 
 238:rt-thread/components/drivers/src/pipe.c ****                 break;
 239:rt-thread/components/drivers/src/pipe.c ****             }
 240:rt-thread/components/drivers/src/pipe.c ****         }
 241:rt-thread/components/drivers/src/pipe.c **** 
 242:rt-thread/components/drivers/src/pipe.c ****         rt_mutex_release(&pipe->lock);
 243:rt-thread/components/drivers/src/pipe.c ****         rt_wqueue_wakeup(&(pipe->reader_queue), (void*)POLLIN);
 244:rt-thread/components/drivers/src/pipe.c ****         /* pipe full, waiting on suspended write list */
 245:rt-thread/components/drivers/src/pipe.c ****         rt_wqueue_wait(&(pipe->writer_queue), 0, -1);
 246:rt-thread/components/drivers/src/pipe.c ****         rt_mutex_take(&pipe->lock, -1);
 247:rt-thread/components/drivers/src/pipe.c ****     }
 248:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&pipe->lock);
 249:rt-thread/components/drivers/src/pipe.c **** 
 250:rt-thread/components/drivers/src/pipe.c ****     if (wakeup)
 251:rt-thread/components/drivers/src/pipe.c ****     {
 252:rt-thread/components/drivers/src/pipe.c ****         rt_wqueue_wakeup(&(pipe->reader_queue), (void*)POLLIN);
 253:rt-thread/components/drivers/src/pipe.c ****     }
 254:rt-thread/components/drivers/src/pipe.c **** 
 255:rt-thread/components/drivers/src/pipe.c **** out:
 256:rt-thread/components/drivers/src/pipe.c ****     return ret;
 257:rt-thread/components/drivers/src/pipe.c **** }
 258:rt-thread/components/drivers/src/pipe.c **** 
 259:rt-thread/components/drivers/src/pipe.c **** static int pipe_fops_poll(struct dfs_fd *fd, rt_pollreq_t *req)
ARM GAS  /tmp/ccD7W85H.s 			page 6


 260:rt-thread/components/drivers/src/pipe.c **** {
 261:rt-thread/components/drivers/src/pipe.c ****     int mask = 0;
 262:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
 263:rt-thread/components/drivers/src/pipe.c ****     int mode = 0;
 264:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)fd->data;
 265:rt-thread/components/drivers/src/pipe.c **** 
 266:rt-thread/components/drivers/src/pipe.c ****     rt_poll_add(&(pipe->reader_queue), req);
 267:rt-thread/components/drivers/src/pipe.c ****     rt_poll_add(&(pipe->writer_queue), req);
 268:rt-thread/components/drivers/src/pipe.c **** 
 269:rt-thread/components/drivers/src/pipe.c ****     switch (fd->flags & O_ACCMODE)
 270:rt-thread/components/drivers/src/pipe.c ****     {
 271:rt-thread/components/drivers/src/pipe.c ****     case O_RDONLY:
 272:rt-thread/components/drivers/src/pipe.c ****         mode = 1;
 273:rt-thread/components/drivers/src/pipe.c ****         break;
 274:rt-thread/components/drivers/src/pipe.c ****     case O_WRONLY:
 275:rt-thread/components/drivers/src/pipe.c ****         mode = 2;
 276:rt-thread/components/drivers/src/pipe.c ****         break;
 277:rt-thread/components/drivers/src/pipe.c ****     case O_RDWR:
 278:rt-thread/components/drivers/src/pipe.c ****         mode = 3;
 279:rt-thread/components/drivers/src/pipe.c ****         break;
 280:rt-thread/components/drivers/src/pipe.c ****     }
 281:rt-thread/components/drivers/src/pipe.c **** 
 282:rt-thread/components/drivers/src/pipe.c ****     if (mode & 1)
 283:rt-thread/components/drivers/src/pipe.c ****     {
 284:rt-thread/components/drivers/src/pipe.c ****         if (rt_ringbuffer_data_len(pipe->fifo) != 0)
 285:rt-thread/components/drivers/src/pipe.c ****         {
 286:rt-thread/components/drivers/src/pipe.c ****             mask |= POLLIN;
 287:rt-thread/components/drivers/src/pipe.c ****         }
 288:rt-thread/components/drivers/src/pipe.c ****         if (pipe->writers == 0)
 289:rt-thread/components/drivers/src/pipe.c ****         {
 290:rt-thread/components/drivers/src/pipe.c ****             mask |= POLLHUP;
 291:rt-thread/components/drivers/src/pipe.c ****         }
 292:rt-thread/components/drivers/src/pipe.c ****     }
 293:rt-thread/components/drivers/src/pipe.c **** 
 294:rt-thread/components/drivers/src/pipe.c ****     if (mode & 2)
 295:rt-thread/components/drivers/src/pipe.c ****     {
 296:rt-thread/components/drivers/src/pipe.c ****         if (rt_ringbuffer_space_len(pipe->fifo) != 0)
 297:rt-thread/components/drivers/src/pipe.c ****         {
 298:rt-thread/components/drivers/src/pipe.c ****             mask |= POLLOUT;
 299:rt-thread/components/drivers/src/pipe.c ****         }
 300:rt-thread/components/drivers/src/pipe.c ****         if (pipe->readers == 0)
 301:rt-thread/components/drivers/src/pipe.c ****         {
 302:rt-thread/components/drivers/src/pipe.c ****             mask |= POLLERR;
 303:rt-thread/components/drivers/src/pipe.c ****         }
 304:rt-thread/components/drivers/src/pipe.c ****     }
 305:rt-thread/components/drivers/src/pipe.c **** 
 306:rt-thread/components/drivers/src/pipe.c ****     return mask;
 307:rt-thread/components/drivers/src/pipe.c **** }
 308:rt-thread/components/drivers/src/pipe.c **** 
 309:rt-thread/components/drivers/src/pipe.c **** static const struct dfs_file_ops pipe_fops =
 310:rt-thread/components/drivers/src/pipe.c **** {
 311:rt-thread/components/drivers/src/pipe.c ****     pipe_fops_open,
 312:rt-thread/components/drivers/src/pipe.c ****     pipe_fops_close,
 313:rt-thread/components/drivers/src/pipe.c ****     pipe_fops_ioctl,
 314:rt-thread/components/drivers/src/pipe.c ****     pipe_fops_read,
 315:rt-thread/components/drivers/src/pipe.c ****     pipe_fops_write,
 316:rt-thread/components/drivers/src/pipe.c ****     RT_NULL,
ARM GAS  /tmp/ccD7W85H.s 			page 7


 317:rt-thread/components/drivers/src/pipe.c ****     RT_NULL,
 318:rt-thread/components/drivers/src/pipe.c ****     RT_NULL,
 319:rt-thread/components/drivers/src/pipe.c ****     pipe_fops_poll,
 320:rt-thread/components/drivers/src/pipe.c **** };
 321:rt-thread/components/drivers/src/pipe.c **** #endif /* end of RT_USING_POSIX */
 322:rt-thread/components/drivers/src/pipe.c **** 
 323:rt-thread/components/drivers/src/pipe.c **** rt_err_t  rt_pipe_open (rt_device_t device, rt_uint16_t oflag)
 324:rt-thread/components/drivers/src/pipe.c **** {
 325:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 326:rt-thread/components/drivers/src/pipe.c **** 
 327:rt-thread/components/drivers/src/pipe.c ****     if (device == RT_NULL) return -RT_EINVAL;
 328:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 329:rt-thread/components/drivers/src/pipe.c **** 
 330:rt-thread/components/drivers/src/pipe.c ****     if (pipe->fifo == RT_NULL)
 331:rt-thread/components/drivers/src/pipe.c ****     {
 332:rt-thread/components/drivers/src/pipe.c ****         pipe->fifo = rt_ringbuffer_create(pipe->bufsz);
 333:rt-thread/components/drivers/src/pipe.c ****     }
 334:rt-thread/components/drivers/src/pipe.c **** 
 335:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&(pipe->lock));
 336:rt-thread/components/drivers/src/pipe.c **** 
 337:rt-thread/components/drivers/src/pipe.c ****     return RT_EOK;
 338:rt-thread/components/drivers/src/pipe.c **** }
 339:rt-thread/components/drivers/src/pipe.c **** 
 340:rt-thread/components/drivers/src/pipe.c **** rt_err_t  rt_pipe_close  (rt_device_t device)
 341:rt-thread/components/drivers/src/pipe.c **** {
 342:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 343:rt-thread/components/drivers/src/pipe.c **** 
 344:rt-thread/components/drivers/src/pipe.c ****     if (device == RT_NULL) return -RT_EINVAL;
 345:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 346:rt-thread/components/drivers/src/pipe.c **** 
 347:rt-thread/components/drivers/src/pipe.c ****     if (device->ref_count == 1)
 348:rt-thread/components/drivers/src/pipe.c ****     {
 349:rt-thread/components/drivers/src/pipe.c ****         rt_ringbuffer_destroy(pipe->fifo);
 350:rt-thread/components/drivers/src/pipe.c ****         pipe->fifo = RT_NULL;
 351:rt-thread/components/drivers/src/pipe.c ****     }
 352:rt-thread/components/drivers/src/pipe.c **** 
 353:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&(pipe->lock));
 354:rt-thread/components/drivers/src/pipe.c **** 
 355:rt-thread/components/drivers/src/pipe.c ****     return RT_EOK;
 356:rt-thread/components/drivers/src/pipe.c **** }
 357:rt-thread/components/drivers/src/pipe.c **** 
 358:rt-thread/components/drivers/src/pipe.c **** rt_size_t rt_pipe_read   (rt_device_t device, rt_off_t pos, void *buffer, rt_size_t count)
 359:rt-thread/components/drivers/src/pipe.c **** {
 360:rt-thread/components/drivers/src/pipe.c ****     uint8_t *pbuf;
 361:rt-thread/components/drivers/src/pipe.c ****     rt_size_t read_bytes = 0;
 362:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 363:rt-thread/components/drivers/src/pipe.c **** 
 364:rt-thread/components/drivers/src/pipe.c ****     if (device == RT_NULL)
 365:rt-thread/components/drivers/src/pipe.c ****     {
 366:rt-thread/components/drivers/src/pipe.c ****         rt_set_errno(-EINVAL);
 367:rt-thread/components/drivers/src/pipe.c ****         return 0;
 368:rt-thread/components/drivers/src/pipe.c ****     }
 369:rt-thread/components/drivers/src/pipe.c ****     if (count == 0) return 0;
 370:rt-thread/components/drivers/src/pipe.c **** 
 371:rt-thread/components/drivers/src/pipe.c ****     pbuf = (uint8_t*)buffer;
 372:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 373:rt-thread/components/drivers/src/pipe.c **** 
ARM GAS  /tmp/ccD7W85H.s 			page 8


 374:rt-thread/components/drivers/src/pipe.c ****     while (read_bytes < count)
 375:rt-thread/components/drivers/src/pipe.c ****     {
 376:rt-thread/components/drivers/src/pipe.c ****         int len = rt_ringbuffer_get(pipe->fifo, &pbuf[read_bytes], count - read_bytes);
 377:rt-thread/components/drivers/src/pipe.c ****         if (len <= 0) break;
 378:rt-thread/components/drivers/src/pipe.c **** 
 379:rt-thread/components/drivers/src/pipe.c ****         read_bytes += len;
 380:rt-thread/components/drivers/src/pipe.c ****     }
 381:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&pipe->lock);
 382:rt-thread/components/drivers/src/pipe.c **** 
 383:rt-thread/components/drivers/src/pipe.c ****     return read_bytes;
 384:rt-thread/components/drivers/src/pipe.c **** }
 385:rt-thread/components/drivers/src/pipe.c **** 
 386:rt-thread/components/drivers/src/pipe.c **** rt_size_t rt_pipe_write  (rt_device_t device, rt_off_t pos, const void *buffer, rt_size_t count)
 387:rt-thread/components/drivers/src/pipe.c **** {
 388:rt-thread/components/drivers/src/pipe.c ****     uint8_t *pbuf;
 389:rt-thread/components/drivers/src/pipe.c ****     rt_size_t write_bytes = 0;
 390:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 391:rt-thread/components/drivers/src/pipe.c **** 
 392:rt-thread/components/drivers/src/pipe.c ****     if (device == RT_NULL)
 393:rt-thread/components/drivers/src/pipe.c ****     {
 394:rt-thread/components/drivers/src/pipe.c ****         rt_set_errno(-EINVAL);
 395:rt-thread/components/drivers/src/pipe.c ****         return 0;
 396:rt-thread/components/drivers/src/pipe.c ****     }
 397:rt-thread/components/drivers/src/pipe.c ****     if (count == 0) return 0;
 398:rt-thread/components/drivers/src/pipe.c **** 
 399:rt-thread/components/drivers/src/pipe.c ****     pbuf = (uint8_t*)buffer;
 400:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&pipe->lock, -1);
 401:rt-thread/components/drivers/src/pipe.c **** 
 402:rt-thread/components/drivers/src/pipe.c ****     while (write_bytes < count)
 403:rt-thread/components/drivers/src/pipe.c ****     {
 404:rt-thread/components/drivers/src/pipe.c ****         int len = rt_ringbuffer_put(pipe->fifo, &pbuf[write_bytes], count - write_bytes);
 405:rt-thread/components/drivers/src/pipe.c ****         if (len <= 0) break;
 406:rt-thread/components/drivers/src/pipe.c **** 
 407:rt-thread/components/drivers/src/pipe.c ****         write_bytes += len;
 408:rt-thread/components/drivers/src/pipe.c ****     }
 409:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_release(&pipe->lock);
 410:rt-thread/components/drivers/src/pipe.c **** 
 411:rt-thread/components/drivers/src/pipe.c ****     return write_bytes;
 412:rt-thread/components/drivers/src/pipe.c **** }
 413:rt-thread/components/drivers/src/pipe.c **** 
 414:rt-thread/components/drivers/src/pipe.c **** rt_err_t  rt_pipe_control(rt_device_t dev, int cmd, void *args)
 415:rt-thread/components/drivers/src/pipe.c **** {
  28              		.loc 1 415 0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
  33              	.LVL0:
 416:rt-thread/components/drivers/src/pipe.c ****     return RT_EOK;
 417:rt-thread/components/drivers/src/pipe.c **** }
  34              		.loc 1 417 0
  35 0000 0020     		movs	r0, #0
  36              	.LVL1:
  37 0002 7047     		bx	lr
  38              		.cfi_endproc
  39              	.LFE23:
  41              		.section	.text.rt_pipe_open,"ax",%progbits
ARM GAS  /tmp/ccD7W85H.s 			page 9


  42              		.align	1
  43              		.global	rt_pipe_open
  44              		.syntax unified
  45              		.thumb
  46              		.thumb_func
  47              		.fpu fpv4-sp-d16
  49              	rt_pipe_open:
  50              	.LFB19:
 324:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
  51              		.loc 1 324 0
  52              		.cfi_startproc
  53              		@ args = 0, pretend = 0, frame = 0
  54              		@ frame_needed = 0, uses_anonymous_args = 0
  55              	.LVL2:
 327:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
  56              		.loc 1 327 0
  57 0000 A0B1     		cbz	r0, .L5
 324:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
  58              		.loc 1 324 0
  59 0002 38B5     		push	{r3, r4, r5, lr}
  60              	.LCFI0:
  61              		.cfi_def_cfa_offset 16
  62              		.cfi_offset 3, -16
  63              		.cfi_offset 4, -12
  64              		.cfi_offset 5, -8
  65              		.cfi_offset 14, -4
  66 0004 0446     		mov	r4, r0
 328:rt-thread/components/drivers/src/pipe.c **** 
  67              		.loc 1 328 0
  68 0006 00F15005 		add	r5, r0, #80
  69 000a 4FF0FF31 		mov	r1, #-1
  70              	.LVL3:
  71 000e 2846     		mov	r0, r5
  72              	.LVL4:
  73 0010 FFF7FEFF 		bl	rt_mutex_take
  74              	.LVL5:
 330:rt-thread/components/drivers/src/pipe.c ****     {
  75              		.loc 1 330 0
  76 0014 236B     		ldr	r3, [r4, #48]
  77 0016 23B1     		cbz	r3, .L10
  78              	.L4:
 335:rt-thread/components/drivers/src/pipe.c **** 
  79              		.loc 1 335 0
  80 0018 2846     		mov	r0, r5
  81 001a FFF7FEFF 		bl	rt_mutex_release
  82              	.LVL6:
 337:rt-thread/components/drivers/src/pipe.c **** }
  83              		.loc 1 337 0
  84 001e 0020     		movs	r0, #0
  85 0020 38BD     		pop	{r3, r4, r5, pc}
  86              	.LVL7:
  87              	.L10:
 332:rt-thread/components/drivers/src/pipe.c ****     }
  88              		.loc 1 332 0
  89 0022 A08E     		ldrh	r0, [r4, #52]
  90 0024 FFF7FEFF 		bl	rt_ringbuffer_create
  91              	.LVL8:
ARM GAS  /tmp/ccD7W85H.s 			page 10


  92 0028 2063     		str	r0, [r4, #48]
  93 002a F5E7     		b	.L4
  94              	.LVL9:
  95              	.L5:
  96              	.LCFI1:
  97              		.cfi_def_cfa_offset 0
  98              		.cfi_restore 3
  99              		.cfi_restore 4
 100              		.cfi_restore 5
 101              		.cfi_restore 14
 327:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 102              		.loc 1 327 0
 103 002c 6FF00900 		mvn	r0, #9
 104              	.LVL10:
 105 0030 7047     		bx	lr
 106              		.cfi_endproc
 107              	.LFE19:
 109              		.section	.text.rt_pipe_close,"ax",%progbits
 110              		.align	1
 111              		.global	rt_pipe_close
 112              		.syntax unified
 113              		.thumb
 114              		.thumb_func
 115              		.fpu fpv4-sp-d16
 117              	rt_pipe_close:
 118              	.LFB20:
 341:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 119              		.loc 1 341 0
 120              		.cfi_startproc
 121              		@ args = 0, pretend = 0, frame = 0
 122              		@ frame_needed = 0, uses_anonymous_args = 0
 123              	.LVL11:
 344:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 124              		.loc 1 344 0
 125 0000 B0B1     		cbz	r0, .L14
 341:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 126              		.loc 1 341 0
 127 0002 38B5     		push	{r3, r4, r5, lr}
 128              	.LCFI2:
 129              		.cfi_def_cfa_offset 16
 130              		.cfi_offset 3, -16
 131              		.cfi_offset 4, -12
 132              		.cfi_offset 5, -8
 133              		.cfi_offset 14, -4
 134 0004 0446     		mov	r4, r0
 345:rt-thread/components/drivers/src/pipe.c **** 
 135              		.loc 1 345 0
 136 0006 00F15005 		add	r5, r0, #80
 137 000a 4FF0FF31 		mov	r1, #-1
 138 000e 2846     		mov	r0, r5
 139              	.LVL12:
 140 0010 FFF7FEFF 		bl	rt_mutex_take
 141              	.LVL13:
 347:rt-thread/components/drivers/src/pipe.c ****     {
 142              		.loc 1 347 0
 143 0014 A37E     		ldrb	r3, [r4, #26]	@ zero_extendqisi2
 144 0016 012B     		cmp	r3, #1
ARM GAS  /tmp/ccD7W85H.s 			page 11


 145 0018 04D0     		beq	.L19
 146              	.L13:
 353:rt-thread/components/drivers/src/pipe.c **** 
 147              		.loc 1 353 0
 148 001a 2846     		mov	r0, r5
 149 001c FFF7FEFF 		bl	rt_mutex_release
 150              	.LVL14:
 355:rt-thread/components/drivers/src/pipe.c **** }
 151              		.loc 1 355 0
 152 0020 0020     		movs	r0, #0
 153 0022 38BD     		pop	{r3, r4, r5, pc}
 154              	.LVL15:
 155              	.L19:
 349:rt-thread/components/drivers/src/pipe.c ****         pipe->fifo = RT_NULL;
 156              		.loc 1 349 0
 157 0024 206B     		ldr	r0, [r4, #48]
 158 0026 FFF7FEFF 		bl	rt_ringbuffer_destroy
 159              	.LVL16:
 350:rt-thread/components/drivers/src/pipe.c ****     }
 160              		.loc 1 350 0
 161 002a 0023     		movs	r3, #0
 162 002c 2363     		str	r3, [r4, #48]
 163 002e F4E7     		b	.L13
 164              	.LVL17:
 165              	.L14:
 166              	.LCFI3:
 167              		.cfi_def_cfa_offset 0
 168              		.cfi_restore 3
 169              		.cfi_restore 4
 170              		.cfi_restore 5
 171              		.cfi_restore 14
 344:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_take(&(pipe->lock), RT_WAITING_FOREVER);
 172              		.loc 1 344 0
 173 0030 6FF00900 		mvn	r0, #9
 174              	.LVL18:
 175 0034 7047     		bx	lr
 176              		.cfi_endproc
 177              	.LFE20:
 179              		.section	.text.rt_pipe_read,"ax",%progbits
 180              		.align	1
 181              		.global	rt_pipe_read
 182              		.syntax unified
 183              		.thumb
 184              		.thumb_func
 185              		.fpu fpv4-sp-d16
 187              	rt_pipe_read:
 188              	.LFB21:
 359:rt-thread/components/drivers/src/pipe.c ****     uint8_t *pbuf;
 189              		.loc 1 359 0
 190              		.cfi_startproc
 191              		@ args = 0, pretend = 0, frame = 0
 192              		@ frame_needed = 0, uses_anonymous_args = 0
 193              	.LVL19:
 194 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 195              	.LCFI4:
 196              		.cfi_def_cfa_offset 24
 197              		.cfi_offset 4, -24
ARM GAS  /tmp/ccD7W85H.s 			page 12


 198              		.cfi_offset 5, -20
 199              		.cfi_offset 6, -16
 200              		.cfi_offset 7, -12
 201              		.cfi_offset 8, -8
 202              		.cfi_offset 14, -4
 203              	.LVL20:
 364:rt-thread/components/drivers/src/pipe.c ****     {
 204              		.loc 1 364 0
 205 0004 30B1     		cbz	r0, .L27
 206 0006 1746     		mov	r7, r2
 207 0008 1D46     		mov	r5, r3
 208 000a 0646     		mov	r6, r0
 369:rt-thread/components/drivers/src/pipe.c **** 
 209              		.loc 1 369 0
 210 000c 43B9     		cbnz	r3, .L28
 211              	.LVL21:
 212              	.L22:
 384:rt-thread/components/drivers/src/pipe.c **** 
 213              		.loc 1 384 0
 214 000e 2846     		mov	r0, r5
 215 0010 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 216              	.LVL22:
 217              	.L27:
 366:rt-thread/components/drivers/src/pipe.c ****         return 0;
 218              		.loc 1 366 0
 219 0014 6FF01500 		mvn	r0, #21
 220              	.LVL23:
 221 0018 FFF7FEFF 		bl	rt_set_errno
 222              	.LVL24:
 367:rt-thread/components/drivers/src/pipe.c ****     }
 223              		.loc 1 367 0
 224 001c 0025     		movs	r5, #0
 225 001e F6E7     		b	.L22
 226              	.LVL25:
 227              	.L28:
 372:rt-thread/components/drivers/src/pipe.c **** 
 228              		.loc 1 372 0
 229 0020 00F15008 		add	r8, r0, #80
 230 0024 4FF0FF31 		mov	r1, #-1
 231              	.LVL26:
 232 0028 4046     		mov	r0, r8
 233              	.LVL27:
 234 002a FFF7FEFF 		bl	rt_mutex_take
 235              	.LVL28:
 361:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 236              		.loc 1 361 0
 237 002e 0024     		movs	r4, #0
 238              	.LVL29:
 239              	.L23:
 374:rt-thread/components/drivers/src/pipe.c ****     {
 240              		.loc 1 374 0
 241 0030 AC42     		cmp	r4, r5
 242 0032 09D2     		bcs	.L24
 243              	.LBB12:
 376:rt-thread/components/drivers/src/pipe.c ****         if (len <= 0) break;
 244              		.loc 1 376 0
 245 0034 2A1B     		subs	r2, r5, r4
ARM GAS  /tmp/ccD7W85H.s 			page 13


 246 0036 92B2     		uxth	r2, r2
 247 0038 3919     		adds	r1, r7, r4
 248 003a 306B     		ldr	r0, [r6, #48]
 249 003c FFF7FEFF 		bl	rt_ringbuffer_get
 250              	.LVL30:
 377:rt-thread/components/drivers/src/pipe.c **** 
 251              		.loc 1 377 0
 252 0040 0028     		cmp	r0, #0
 253 0042 01DD     		ble	.L24
 379:rt-thread/components/drivers/src/pipe.c ****     }
 254              		.loc 1 379 0
 255 0044 0444     		add	r4, r4, r0
 256              	.LVL31:
 257 0046 F3E7     		b	.L23
 258              	.LVL32:
 259              	.L24:
 260              	.LBE12:
 381:rt-thread/components/drivers/src/pipe.c **** 
 261              		.loc 1 381 0
 262 0048 4046     		mov	r0, r8
 263 004a FFF7FEFF 		bl	rt_mutex_release
 264              	.LVL33:
 383:rt-thread/components/drivers/src/pipe.c **** }
 265              		.loc 1 383 0
 266 004e 2546     		mov	r5, r4
 267              	.LVL34:
 268 0050 DDE7     		b	.L22
 269              		.cfi_endproc
 270              	.LFE21:
 272              		.section	.text.rt_pipe_write,"ax",%progbits
 273              		.align	1
 274              		.global	rt_pipe_write
 275              		.syntax unified
 276              		.thumb
 277              		.thumb_func
 278              		.fpu fpv4-sp-d16
 280              	rt_pipe_write:
 281              	.LFB22:
 387:rt-thread/components/drivers/src/pipe.c ****     uint8_t *pbuf;
 282              		.loc 1 387 0
 283              		.cfi_startproc
 284              		@ args = 0, pretend = 0, frame = 0
 285              		@ frame_needed = 0, uses_anonymous_args = 0
 286              	.LVL35:
 287 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 288              	.LCFI5:
 289              		.cfi_def_cfa_offset 24
 290              		.cfi_offset 4, -24
 291              		.cfi_offset 5, -20
 292              		.cfi_offset 6, -16
 293              		.cfi_offset 7, -12
 294              		.cfi_offset 8, -8
 295              		.cfi_offset 14, -4
 296              	.LVL36:
 392:rt-thread/components/drivers/src/pipe.c ****     {
 297              		.loc 1 392 0
 298 0004 30B1     		cbz	r0, .L36
ARM GAS  /tmp/ccD7W85H.s 			page 14


 299 0006 1746     		mov	r7, r2
 300 0008 1D46     		mov	r5, r3
 301 000a 0646     		mov	r6, r0
 397:rt-thread/components/drivers/src/pipe.c **** 
 302              		.loc 1 397 0
 303 000c 43B9     		cbnz	r3, .L37
 304              	.LVL37:
 305              	.L31:
 412:rt-thread/components/drivers/src/pipe.c **** 
 306              		.loc 1 412 0
 307 000e 2846     		mov	r0, r5
 308 0010 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 309              	.LVL38:
 310              	.L36:
 394:rt-thread/components/drivers/src/pipe.c ****         return 0;
 311              		.loc 1 394 0
 312 0014 6FF01500 		mvn	r0, #21
 313              	.LVL39:
 314 0018 FFF7FEFF 		bl	rt_set_errno
 315              	.LVL40:
 395:rt-thread/components/drivers/src/pipe.c ****     }
 316              		.loc 1 395 0
 317 001c 0025     		movs	r5, #0
 318 001e F6E7     		b	.L31
 319              	.LVL41:
 320              	.L37:
 400:rt-thread/components/drivers/src/pipe.c **** 
 321              		.loc 1 400 0
 322 0020 00F15008 		add	r8, r0, #80
 323 0024 4FF0FF31 		mov	r1, #-1
 324              	.LVL42:
 325 0028 4046     		mov	r0, r8
 326              	.LVL43:
 327 002a FFF7FEFF 		bl	rt_mutex_take
 328              	.LVL44:
 389:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe = (rt_pipe_t *)device;
 329              		.loc 1 389 0
 330 002e 0024     		movs	r4, #0
 331              	.LVL45:
 332              	.L32:
 402:rt-thread/components/drivers/src/pipe.c ****     {
 333              		.loc 1 402 0
 334 0030 AC42     		cmp	r4, r5
 335 0032 09D2     		bcs	.L33
 336              	.LBB13:
 404:rt-thread/components/drivers/src/pipe.c ****         if (len <= 0) break;
 337              		.loc 1 404 0
 338 0034 2A1B     		subs	r2, r5, r4
 339 0036 92B2     		uxth	r2, r2
 340 0038 3919     		adds	r1, r7, r4
 341 003a 306B     		ldr	r0, [r6, #48]
 342 003c FFF7FEFF 		bl	rt_ringbuffer_put
 343              	.LVL46:
 405:rt-thread/components/drivers/src/pipe.c **** 
 344              		.loc 1 405 0
 345 0040 0028     		cmp	r0, #0
 346 0042 01DD     		ble	.L33
ARM GAS  /tmp/ccD7W85H.s 			page 15


 407:rt-thread/components/drivers/src/pipe.c ****     }
 347              		.loc 1 407 0
 348 0044 0444     		add	r4, r4, r0
 349              	.LVL47:
 350 0046 F3E7     		b	.L32
 351              	.LVL48:
 352              	.L33:
 353              	.LBE13:
 409:rt-thread/components/drivers/src/pipe.c **** 
 354              		.loc 1 409 0
 355 0048 4046     		mov	r0, r8
 356 004a FFF7FEFF 		bl	rt_mutex_release
 357              	.LVL49:
 411:rt-thread/components/drivers/src/pipe.c **** }
 358              		.loc 1 411 0
 359 004e 2546     		mov	r5, r4
 360              	.LVL50:
 361 0050 DDE7     		b	.L31
 362              		.cfi_endproc
 363              	.LFE22:
 365              		.section	.text.rt_pipe_create,"ax",%progbits
 366              		.align	1
 367              		.global	rt_pipe_create
 368              		.syntax unified
 369              		.thumb
 370              		.thumb_func
 371              		.fpu fpv4-sp-d16
 373              	rt_pipe_create:
 374              	.LFB24:
 418:rt-thread/components/drivers/src/pipe.c **** 
 419:rt-thread/components/drivers/src/pipe.c **** #ifdef RT_USING_DEVICE_OPS
 420:rt-thread/components/drivers/src/pipe.c **** const static struct rt_device_ops pipe_ops = 
 421:rt-thread/components/drivers/src/pipe.c **** {
 422:rt-thread/components/drivers/src/pipe.c ****     RT_NULL,
 423:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_open,
 424:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_close,
 425:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_read,
 426:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_write,
 427:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_control,
 428:rt-thread/components/drivers/src/pipe.c **** };
 429:rt-thread/components/drivers/src/pipe.c **** #endif
 430:rt-thread/components/drivers/src/pipe.c **** 
 431:rt-thread/components/drivers/src/pipe.c **** rt_pipe_t *rt_pipe_create(const char *name, int bufsz)
 432:rt-thread/components/drivers/src/pipe.c **** {
 375              		.loc 1 432 0
 376              		.cfi_startproc
 377              		@ args = 0, pretend = 0, frame = 0
 378              		@ frame_needed = 0, uses_anonymous_args = 0
 379              	.LVL51:
 380 0000 70B5     		push	{r4, r5, r6, lr}
 381              	.LCFI6:
 382              		.cfi_def_cfa_offset 16
 383              		.cfi_offset 4, -16
 384              		.cfi_offset 5, -12
 385              		.cfi_offset 6, -8
 386              		.cfi_offset 14, -4
 387 0002 0546     		mov	r5, r0
ARM GAS  /tmp/ccD7W85H.s 			page 16


 388 0004 0E46     		mov	r6, r1
 433:rt-thread/components/drivers/src/pipe.c ****     rt_pipe_t *pipe;
 434:rt-thread/components/drivers/src/pipe.c ****     rt_device_t dev;
 435:rt-thread/components/drivers/src/pipe.c **** 
 436:rt-thread/components/drivers/src/pipe.c ****     pipe = (rt_pipe_t *)rt_malloc(sizeof(rt_pipe_t));
 389              		.loc 1 436 0
 390 0006 7420     		movs	r0, #116
 391              	.LVL52:
 392 0008 FFF7FEFF 		bl	rt_malloc
 393              	.LVL53:
 437:rt-thread/components/drivers/src/pipe.c ****     if (pipe == RT_NULL) return RT_NULL;
 394              		.loc 1 437 0
 395 000c 0446     		mov	r4, r0
 396 000e 18B3     		cbz	r0, .L38
 438:rt-thread/components/drivers/src/pipe.c **** 
 439:rt-thread/components/drivers/src/pipe.c ****     rt_memset(pipe, 0, sizeof(rt_pipe_t));
 397              		.loc 1 439 0
 398 0010 7422     		movs	r2, #116
 399 0012 0021     		movs	r1, #0
 400 0014 FFF7FEFF 		bl	rt_memset
 401              	.LVL54:
 440:rt-thread/components/drivers/src/pipe.c ****     pipe->is_named = RT_TRUE; /* initialize as a named pipe */
 402              		.loc 1 440 0
 403 0018 0123     		movs	r3, #1
 404 001a E362     		str	r3, [r4, #44]
 441:rt-thread/components/drivers/src/pipe.c ****     rt_mutex_init(&(pipe->lock), name, RT_IPC_FLAG_FIFO);
 405              		.loc 1 441 0
 406 001c 0022     		movs	r2, #0
 407 001e 2946     		mov	r1, r5
 408 0020 04F15000 		add	r0, r4, #80
 409 0024 FFF7FEFF 		bl	rt_mutex_init
 410              	.LVL55:
 411              	.LBB14:
 412              	.LBB15:
 413              		.file 2 "rt-thread/components/drivers/include/ipc/waitqueue.h"
   1:rt-thread/components/drivers/include/ipc/waitqueue.h **** /*
   2:rt-thread/components/drivers/include/ipc/waitqueue.h ****  * Copyright (c) 2006-2018, RT-Thread Development Team
   3:rt-thread/components/drivers/include/ipc/waitqueue.h ****  *
   4:rt-thread/components/drivers/include/ipc/waitqueue.h ****  * SPDX-License-Identifier: Apache-2.0
   5:rt-thread/components/drivers/include/ipc/waitqueue.h ****  *
   6:rt-thread/components/drivers/include/ipc/waitqueue.h ****  * Change Logs:
   7:rt-thread/components/drivers/include/ipc/waitqueue.h ****  * Date           Author       Notes
   8:rt-thread/components/drivers/include/ipc/waitqueue.h ****  * 2018/06/26     Bernard      Fix the wait queue issue when wakeup a soon 
   9:rt-thread/components/drivers/include/ipc/waitqueue.h ****  *                             to blocked thread.
  10:rt-thread/components/drivers/include/ipc/waitqueue.h ****  */
  11:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  12:rt-thread/components/drivers/include/ipc/waitqueue.h **** #ifndef WAITQUEUE_H__
  13:rt-thread/components/drivers/include/ipc/waitqueue.h **** #define WAITQUEUE_H__
  14:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  15:rt-thread/components/drivers/include/ipc/waitqueue.h **** #include <rtthread.h>
  16:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  17:rt-thread/components/drivers/include/ipc/waitqueue.h **** #define RT_WQ_FLAG_CLEAN    0x00
  18:rt-thread/components/drivers/include/ipc/waitqueue.h **** #define RT_WQ_FLAG_WAKEUP   0x01
  19:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  20:rt-thread/components/drivers/include/ipc/waitqueue.h **** struct rt_wqueue_node;
  21:rt-thread/components/drivers/include/ipc/waitqueue.h **** typedef int (*rt_wqueue_func_t)(struct rt_wqueue_node *wait, void *key);
  22:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
ARM GAS  /tmp/ccD7W85H.s 			page 17


  23:rt-thread/components/drivers/include/ipc/waitqueue.h **** struct rt_wqueue_node
  24:rt-thread/components/drivers/include/ipc/waitqueue.h **** {
  25:rt-thread/components/drivers/include/ipc/waitqueue.h ****     rt_thread_t polling_thread;
  26:rt-thread/components/drivers/include/ipc/waitqueue.h ****     rt_list_t   list;
  27:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  28:rt-thread/components/drivers/include/ipc/waitqueue.h ****     rt_wqueue_func_t wakeup;
  29:rt-thread/components/drivers/include/ipc/waitqueue.h ****     rt_uint32_t key;
  30:rt-thread/components/drivers/include/ipc/waitqueue.h **** };
  31:rt-thread/components/drivers/include/ipc/waitqueue.h **** typedef struct rt_wqueue_node rt_wqueue_node_t;
  32:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  33:rt-thread/components/drivers/include/ipc/waitqueue.h **** int __wqueue_default_wake(struct rt_wqueue_node *wait, void *key);
  34:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  35:rt-thread/components/drivers/include/ipc/waitqueue.h **** rt_inline void rt_wqueue_init(rt_wqueue_t *queue)
  36:rt-thread/components/drivers/include/ipc/waitqueue.h **** {
  37:rt-thread/components/drivers/include/ipc/waitqueue.h ****     RT_ASSERT(queue != RT_NULL);
  38:rt-thread/components/drivers/include/ipc/waitqueue.h **** 
  39:rt-thread/components/drivers/include/ipc/waitqueue.h ****     queue->flag = RT_WQ_FLAG_CLEAN;
 414              		.loc 2 39 0
 415 0028 0023     		movs	r3, #0
 416 002a A363     		str	r3, [r4, #56]
  40:rt-thread/components/drivers/include/ipc/waitqueue.h ****     rt_list_init(&(queue->waiting_list));
 417              		.loc 2 40 0
 418 002c 04F13C02 		add	r2, r4, #60
 419              	.LVL56:
 420              	.LBB16:
 421              	.LBB17:
 422              		.file 3 "rt-thread/include/rtservice.h"
   1:rt-thread/include/rtservice.h **** /*
   2:rt-thread/include/rtservice.h ****  * Copyright (c) 2006-2018, RT-Thread Development Team
   3:rt-thread/include/rtservice.h ****  *
   4:rt-thread/include/rtservice.h ****  * SPDX-License-Identifier: Apache-2.0
   5:rt-thread/include/rtservice.h ****  *
   6:rt-thread/include/rtservice.h ****  * Change Logs:
   7:rt-thread/include/rtservice.h ****  * Date           Author       Notes
   8:rt-thread/include/rtservice.h ****  * 2006-03-16     Bernard      the first version
   9:rt-thread/include/rtservice.h ****  * 2006-09-07     Bernard      move the kservice APIs to rtthread.h
  10:rt-thread/include/rtservice.h ****  * 2007-06-27     Bernard      fix the rt_list_remove bug
  11:rt-thread/include/rtservice.h ****  * 2012-03-22     Bernard      rename kservice.h to rtservice.h
  12:rt-thread/include/rtservice.h ****  * 2017-11-15     JasonJia     Modify rt_slist_foreach to rt_slist_for_each_entry.
  13:rt-thread/include/rtservice.h ****  *                             Make code cleanup.
  14:rt-thread/include/rtservice.h ****  */
  15:rt-thread/include/rtservice.h **** 
  16:rt-thread/include/rtservice.h **** #ifndef __RT_SERVICE_H__
  17:rt-thread/include/rtservice.h **** #define __RT_SERVICE_H__
  18:rt-thread/include/rtservice.h **** 
  19:rt-thread/include/rtservice.h **** #ifdef __cplusplus
  20:rt-thread/include/rtservice.h **** extern "C" {
  21:rt-thread/include/rtservice.h **** #endif
  22:rt-thread/include/rtservice.h **** 
  23:rt-thread/include/rtservice.h **** /**
  24:rt-thread/include/rtservice.h ****  * @addtogroup KernelService
  25:rt-thread/include/rtservice.h ****  */
  26:rt-thread/include/rtservice.h **** 
  27:rt-thread/include/rtservice.h **** /**@{*/
  28:rt-thread/include/rtservice.h **** 
  29:rt-thread/include/rtservice.h **** /**
  30:rt-thread/include/rtservice.h ****  * rt_container_of - return the member address of ptr, if the type of ptr is the
ARM GAS  /tmp/ccD7W85H.s 			page 18


  31:rt-thread/include/rtservice.h ****  * struct type.
  32:rt-thread/include/rtservice.h ****  */
  33:rt-thread/include/rtservice.h **** #define rt_container_of(ptr, type, member) \
  34:rt-thread/include/rtservice.h ****     ((type *)((char *)(ptr) - (unsigned long)(&((type *)0)->member)))
  35:rt-thread/include/rtservice.h **** 
  36:rt-thread/include/rtservice.h **** 
  37:rt-thread/include/rtservice.h **** /**
  38:rt-thread/include/rtservice.h ****  * @brief initialize a list object
  39:rt-thread/include/rtservice.h ****  */
  40:rt-thread/include/rtservice.h **** #define RT_LIST_OBJECT_INIT(object) { &(object), &(object) }
  41:rt-thread/include/rtservice.h **** 
  42:rt-thread/include/rtservice.h **** /**
  43:rt-thread/include/rtservice.h ****  * @brief initialize a list
  44:rt-thread/include/rtservice.h ****  *
  45:rt-thread/include/rtservice.h ****  * @param l list to be initialized
  46:rt-thread/include/rtservice.h ****  */
  47:rt-thread/include/rtservice.h **** rt_inline void rt_list_init(rt_list_t *l)
  48:rt-thread/include/rtservice.h **** {
  49:rt-thread/include/rtservice.h ****     l->next = l->prev = l;
 423              		.loc 3 49 0
 424 0030 2264     		str	r2, [r4, #64]
 425 0032 E263     		str	r2, [r4, #60]
 426              	.LVL57:
 427              	.LBE17:
 428              	.LBE16:
 429              	.LBE15:
 430              	.LBE14:
 431              	.LBB18:
 432              	.LBB19:
  39:rt-thread/components/drivers/include/ipc/waitqueue.h ****     rt_list_init(&(queue->waiting_list));
 433              		.loc 2 39 0
 434 0034 6364     		str	r3, [r4, #68]
 435              		.loc 2 40 0
 436 0036 04F14802 		add	r2, r4, #72
 437              	.LVL58:
 438              	.LBB20:
 439              	.LBB21:
 440              		.loc 3 49 0
 441 003a E264     		str	r2, [r4, #76]
 442 003c A264     		str	r2, [r4, #72]
 443              	.LVL59:
 444              	.LBE21:
 445              	.LBE20:
 446              	.LBE19:
 447              	.LBE18:
 442:rt-thread/components/drivers/src/pipe.c ****     rt_wqueue_init(&(pipe->reader_queue));
 443:rt-thread/components/drivers/src/pipe.c ****     rt_wqueue_init(&(pipe->writer_queue));
 444:rt-thread/components/drivers/src/pipe.c **** 
 445:rt-thread/components/drivers/src/pipe.c ****     RT_ASSERT(bufsz < 0xFFFF);
 446:rt-thread/components/drivers/src/pipe.c ****     pipe->bufsz = bufsz;
 448              		.loc 1 446 0
 449 003e A686     		strh	r6, [r4, #52]	@ movhi
 450              	.LVL60:
 447:rt-thread/components/drivers/src/pipe.c **** 
 448:rt-thread/components/drivers/src/pipe.c ****     dev = &(pipe->parent);
 449:rt-thread/components/drivers/src/pipe.c ****     dev->type = RT_Device_Class_Pipe;
 451              		.loc 1 449 0
ARM GAS  /tmp/ccD7W85H.s 			page 19


 452 0040 0F22     		movs	r2, #15
 453 0042 2275     		strb	r2, [r4, #20]
 450:rt-thread/components/drivers/src/pipe.c **** #ifdef RT_USING_DEVICE_OPS
 451:rt-thread/components/drivers/src/pipe.c ****     dev->ops         = &pipe_ops;
 454              		.loc 1 451 0
 455 0044 084A     		ldr	r2, .L42
 456 0046 6262     		str	r2, [r4, #36]
 452:rt-thread/components/drivers/src/pipe.c **** #else
 453:rt-thread/components/drivers/src/pipe.c ****     dev->init        = RT_NULL;
 454:rt-thread/components/drivers/src/pipe.c ****     dev->open        = rt_pipe_open;
 455:rt-thread/components/drivers/src/pipe.c ****     dev->read        = rt_pipe_read;
 456:rt-thread/components/drivers/src/pipe.c ****     dev->write       = rt_pipe_write;
 457:rt-thread/components/drivers/src/pipe.c ****     dev->close       = rt_pipe_close;
 458:rt-thread/components/drivers/src/pipe.c ****     dev->control     = rt_pipe_control;
 459:rt-thread/components/drivers/src/pipe.c **** #endif
 460:rt-thread/components/drivers/src/pipe.c **** 
 461:rt-thread/components/drivers/src/pipe.c ****     dev->rx_indicate = RT_NULL;
 457              		.loc 1 461 0
 458 0048 E361     		str	r3, [r4, #28]
 462:rt-thread/components/drivers/src/pipe.c ****     dev->tx_complete = RT_NULL;
 459              		.loc 1 462 0
 460 004a 2362     		str	r3, [r4, #32]
 463:rt-thread/components/drivers/src/pipe.c **** 
 464:rt-thread/components/drivers/src/pipe.c ****     if (rt_device_register(&(pipe->parent), name, RT_DEVICE_FLAG_RDWR | RT_DEVICE_FLAG_REMOVABLE) !
 461              		.loc 1 464 0
 462 004c 0722     		movs	r2, #7
 463 004e 2946     		mov	r1, r5
 464 0050 2046     		mov	r0, r4
 465 0052 FFF7FEFF 		bl	rt_device_register
 466              	.LVL61:
 467 0056 08B9     		cbnz	r0, .L41
 468              	.LVL62:
 469              	.L38:
 465:rt-thread/components/drivers/src/pipe.c ****     {
 466:rt-thread/components/drivers/src/pipe.c ****         rt_free(pipe);
 467:rt-thread/components/drivers/src/pipe.c ****         return RT_NULL;
 468:rt-thread/components/drivers/src/pipe.c ****     }
 469:rt-thread/components/drivers/src/pipe.c **** #ifdef RT_USING_POSIX
 470:rt-thread/components/drivers/src/pipe.c ****     dev->fops = (void*)&pipe_fops;
 471:rt-thread/components/drivers/src/pipe.c **** #endif
 472:rt-thread/components/drivers/src/pipe.c **** 
 473:rt-thread/components/drivers/src/pipe.c ****     return pipe;
 474:rt-thread/components/drivers/src/pipe.c **** }
 470              		.loc 1 474 0
 471 0058 2046     		mov	r0, r4
 472 005a 70BD     		pop	{r4, r5, r6, pc}
 473              	.LVL63:
 474              	.L41:
 466:rt-thread/components/drivers/src/pipe.c ****         return RT_NULL;
 475              		.loc 1 466 0
 476 005c 2046     		mov	r0, r4
 477 005e FFF7FEFF 		bl	rt_free
 478              	.LVL64:
 467:rt-thread/components/drivers/src/pipe.c ****     }
 479              		.loc 1 467 0
 480 0062 0024     		movs	r4, #0
 481              	.LVL65:
ARM GAS  /tmp/ccD7W85H.s 			page 20


 482 0064 F8E7     		b	.L38
 483              	.L43:
 484 0066 00BF     		.align	2
 485              	.L42:
 486 0068 00000000 		.word	.LANCHOR0
 487              		.cfi_endproc
 488              	.LFE24:
 490              		.section	.text.rt_pipe_delete,"ax",%progbits
 491              		.align	1
 492              		.global	rt_pipe_delete
 493              		.syntax unified
 494              		.thumb
 495              		.thumb_func
 496              		.fpu fpv4-sp-d16
 498              	rt_pipe_delete:
 499              	.LFB25:
 475:rt-thread/components/drivers/src/pipe.c **** 
 476:rt-thread/components/drivers/src/pipe.c **** int rt_pipe_delete(const char *name)
 477:rt-thread/components/drivers/src/pipe.c **** {
 500              		.loc 1 477 0
 501              		.cfi_startproc
 502              		@ args = 0, pretend = 0, frame = 0
 503              		@ frame_needed = 0, uses_anonymous_args = 0
 504              	.LVL66:
 505 0000 10B5     		push	{r4, lr}
 506              	.LCFI7:
 507              		.cfi_def_cfa_offset 8
 508              		.cfi_offset 4, -8
 509              		.cfi_offset 14, -4
 510              	.LVL67:
 478:rt-thread/components/drivers/src/pipe.c ****     int result = 0;
 479:rt-thread/components/drivers/src/pipe.c ****     rt_device_t device;
 480:rt-thread/components/drivers/src/pipe.c **** 
 481:rt-thread/components/drivers/src/pipe.c ****     device = rt_device_find(name);
 511              		.loc 1 481 0
 512 0002 FFF7FEFF 		bl	rt_device_find
 513              	.LVL68:
 482:rt-thread/components/drivers/src/pipe.c ****     if (device)
 514              		.loc 1 482 0
 515 0006 B0B1     		cbz	r0, .L47
 516 0008 0446     		mov	r4, r0
 483:rt-thread/components/drivers/src/pipe.c ****     {
 484:rt-thread/components/drivers/src/pipe.c ****         if (device->type == RT_Device_Class_Pipe)
 517              		.loc 1 484 0
 518 000a 037D     		ldrb	r3, [r0, #20]	@ zero_extendqisi2
 519 000c 0F2B     		cmp	r3, #15
 520 000e 15D1     		bne	.L48
 521              	.LBB22:
 485:rt-thread/components/drivers/src/pipe.c ****         {
 486:rt-thread/components/drivers/src/pipe.c ****             rt_pipe_t *pipe;
 487:rt-thread/components/drivers/src/pipe.c **** 
 488:rt-thread/components/drivers/src/pipe.c ****             if (device->ref_count != 0)
 522              		.loc 1 488 0
 523 0010 837E     		ldrb	r3, [r0, #26]	@ zero_extendqisi2
 524 0012 B3B9     		cbnz	r3, .L49
 525              	.LVL69:
 489:rt-thread/components/drivers/src/pipe.c ****             {
ARM GAS  /tmp/ccD7W85H.s 			page 21


 490:rt-thread/components/drivers/src/pipe.c ****                 return -RT_EBUSY;
 491:rt-thread/components/drivers/src/pipe.c ****             }
 492:rt-thread/components/drivers/src/pipe.c **** 
 493:rt-thread/components/drivers/src/pipe.c ****             pipe = (rt_pipe_t *)device;
 494:rt-thread/components/drivers/src/pipe.c **** 
 495:rt-thread/components/drivers/src/pipe.c ****             rt_mutex_detach(&(pipe->lock));
 526              		.loc 1 495 0
 527 0014 5030     		adds	r0, r0, #80
 528              	.LVL70:
 529 0016 FFF7FEFF 		bl	rt_mutex_detach
 530              	.LVL71:
 496:rt-thread/components/drivers/src/pipe.c ****             rt_device_unregister(device);
 531              		.loc 1 496 0
 532 001a 2046     		mov	r0, r4
 533 001c FFF7FEFF 		bl	rt_device_unregister
 534              	.LVL72:
 497:rt-thread/components/drivers/src/pipe.c **** 
 498:rt-thread/components/drivers/src/pipe.c ****             /* close fifo ringbuffer */
 499:rt-thread/components/drivers/src/pipe.c ****             if (pipe->fifo) 
 535              		.loc 1 499 0
 536 0020 206B     		ldr	r0, [r4, #48]
 537 0022 18B1     		cbz	r0, .L46
 500:rt-thread/components/drivers/src/pipe.c ****             {
 501:rt-thread/components/drivers/src/pipe.c ****                 rt_ringbuffer_destroy(pipe->fifo);
 538              		.loc 1 501 0
 539 0024 FFF7FEFF 		bl	rt_ringbuffer_destroy
 540              	.LVL73:
 502:rt-thread/components/drivers/src/pipe.c ****                 pipe->fifo = RT_NULL;
 541              		.loc 1 502 0
 542 0028 0023     		movs	r3, #0
 543 002a 2363     		str	r3, [r4, #48]
 544              	.L46:
 503:rt-thread/components/drivers/src/pipe.c ****             }
 504:rt-thread/components/drivers/src/pipe.c ****             rt_free(pipe);
 545              		.loc 1 504 0
 546 002c 2046     		mov	r0, r4
 547 002e FFF7FEFF 		bl	rt_free
 548              	.LVL74:
 549              	.LBE22:
 478:rt-thread/components/drivers/src/pipe.c ****     rt_device_t device;
 550              		.loc 1 478 0
 551 0032 0020     		movs	r0, #0
 552 0034 10BD     		pop	{r4, pc}
 553              	.LVL75:
 554              	.L47:
 505:rt-thread/components/drivers/src/pipe.c ****         }
 506:rt-thread/components/drivers/src/pipe.c ****         else
 507:rt-thread/components/drivers/src/pipe.c ****         {
 508:rt-thread/components/drivers/src/pipe.c ****             result = -ENODEV;
 509:rt-thread/components/drivers/src/pipe.c ****         }
 510:rt-thread/components/drivers/src/pipe.c ****     }
 511:rt-thread/components/drivers/src/pipe.c ****     else
 512:rt-thread/components/drivers/src/pipe.c ****     {
 513:rt-thread/components/drivers/src/pipe.c ****         result = -ENODEV;
 555              		.loc 1 513 0
 556 0036 6FF01200 		mvn	r0, #18
 557              	.LVL76:
ARM GAS  /tmp/ccD7W85H.s 			page 22


 558 003a 10BD     		pop	{r4, pc}
 559              	.LVL77:
 560              	.L48:
 508:rt-thread/components/drivers/src/pipe.c ****         }
 561              		.loc 1 508 0
 562 003c 6FF01200 		mvn	r0, #18
 563              	.LVL78:
 564 0040 10BD     		pop	{r4, pc}
 565              	.LVL79:
 566              	.L49:
 567              	.LBB23:
 490:rt-thread/components/drivers/src/pipe.c ****             }
 568              		.loc 1 490 0
 569 0042 6FF00600 		mvn	r0, #6
 570              	.LVL80:
 571              	.LBE23:
 514:rt-thread/components/drivers/src/pipe.c ****     }
 515:rt-thread/components/drivers/src/pipe.c **** 
 516:rt-thread/components/drivers/src/pipe.c ****     return result;
 517:rt-thread/components/drivers/src/pipe.c **** }
 572              		.loc 1 517 0
 573 0046 10BD     		pop	{r4, pc}
 574              		.cfi_endproc
 575              	.LFE25:
 577              		.section	.rodata.pipe_ops,"a",%progbits
 578              		.align	2
 579              		.set	.LANCHOR0,. + 0
 582              	pipe_ops:
 583 0000 00000000 		.word	0
 584 0004 00000000 		.word	rt_pipe_open
 585 0008 00000000 		.word	rt_pipe_close
 586 000c 00000000 		.word	rt_pipe_read
 587 0010 00000000 		.word	rt_pipe_write
 588 0014 00000000 		.word	rt_pipe_control
 589              		.text
 590              	.Letext0:
 591              		.file 4 "rt-thread/include/rtdef.h"
 592              		.file 5 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/machine/_default_types.h"
 593              		.file 6 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/lock.h"
 594              		.file 7 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_types.h"
 595              		.file 8 "/opt/gcc-arm-none-eabi-6-2017-q2-update/lib/gcc/arm-none-eabi/6.3.1/include/stddef.h"
 596              		.file 9 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/reent.h"
 597              		.file 10 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_stdint.h"
 598              		.file 11 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/time.h"
 599              		.file 12 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/errno.h"
 600              		.file 13 "rt-thread/components/finsh/finsh_api.h"
 601              		.file 14 "rt-thread/components/drivers/include/ipc/ringbuffer.h"
 602              		.file 15 "rt-thread/components/drivers/include/ipc/pipe.h"
 603              		.file 16 "rt-thread/include/rtthread.h"
ARM GAS  /tmp/ccD7W85H.s 			page 23


DEFINED SYMBOLS
                            *ABS*:0000000000000000 pipe.c
     /tmp/ccD7W85H.s:18     .text.rt_pipe_control:0000000000000000 $t
     /tmp/ccD7W85H.s:25     .text.rt_pipe_control:0000000000000000 rt_pipe_control
     /tmp/ccD7W85H.s:42     .text.rt_pipe_open:0000000000000000 $t
     /tmp/ccD7W85H.s:49     .text.rt_pipe_open:0000000000000000 rt_pipe_open
     /tmp/ccD7W85H.s:110    .text.rt_pipe_close:0000000000000000 $t
     /tmp/ccD7W85H.s:117    .text.rt_pipe_close:0000000000000000 rt_pipe_close
     /tmp/ccD7W85H.s:180    .text.rt_pipe_read:0000000000000000 $t
     /tmp/ccD7W85H.s:187    .text.rt_pipe_read:0000000000000000 rt_pipe_read
     /tmp/ccD7W85H.s:273    .text.rt_pipe_write:0000000000000000 $t
     /tmp/ccD7W85H.s:280    .text.rt_pipe_write:0000000000000000 rt_pipe_write
     /tmp/ccD7W85H.s:366    .text.rt_pipe_create:0000000000000000 $t
     /tmp/ccD7W85H.s:373    .text.rt_pipe_create:0000000000000000 rt_pipe_create
     /tmp/ccD7W85H.s:486    .text.rt_pipe_create:0000000000000068 $d
     /tmp/ccD7W85H.s:491    .text.rt_pipe_delete:0000000000000000 $t
     /tmp/ccD7W85H.s:498    .text.rt_pipe_delete:0000000000000000 rt_pipe_delete
     /tmp/ccD7W85H.s:578    .rodata.pipe_ops:0000000000000000 $d
     /tmp/ccD7W85H.s:582    .rodata.pipe_ops:0000000000000000 pipe_ops
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
rt_mutex_take
rt_mutex_release
rt_ringbuffer_create
rt_ringbuffer_destroy
rt_set_errno
rt_ringbuffer_get
rt_ringbuffer_put
rt_malloc
rt_memset
rt_mutex_init
rt_device_register
rt_free
rt_device_find
rt_mutex_detach
rt_device_unregister
