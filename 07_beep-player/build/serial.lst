ARM GAS  /tmp/ccebIloK.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"serial.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text._serial_check_buffer_size,"ax",%progbits
  18              		.align	1
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu fpv4-sp-d16
  24              	_serial_check_buffer_size:
  25              	.LFB23:
  26              		.file 1 "rt-thread/components/drivers/serial/serial.c"
   1:rt-thread/components/drivers/serial/serial.c **** /*
   2:rt-thread/components/drivers/serial/serial.c ****  * Copyright (c) 2006-2018, RT-Thread Development Team
   3:rt-thread/components/drivers/serial/serial.c ****  *
   4:rt-thread/components/drivers/serial/serial.c ****  * SPDX-License-Identifier: Apache-2.0
   5:rt-thread/components/drivers/serial/serial.c ****  *
   6:rt-thread/components/drivers/serial/serial.c ****  * Change Logs:
   7:rt-thread/components/drivers/serial/serial.c ****  * Date           Author       Notes
   8:rt-thread/components/drivers/serial/serial.c ****  * 2006-03-13     bernard      first version
   9:rt-thread/components/drivers/serial/serial.c ****  * 2012-05-15     lgnq         modified according bernard's implementation.
  10:rt-thread/components/drivers/serial/serial.c ****  * 2012-05-28     bernard      code cleanup
  11:rt-thread/components/drivers/serial/serial.c ****  * 2012-11-23     bernard      fix compiler warning.
  12:rt-thread/components/drivers/serial/serial.c ****  * 2013-02-20     bernard      use RT_SERIAL_RB_BUFSZ to define
  13:rt-thread/components/drivers/serial/serial.c ****  *                             the size of ring buffer.
  14:rt-thread/components/drivers/serial/serial.c ****  * 2014-07-10     bernard      rewrite serial framework
  15:rt-thread/components/drivers/serial/serial.c ****  * 2014-12-31     bernard      use open_flag for poll_tx stream mode.
  16:rt-thread/components/drivers/serial/serial.c ****  * 2015-05-19     Quintin      fix DMA tx mod tx_dma->activated flag !=RT_FALSE BUG
  17:rt-thread/components/drivers/serial/serial.c ****  *                             in open function.
  18:rt-thread/components/drivers/serial/serial.c ****  * 2015-11-10     bernard      fix the poll rx issue when there is no data.
  19:rt-thread/components/drivers/serial/serial.c ****  * 2016-05-10     armink       add fifo mode to DMA rx when serial->config.bufsz != 0.
  20:rt-thread/components/drivers/serial/serial.c ****  * 2017-01-19     aubr.cool    prevent change serial rx bufsz when serial is opened.
  21:rt-thread/components/drivers/serial/serial.c ****  * 2017-11-07     JasonJia     fix data bits error issue when using tcsetattr.
  22:rt-thread/components/drivers/serial/serial.c ****  * 2017-11-15     JasonJia     fix poll rx issue when data is full.
  23:rt-thread/components/drivers/serial/serial.c ****  *                             add TCFLSH and FIONREAD support.
  24:rt-thread/components/drivers/serial/serial.c ****  * 2018-12-08     Ernest Chen  add DMA choice
  25:rt-thread/components/drivers/serial/serial.c ****  */
  26:rt-thread/components/drivers/serial/serial.c **** 
  27:rt-thread/components/drivers/serial/serial.c **** #include <rthw.h>
  28:rt-thread/components/drivers/serial/serial.c **** #include <rtthread.h>
  29:rt-thread/components/drivers/serial/serial.c **** #include <rtdevice.h>
  30:rt-thread/components/drivers/serial/serial.c **** 
  31:rt-thread/components/drivers/serial/serial.c **** #define DBG_TAG    "UART"
  32:rt-thread/components/drivers/serial/serial.c **** #define DBG_LVL    DBG_INFO
ARM GAS  /tmp/ccebIloK.s 			page 2


  33:rt-thread/components/drivers/serial/serial.c **** #include <rtdbg.h>
  34:rt-thread/components/drivers/serial/serial.c **** 
  35:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_POSIX
  36:rt-thread/components/drivers/serial/serial.c **** #include <dfs_posix.h>
  37:rt-thread/components/drivers/serial/serial.c **** #include <dfs_poll.h>
  38:rt-thread/components/drivers/serial/serial.c **** 
  39:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_POSIX_TERMIOS
  40:rt-thread/components/drivers/serial/serial.c **** #include <posix_termios.h>
  41:rt-thread/components/drivers/serial/serial.c **** #endif
  42:rt-thread/components/drivers/serial/serial.c **** 
  43:rt-thread/components/drivers/serial/serial.c **** /* it's possible the 'getc/putc' is defined by stdio.h in gcc/newlib. */
  44:rt-thread/components/drivers/serial/serial.c **** #ifdef getc
  45:rt-thread/components/drivers/serial/serial.c **** #undef getc
  46:rt-thread/components/drivers/serial/serial.c **** #endif
  47:rt-thread/components/drivers/serial/serial.c **** 
  48:rt-thread/components/drivers/serial/serial.c **** #ifdef putc
  49:rt-thread/components/drivers/serial/serial.c **** #undef putc
  50:rt-thread/components/drivers/serial/serial.c **** #endif
  51:rt-thread/components/drivers/serial/serial.c **** 
  52:rt-thread/components/drivers/serial/serial.c **** static rt_err_t serial_fops_rx_ind(rt_device_t dev, rt_size_t size)
  53:rt-thread/components/drivers/serial/serial.c **** {
  54:rt-thread/components/drivers/serial/serial.c ****     rt_wqueue_wakeup(&(dev->wait_queue), (void*)POLLIN);
  55:rt-thread/components/drivers/serial/serial.c **** 
  56:rt-thread/components/drivers/serial/serial.c ****     return RT_EOK;
  57:rt-thread/components/drivers/serial/serial.c **** }
  58:rt-thread/components/drivers/serial/serial.c **** 
  59:rt-thread/components/drivers/serial/serial.c **** /* fops for serial */
  60:rt-thread/components/drivers/serial/serial.c **** static int serial_fops_open(struct dfs_fd *fd)
  61:rt-thread/components/drivers/serial/serial.c **** {
  62:rt-thread/components/drivers/serial/serial.c ****     rt_err_t ret = 0;
  63:rt-thread/components/drivers/serial/serial.c ****     rt_uint16_t flags = 0;
  64:rt-thread/components/drivers/serial/serial.c ****     rt_device_t device;
  65:rt-thread/components/drivers/serial/serial.c **** 
  66:rt-thread/components/drivers/serial/serial.c ****     device = (rt_device_t)fd->data;
  67:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(device != RT_NULL);
  68:rt-thread/components/drivers/serial/serial.c **** 
  69:rt-thread/components/drivers/serial/serial.c ****     switch (fd->flags & O_ACCMODE)
  70:rt-thread/components/drivers/serial/serial.c ****     {
  71:rt-thread/components/drivers/serial/serial.c ****     case O_RDONLY:
  72:rt-thread/components/drivers/serial/serial.c ****         LOG_D("fops open: O_RDONLY!");
  73:rt-thread/components/drivers/serial/serial.c ****         flags = RT_DEVICE_FLAG_INT_RX | RT_DEVICE_FLAG_RDONLY;
  74:rt-thread/components/drivers/serial/serial.c ****         break;
  75:rt-thread/components/drivers/serial/serial.c ****     case O_WRONLY:
  76:rt-thread/components/drivers/serial/serial.c ****         LOG_D("fops open: O_WRONLY!");
  77:rt-thread/components/drivers/serial/serial.c ****         flags = RT_DEVICE_FLAG_WRONLY;
  78:rt-thread/components/drivers/serial/serial.c ****         break;
  79:rt-thread/components/drivers/serial/serial.c ****     case O_RDWR:
  80:rt-thread/components/drivers/serial/serial.c ****         LOG_D("fops open: O_RDWR!");
  81:rt-thread/components/drivers/serial/serial.c ****         flags = RT_DEVICE_FLAG_INT_RX | RT_DEVICE_FLAG_RDWR;
  82:rt-thread/components/drivers/serial/serial.c ****         break;
  83:rt-thread/components/drivers/serial/serial.c ****     default:
  84:rt-thread/components/drivers/serial/serial.c ****         LOG_E("fops open: unknown mode - %d!", fd->flags & O_ACCMODE);
  85:rt-thread/components/drivers/serial/serial.c ****         break;
  86:rt-thread/components/drivers/serial/serial.c ****     }
  87:rt-thread/components/drivers/serial/serial.c **** 
  88:rt-thread/components/drivers/serial/serial.c ****     if ((fd->flags & O_ACCMODE) != O_WRONLY)
  89:rt-thread/components/drivers/serial/serial.c ****         rt_device_set_rx_indicate(device, serial_fops_rx_ind);
ARM GAS  /tmp/ccebIloK.s 			page 3


  90:rt-thread/components/drivers/serial/serial.c ****     ret = rt_device_open(device, flags);
  91:rt-thread/components/drivers/serial/serial.c ****     if (ret == RT_EOK) return 0;
  92:rt-thread/components/drivers/serial/serial.c **** 
  93:rt-thread/components/drivers/serial/serial.c ****     return ret;
  94:rt-thread/components/drivers/serial/serial.c **** }
  95:rt-thread/components/drivers/serial/serial.c **** 
  96:rt-thread/components/drivers/serial/serial.c **** static int serial_fops_close(struct dfs_fd *fd)
  97:rt-thread/components/drivers/serial/serial.c **** {
  98:rt-thread/components/drivers/serial/serial.c ****     rt_device_t device;
  99:rt-thread/components/drivers/serial/serial.c **** 
 100:rt-thread/components/drivers/serial/serial.c ****     device = (rt_device_t)fd->data;
 101:rt-thread/components/drivers/serial/serial.c **** 
 102:rt-thread/components/drivers/serial/serial.c ****     rt_device_set_rx_indicate(device, RT_NULL);
 103:rt-thread/components/drivers/serial/serial.c ****     rt_device_close(device);
 104:rt-thread/components/drivers/serial/serial.c **** 
 105:rt-thread/components/drivers/serial/serial.c ****     return 0;
 106:rt-thread/components/drivers/serial/serial.c **** }
 107:rt-thread/components/drivers/serial/serial.c **** 
 108:rt-thread/components/drivers/serial/serial.c **** static int serial_fops_ioctl(struct dfs_fd *fd, int cmd, void *args)
 109:rt-thread/components/drivers/serial/serial.c **** {
 110:rt-thread/components/drivers/serial/serial.c ****     rt_device_t device;
 111:rt-thread/components/drivers/serial/serial.c **** 
 112:rt-thread/components/drivers/serial/serial.c ****     device = (rt_device_t)fd->data;
 113:rt-thread/components/drivers/serial/serial.c ****     switch (cmd)
 114:rt-thread/components/drivers/serial/serial.c ****     {
 115:rt-thread/components/drivers/serial/serial.c ****     case FIONREAD:
 116:rt-thread/components/drivers/serial/serial.c ****         break;
 117:rt-thread/components/drivers/serial/serial.c ****     case FIONWRITE:
 118:rt-thread/components/drivers/serial/serial.c ****         break;
 119:rt-thread/components/drivers/serial/serial.c ****     }
 120:rt-thread/components/drivers/serial/serial.c **** 
 121:rt-thread/components/drivers/serial/serial.c ****     return rt_device_control(device, cmd, args);
 122:rt-thread/components/drivers/serial/serial.c **** }
 123:rt-thread/components/drivers/serial/serial.c **** 
 124:rt-thread/components/drivers/serial/serial.c **** static int serial_fops_read(struct dfs_fd *fd, void *buf, size_t count)
 125:rt-thread/components/drivers/serial/serial.c **** {
 126:rt-thread/components/drivers/serial/serial.c ****     int size = 0;
 127:rt-thread/components/drivers/serial/serial.c ****     rt_device_t device;
 128:rt-thread/components/drivers/serial/serial.c **** 
 129:rt-thread/components/drivers/serial/serial.c ****     device = (rt_device_t)fd->data;
 130:rt-thread/components/drivers/serial/serial.c **** 
 131:rt-thread/components/drivers/serial/serial.c ****     do
 132:rt-thread/components/drivers/serial/serial.c ****     {
 133:rt-thread/components/drivers/serial/serial.c ****         size = rt_device_read(device, -1,  buf, count);
 134:rt-thread/components/drivers/serial/serial.c ****         if (size <= 0)
 135:rt-thread/components/drivers/serial/serial.c ****         {
 136:rt-thread/components/drivers/serial/serial.c ****             if (fd->flags & O_NONBLOCK)
 137:rt-thread/components/drivers/serial/serial.c ****             {
 138:rt-thread/components/drivers/serial/serial.c ****                 size = -EAGAIN;
 139:rt-thread/components/drivers/serial/serial.c ****                 break;
 140:rt-thread/components/drivers/serial/serial.c ****             }
 141:rt-thread/components/drivers/serial/serial.c **** 
 142:rt-thread/components/drivers/serial/serial.c ****             rt_wqueue_wait(&(device->wait_queue), 0, RT_WAITING_FOREVER);
 143:rt-thread/components/drivers/serial/serial.c ****         }
 144:rt-thread/components/drivers/serial/serial.c ****     }while (size <= 0);
 145:rt-thread/components/drivers/serial/serial.c **** 
 146:rt-thread/components/drivers/serial/serial.c ****     return size;
ARM GAS  /tmp/ccebIloK.s 			page 4


 147:rt-thread/components/drivers/serial/serial.c **** }
 148:rt-thread/components/drivers/serial/serial.c **** 
 149:rt-thread/components/drivers/serial/serial.c **** static int serial_fops_write(struct dfs_fd *fd, const void *buf, size_t count)
 150:rt-thread/components/drivers/serial/serial.c **** {
 151:rt-thread/components/drivers/serial/serial.c ****     rt_device_t device;
 152:rt-thread/components/drivers/serial/serial.c **** 
 153:rt-thread/components/drivers/serial/serial.c ****     device = (rt_device_t)fd->data;
 154:rt-thread/components/drivers/serial/serial.c ****     return rt_device_write(device, -1, buf, count);
 155:rt-thread/components/drivers/serial/serial.c **** }
 156:rt-thread/components/drivers/serial/serial.c **** 
 157:rt-thread/components/drivers/serial/serial.c **** static int serial_fops_poll(struct dfs_fd *fd, struct rt_pollreq *req)
 158:rt-thread/components/drivers/serial/serial.c **** {
 159:rt-thread/components/drivers/serial/serial.c ****     int mask = 0;
 160:rt-thread/components/drivers/serial/serial.c ****     int flags = 0;
 161:rt-thread/components/drivers/serial/serial.c ****     rt_device_t device;
 162:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 163:rt-thread/components/drivers/serial/serial.c **** 
 164:rt-thread/components/drivers/serial/serial.c ****     device = (rt_device_t)fd->data;
 165:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(device != RT_NULL);
 166:rt-thread/components/drivers/serial/serial.c **** 
 167:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)device;
 168:rt-thread/components/drivers/serial/serial.c **** 
 169:rt-thread/components/drivers/serial/serial.c ****     /* only support POLLIN */
 170:rt-thread/components/drivers/serial/serial.c ****     flags = fd->flags & O_ACCMODE;
 171:rt-thread/components/drivers/serial/serial.c ****     if (flags == O_RDONLY || flags == O_RDWR)
 172:rt-thread/components/drivers/serial/serial.c ****     {
 173:rt-thread/components/drivers/serial/serial.c ****         rt_base_t level;
 174:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_rx_fifo* rx_fifo;
 175:rt-thread/components/drivers/serial/serial.c **** 
 176:rt-thread/components/drivers/serial/serial.c ****         rt_poll_add(&(device->wait_queue), req);
 177:rt-thread/components/drivers/serial/serial.c **** 
 178:rt-thread/components/drivers/serial/serial.c ****         rx_fifo = (struct rt_serial_rx_fifo*) serial->serial_rx;
 179:rt-thread/components/drivers/serial/serial.c **** 
 180:rt-thread/components/drivers/serial/serial.c ****         level = rt_hw_interrupt_disable();
 181:rt-thread/components/drivers/serial/serial.c ****         if ((rx_fifo->get_index != rx_fifo->put_index) || (rx_fifo->get_index == rx_fifo->put_index
 182:rt-thread/components/drivers/serial/serial.c ****             mask |= POLLIN;
 183:rt-thread/components/drivers/serial/serial.c ****         rt_hw_interrupt_enable(level);
 184:rt-thread/components/drivers/serial/serial.c ****     }
 185:rt-thread/components/drivers/serial/serial.c **** 
 186:rt-thread/components/drivers/serial/serial.c ****     return mask;
 187:rt-thread/components/drivers/serial/serial.c **** }
 188:rt-thread/components/drivers/serial/serial.c **** 
 189:rt-thread/components/drivers/serial/serial.c **** const static struct dfs_file_ops _serial_fops =
 190:rt-thread/components/drivers/serial/serial.c **** {
 191:rt-thread/components/drivers/serial/serial.c ****     serial_fops_open,
 192:rt-thread/components/drivers/serial/serial.c ****     serial_fops_close,
 193:rt-thread/components/drivers/serial/serial.c ****     serial_fops_ioctl,
 194:rt-thread/components/drivers/serial/serial.c ****     serial_fops_read,
 195:rt-thread/components/drivers/serial/serial.c ****     serial_fops_write,
 196:rt-thread/components/drivers/serial/serial.c ****     RT_NULL, /* flush */
 197:rt-thread/components/drivers/serial/serial.c ****     RT_NULL, /* lseek */
 198:rt-thread/components/drivers/serial/serial.c ****     RT_NULL, /* getdents */
 199:rt-thread/components/drivers/serial/serial.c ****     serial_fops_poll,
 200:rt-thread/components/drivers/serial/serial.c **** };
 201:rt-thread/components/drivers/serial/serial.c **** #endif
 202:rt-thread/components/drivers/serial/serial.c **** 
 203:rt-thread/components/drivers/serial/serial.c **** /*
ARM GAS  /tmp/ccebIloK.s 			page 5


 204:rt-thread/components/drivers/serial/serial.c ****  * Serial poll routines
 205:rt-thread/components/drivers/serial/serial.c ****  */
 206:rt-thread/components/drivers/serial/serial.c **** rt_inline int _serial_poll_rx(struct rt_serial_device *serial, rt_uint8_t *data, int length)
 207:rt-thread/components/drivers/serial/serial.c **** {
 208:rt-thread/components/drivers/serial/serial.c ****     int ch;
 209:rt-thread/components/drivers/serial/serial.c ****     int size;
 210:rt-thread/components/drivers/serial/serial.c **** 
 211:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(serial != RT_NULL);
 212:rt-thread/components/drivers/serial/serial.c ****     size = length;
 213:rt-thread/components/drivers/serial/serial.c **** 
 214:rt-thread/components/drivers/serial/serial.c ****     while (length)
 215:rt-thread/components/drivers/serial/serial.c ****     {
 216:rt-thread/components/drivers/serial/serial.c ****         ch = serial->ops->getc(serial);
 217:rt-thread/components/drivers/serial/serial.c ****         if (ch == -1) break;
 218:rt-thread/components/drivers/serial/serial.c **** 
 219:rt-thread/components/drivers/serial/serial.c ****         *data = ch;
 220:rt-thread/components/drivers/serial/serial.c ****         data ++; length --;
 221:rt-thread/components/drivers/serial/serial.c **** 
 222:rt-thread/components/drivers/serial/serial.c ****         if (ch == '\n') break;
 223:rt-thread/components/drivers/serial/serial.c ****     }
 224:rt-thread/components/drivers/serial/serial.c **** 
 225:rt-thread/components/drivers/serial/serial.c ****     return size - length;
 226:rt-thread/components/drivers/serial/serial.c **** }
 227:rt-thread/components/drivers/serial/serial.c **** 
 228:rt-thread/components/drivers/serial/serial.c **** rt_inline int _serial_poll_tx(struct rt_serial_device *serial, const rt_uint8_t *data, int length)
 229:rt-thread/components/drivers/serial/serial.c **** {
 230:rt-thread/components/drivers/serial/serial.c ****     int size;
 231:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(serial != RT_NULL);
 232:rt-thread/components/drivers/serial/serial.c **** 
 233:rt-thread/components/drivers/serial/serial.c ****     size = length;
 234:rt-thread/components/drivers/serial/serial.c ****     while (length)
 235:rt-thread/components/drivers/serial/serial.c ****     {
 236:rt-thread/components/drivers/serial/serial.c ****         /*
 237:rt-thread/components/drivers/serial/serial.c ****          * to be polite with serial console add a line feed
 238:rt-thread/components/drivers/serial/serial.c ****          * to the carriage return character
 239:rt-thread/components/drivers/serial/serial.c ****          */
 240:rt-thread/components/drivers/serial/serial.c ****         if (*data == '\n' && (serial->parent.open_flag & RT_DEVICE_FLAG_STREAM))
 241:rt-thread/components/drivers/serial/serial.c ****         {
 242:rt-thread/components/drivers/serial/serial.c ****             serial->ops->putc(serial, '\r');
 243:rt-thread/components/drivers/serial/serial.c ****         }
 244:rt-thread/components/drivers/serial/serial.c **** 
 245:rt-thread/components/drivers/serial/serial.c ****         serial->ops->putc(serial, *data);
 246:rt-thread/components/drivers/serial/serial.c **** 
 247:rt-thread/components/drivers/serial/serial.c ****         ++ data;
 248:rt-thread/components/drivers/serial/serial.c ****         -- length;
 249:rt-thread/components/drivers/serial/serial.c ****     }
 250:rt-thread/components/drivers/serial/serial.c **** 
 251:rt-thread/components/drivers/serial/serial.c ****     return size - length;
 252:rt-thread/components/drivers/serial/serial.c **** }
 253:rt-thread/components/drivers/serial/serial.c **** 
 254:rt-thread/components/drivers/serial/serial.c **** /*
 255:rt-thread/components/drivers/serial/serial.c ****  * Serial interrupt routines
 256:rt-thread/components/drivers/serial/serial.c ****  */
 257:rt-thread/components/drivers/serial/serial.c **** rt_inline int _serial_int_rx(struct rt_serial_device *serial, rt_uint8_t *data, int length)
 258:rt-thread/components/drivers/serial/serial.c **** {
 259:rt-thread/components/drivers/serial/serial.c ****     int size;
 260:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_rx_fifo* rx_fifo;
ARM GAS  /tmp/ccebIloK.s 			page 6


 261:rt-thread/components/drivers/serial/serial.c **** 
 262:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(serial != RT_NULL);
 263:rt-thread/components/drivers/serial/serial.c ****     size = length;
 264:rt-thread/components/drivers/serial/serial.c **** 
 265:rt-thread/components/drivers/serial/serial.c ****     rx_fifo = (struct rt_serial_rx_fifo*) serial->serial_rx;
 266:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(rx_fifo != RT_NULL);
 267:rt-thread/components/drivers/serial/serial.c **** 
 268:rt-thread/components/drivers/serial/serial.c ****     /* read from software FIFO */
 269:rt-thread/components/drivers/serial/serial.c ****     while (length)
 270:rt-thread/components/drivers/serial/serial.c ****     {
 271:rt-thread/components/drivers/serial/serial.c ****         int ch;
 272:rt-thread/components/drivers/serial/serial.c ****         rt_base_t level;
 273:rt-thread/components/drivers/serial/serial.c **** 
 274:rt-thread/components/drivers/serial/serial.c ****         /* disable interrupt */
 275:rt-thread/components/drivers/serial/serial.c ****         level = rt_hw_interrupt_disable();
 276:rt-thread/components/drivers/serial/serial.c **** 
 277:rt-thread/components/drivers/serial/serial.c ****         /* there's no data: */
 278:rt-thread/components/drivers/serial/serial.c ****         if ((rx_fifo->get_index == rx_fifo->put_index) && (rx_fifo->is_full == RT_FALSE))
 279:rt-thread/components/drivers/serial/serial.c ****         {
 280:rt-thread/components/drivers/serial/serial.c ****             /* no data, enable interrupt and break out */
 281:rt-thread/components/drivers/serial/serial.c ****             rt_hw_interrupt_enable(level);
 282:rt-thread/components/drivers/serial/serial.c ****             break;
 283:rt-thread/components/drivers/serial/serial.c ****         }
 284:rt-thread/components/drivers/serial/serial.c **** 
 285:rt-thread/components/drivers/serial/serial.c ****         /* otherwise there's the data: */
 286:rt-thread/components/drivers/serial/serial.c ****         ch = rx_fifo->buffer[rx_fifo->get_index];
 287:rt-thread/components/drivers/serial/serial.c ****         rx_fifo->get_index += 1;
 288:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->get_index >= serial->config.bufsz) rx_fifo->get_index = 0;
 289:rt-thread/components/drivers/serial/serial.c **** 
 290:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->is_full == RT_TRUE)
 291:rt-thread/components/drivers/serial/serial.c ****         {
 292:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->is_full = RT_FALSE;
 293:rt-thread/components/drivers/serial/serial.c ****         }
 294:rt-thread/components/drivers/serial/serial.c **** 
 295:rt-thread/components/drivers/serial/serial.c ****         /* enable interrupt */
 296:rt-thread/components/drivers/serial/serial.c ****         rt_hw_interrupt_enable(level);
 297:rt-thread/components/drivers/serial/serial.c **** 
 298:rt-thread/components/drivers/serial/serial.c ****         *data = ch & 0xff;
 299:rt-thread/components/drivers/serial/serial.c ****         data ++; length --;
 300:rt-thread/components/drivers/serial/serial.c ****     }
 301:rt-thread/components/drivers/serial/serial.c **** 
 302:rt-thread/components/drivers/serial/serial.c ****     return size - length;
 303:rt-thread/components/drivers/serial/serial.c **** }
 304:rt-thread/components/drivers/serial/serial.c **** 
 305:rt-thread/components/drivers/serial/serial.c **** rt_inline int _serial_int_tx(struct rt_serial_device *serial, const rt_uint8_t *data, int length)
 306:rt-thread/components/drivers/serial/serial.c **** {
 307:rt-thread/components/drivers/serial/serial.c ****     int size;
 308:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_tx_fifo *tx;
 309:rt-thread/components/drivers/serial/serial.c **** 
 310:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(serial != RT_NULL);
 311:rt-thread/components/drivers/serial/serial.c **** 
 312:rt-thread/components/drivers/serial/serial.c ****     size = length;
 313:rt-thread/components/drivers/serial/serial.c ****     tx = (struct rt_serial_tx_fifo*) serial->serial_tx;
 314:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(tx != RT_NULL);
 315:rt-thread/components/drivers/serial/serial.c **** 
 316:rt-thread/components/drivers/serial/serial.c ****     while (length)
 317:rt-thread/components/drivers/serial/serial.c ****     {
ARM GAS  /tmp/ccebIloK.s 			page 7


 318:rt-thread/components/drivers/serial/serial.c ****         if (serial->ops->putc(serial, *(char*)data) == -1)
 319:rt-thread/components/drivers/serial/serial.c ****         {
 320:rt-thread/components/drivers/serial/serial.c ****             rt_completion_wait(&(tx->completion), RT_WAITING_FOREVER);
 321:rt-thread/components/drivers/serial/serial.c ****             continue;
 322:rt-thread/components/drivers/serial/serial.c ****         }
 323:rt-thread/components/drivers/serial/serial.c **** 
 324:rt-thread/components/drivers/serial/serial.c ****         data ++; length --;
 325:rt-thread/components/drivers/serial/serial.c ****     }
 326:rt-thread/components/drivers/serial/serial.c **** 
 327:rt-thread/components/drivers/serial/serial.c ****     return size - length;
 328:rt-thread/components/drivers/serial/serial.c **** }
 329:rt-thread/components/drivers/serial/serial.c **** 
 330:rt-thread/components/drivers/serial/serial.c **** static void _serial_check_buffer_size(void)
 331:rt-thread/components/drivers/serial/serial.c **** {
  27              		.loc 1 331 0
  28              		.cfi_startproc
  29              		@ args = 0, pretend = 0, frame = 0
  30              		@ frame_needed = 0, uses_anonymous_args = 0
  31              		@ link register save eliminated.
 332:rt-thread/components/drivers/serial/serial.c ****     static rt_bool_t already_output = RT_FALSE;
 333:rt-thread/components/drivers/serial/serial.c **** 		
 334:rt-thread/components/drivers/serial/serial.c ****     if (already_output == RT_FALSE)
  32              		.loc 1 334 0
  33 0000 034B     		ldr	r3, .L3
  34 0002 1B68     		ldr	r3, [r3]
  35 0004 13B9     		cbnz	r3, .L1
 335:rt-thread/components/drivers/serial/serial.c ****     {
 336:rt-thread/components/drivers/serial/serial.c ****         LOG_W("Warning: There is no enough buffer for saving data,"
 337:rt-thread/components/drivers/serial/serial.c ****               " please increase the RT_SERIAL_RB_BUFSZ option.");
 338:rt-thread/components/drivers/serial/serial.c ****         already_output = RT_TRUE;
  36              		.loc 1 338 0
  37 0006 0122     		movs	r2, #1
  38 0008 014B     		ldr	r3, .L3
  39 000a 1A60     		str	r2, [r3]
  40              	.L1:
  41 000c 7047     		bx	lr
  42              	.L4:
  43 000e 00BF     		.align	2
  44              	.L3:
  45 0010 00000000 		.word	.LANCHOR0
  46              		.cfi_endproc
  47              	.LFE23:
  49              		.section	.text._serial_fifo_calc_recved_len,"ax",%progbits
  50              		.align	1
  51              		.syntax unified
  52              		.thumb
  53              		.thumb_func
  54              		.fpu fpv4-sp-d16
  56              	_serial_fifo_calc_recved_len:
  57              	.LFB24:
 339:rt-thread/components/drivers/serial/serial.c ****     }
 340:rt-thread/components/drivers/serial/serial.c **** }	
 341:rt-thread/components/drivers/serial/serial.c **** 
 342:rt-thread/components/drivers/serial/serial.c **** #if defined(RT_USING_POSIX) || defined(RT_SERIAL_USING_DMA)
 343:rt-thread/components/drivers/serial/serial.c **** static rt_size_t _serial_fifo_calc_recved_len(struct rt_serial_device *serial)
 344:rt-thread/components/drivers/serial/serial.c **** {
  58              		.loc 1 344 0
ARM GAS  /tmp/ccebIloK.s 			page 8


  59              		.cfi_startproc
  60              		@ args = 0, pretend = 0, frame = 0
  61              		@ frame_needed = 0, uses_anonymous_args = 0
  62              		@ link register save eliminated.
  63              	.LVL0:
 345:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_rx_fifo *rx_fifo = (struct rt_serial_rx_fifo *) serial->serial_rx;
  64              		.loc 1 345 0
  65 0000 816B     		ldr	r1, [r0, #56]
  66              	.LVL1:
 346:rt-thread/components/drivers/serial/serial.c **** 
 347:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(rx_fifo != RT_NULL);
 348:rt-thread/components/drivers/serial/serial.c **** 
 349:rt-thread/components/drivers/serial/serial.c ****     if (rx_fifo->put_index == rx_fifo->get_index)
  67              		.loc 1 349 0
  68 0002 8A88     		ldrh	r2, [r1, #4]
  69 0004 CB88     		ldrh	r3, [r1, #6]
  70 0006 9A42     		cmp	r2, r3
  71 0008 07D0     		beq	.L10
 350:rt-thread/components/drivers/serial/serial.c ****     {
 351:rt-thread/components/drivers/serial/serial.c ****         return (rx_fifo->is_full == RT_FALSE ? 0 : serial->config.bufsz);
 352:rt-thread/components/drivers/serial/serial.c ****     }
 353:rt-thread/components/drivers/serial/serial.c ****     else
 354:rt-thread/components/drivers/serial/serial.c ****     {
 355:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->put_index > rx_fifo->get_index)
  72              		.loc 1 355 0
  73 000a 9A42     		cmp	r2, r3
  74 000c 0BD8     		bhi	.L11
 356:rt-thread/components/drivers/serial/serial.c ****         {
 357:rt-thread/components/drivers/serial/serial.c ****             return rx_fifo->put_index - rx_fifo->get_index;
 358:rt-thread/components/drivers/serial/serial.c ****         }
 359:rt-thread/components/drivers/serial/serial.c ****         else
 360:rt-thread/components/drivers/serial/serial.c ****         {
 361:rt-thread/components/drivers/serial/serial.c ****             return serial->config.bufsz - (rx_fifo->get_index - rx_fifo->put_index);
  75              		.loc 1 361 0
  76 000e 406B     		ldr	r0, [r0, #52]
  77              	.LVL2:
  78 0010 C0F38F20 		ubfx	r0, r0, #10, #16
  79 0014 9B1A     		subs	r3, r3, r2
  80 0016 C01A     		subs	r0, r0, r3
  81 0018 7047     		bx	lr
  82              	.LVL3:
  83              	.L10:
 351:rt-thread/components/drivers/serial/serial.c ****     }
  84              		.loc 1 351 0
  85 001a 8B68     		ldr	r3, [r1, #8]
  86 001c 2BB1     		cbz	r3, .L9
 351:rt-thread/components/drivers/serial/serial.c ****     }
  87              		.loc 1 351 0 is_stmt 0 discriminator 1
  88 001e 406B     		ldr	r0, [r0, #52]
  89              	.LVL4:
  90 0020 C0F38F20 		ubfx	r0, r0, #10, #16
  91 0024 7047     		bx	lr
  92              	.LVL5:
  93              	.L11:
 357:rt-thread/components/drivers/serial/serial.c ****         }
  94              		.loc 1 357 0 is_stmt 1
  95 0026 D01A     		subs	r0, r2, r3
ARM GAS  /tmp/ccebIloK.s 			page 9


  96              	.LVL6:
  97 0028 7047     		bx	lr
  98              	.LVL7:
  99              	.L9:
 351:rt-thread/components/drivers/serial/serial.c ****     }
 100              		.loc 1 351 0
 101 002a 0020     		movs	r0, #0
 102              	.LVL8:
 362:rt-thread/components/drivers/serial/serial.c ****         }
 363:rt-thread/components/drivers/serial/serial.c ****     }
 364:rt-thread/components/drivers/serial/serial.c **** }
 103              		.loc 1 364 0
 104 002c 7047     		bx	lr
 105              		.cfi_endproc
 106              	.LFE24:
 108              		.section	.text.rt_dma_calc_recved_len,"ax",%progbits
 109              		.align	1
 110              		.syntax unified
 111              		.thumb
 112              		.thumb_func
 113              		.fpu fpv4-sp-d16
 115              	rt_dma_calc_recved_len:
 116              	.LFB25:
 365:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_USING_POSIX || RT_SERIAL_USING_DMA */
 366:rt-thread/components/drivers/serial/serial.c **** 
 367:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 368:rt-thread/components/drivers/serial/serial.c **** /**
 369:rt-thread/components/drivers/serial/serial.c ****  * Calculate DMA received data length.
 370:rt-thread/components/drivers/serial/serial.c ****  *
 371:rt-thread/components/drivers/serial/serial.c ****  * @param serial serial device
 372:rt-thread/components/drivers/serial/serial.c ****  *
 373:rt-thread/components/drivers/serial/serial.c ****  * @return length
 374:rt-thread/components/drivers/serial/serial.c ****  */
 375:rt-thread/components/drivers/serial/serial.c **** static rt_size_t rt_dma_calc_recved_len(struct rt_serial_device *serial)
 376:rt-thread/components/drivers/serial/serial.c **** {
 117              		.loc 1 376 0
 118              		.cfi_startproc
 119              		@ args = 0, pretend = 0, frame = 0
 120              		@ frame_needed = 0, uses_anonymous_args = 0
 121              	.LVL9:
 122 0000 08B5     		push	{r3, lr}
 123              	.LCFI0:
 124              		.cfi_def_cfa_offset 8
 125              		.cfi_offset 3, -8
 126              		.cfi_offset 14, -4
 377:rt-thread/components/drivers/serial/serial.c ****     return _serial_fifo_calc_recved_len(serial);
 127              		.loc 1 377 0
 128 0002 FFF7FEFF 		bl	_serial_fifo_calc_recved_len
 129              	.LVL10:
 378:rt-thread/components/drivers/serial/serial.c **** }
 130              		.loc 1 378 0
 131 0006 08BD     		pop	{r3, pc}
 132              		.cfi_endproc
 133              	.LFE25:
 135              		.section	.text.rt_dma_recv_update_get_index,"ax",%progbits
 136              		.align	1
 137              		.syntax unified
ARM GAS  /tmp/ccebIloK.s 			page 10


 138              		.thumb
 139              		.thumb_func
 140              		.fpu fpv4-sp-d16
 142              	rt_dma_recv_update_get_index:
 143              	.LFB26:
 379:rt-thread/components/drivers/serial/serial.c **** 
 380:rt-thread/components/drivers/serial/serial.c **** /**
 381:rt-thread/components/drivers/serial/serial.c ****  * Read data finish by DMA mode then update the get index for receive fifo.
 382:rt-thread/components/drivers/serial/serial.c ****  *
 383:rt-thread/components/drivers/serial/serial.c ****  * @param serial serial device
 384:rt-thread/components/drivers/serial/serial.c ****  * @param len get data length for this operate
 385:rt-thread/components/drivers/serial/serial.c ****  */
 386:rt-thread/components/drivers/serial/serial.c **** static void rt_dma_recv_update_get_index(struct rt_serial_device *serial, rt_size_t len)
 387:rt-thread/components/drivers/serial/serial.c **** {
 144              		.loc 1 387 0
 145              		.cfi_startproc
 146              		@ args = 0, pretend = 0, frame = 0
 147              		@ frame_needed = 0, uses_anonymous_args = 0
 148              		@ link register save eliminated.
 149              	.LVL11:
 388:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_rx_fifo *rx_fifo = (struct rt_serial_rx_fifo *) serial->serial_rx;
 150              		.loc 1 388 0
 151 0000 826B     		ldr	r2, [r0, #56]
 152              	.LVL12:
 389:rt-thread/components/drivers/serial/serial.c **** 
 390:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(rx_fifo != RT_NULL);
 391:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(len <= rt_dma_calc_recved_len(serial));
 392:rt-thread/components/drivers/serial/serial.c **** 
 393:rt-thread/components/drivers/serial/serial.c ****     if (rx_fifo->is_full && len != 0) rx_fifo->is_full = RT_FALSE;
 153              		.loc 1 393 0
 154 0002 9368     		ldr	r3, [r2, #8]
 155 0004 13B1     		cbz	r3, .L15
 156              		.loc 1 393 0 is_stmt 0 discriminator 1
 157 0006 09B1     		cbz	r1, .L15
 158              		.loc 1 393 0 discriminator 2
 159 0008 0023     		movs	r3, #0
 160 000a 9360     		str	r3, [r2, #8]
 161              	.L15:
 394:rt-thread/components/drivers/serial/serial.c **** 
 395:rt-thread/components/drivers/serial/serial.c ****     rx_fifo->get_index += len;
 162              		.loc 1 395 0 is_stmt 1
 163 000c D388     		ldrh	r3, [r2, #6]
 164 000e 1944     		add	r1, r1, r3
 165              	.LVL13:
 166 0010 89B2     		uxth	r1, r1
 167 0012 D180     		strh	r1, [r2, #6]	@ movhi
 396:rt-thread/components/drivers/serial/serial.c ****     if (rx_fifo->get_index >= serial->config.bufsz)
 168              		.loc 1 396 0
 169 0014 436B     		ldr	r3, [r0, #52]
 170 0016 C3F38F23 		ubfx	r3, r3, #10, #16
 171 001a 9942     		cmp	r1, r3
 172 001c 04D3     		bcc	.L14
 397:rt-thread/components/drivers/serial/serial.c ****     {
 398:rt-thread/components/drivers/serial/serial.c ****         rx_fifo->get_index %= serial->config.bufsz;
 173              		.loc 1 398 0
 174 001e B1FBF3F0 		udiv	r0, r1, r3
 175              	.LVL14:
ARM GAS  /tmp/ccebIloK.s 			page 11


 176 0022 03FB1011 		mls	r1, r3, r0, r1
 177 0026 D180     		strh	r1, [r2, #6]	@ movhi
 178              	.L14:
 179 0028 7047     		bx	lr
 180              		.cfi_endproc
 181              	.LFE26:
 183              		.section	.text.rt_dma_recv_update_put_index,"ax",%progbits
 184              		.align	1
 185              		.syntax unified
 186              		.thumb
 187              		.thumb_func
 188              		.fpu fpv4-sp-d16
 190              	rt_dma_recv_update_put_index:
 191              	.LFB27:
 399:rt-thread/components/drivers/serial/serial.c ****     }
 400:rt-thread/components/drivers/serial/serial.c **** }
 401:rt-thread/components/drivers/serial/serial.c **** 
 402:rt-thread/components/drivers/serial/serial.c **** /**
 403:rt-thread/components/drivers/serial/serial.c ****  * DMA received finish then update put index for receive fifo.
 404:rt-thread/components/drivers/serial/serial.c ****  *
 405:rt-thread/components/drivers/serial/serial.c ****  * @param serial serial device
 406:rt-thread/components/drivers/serial/serial.c ****  * @param len received length for this transmit
 407:rt-thread/components/drivers/serial/serial.c ****  */
 408:rt-thread/components/drivers/serial/serial.c **** static void rt_dma_recv_update_put_index(struct rt_serial_device *serial, rt_size_t len)
 409:rt-thread/components/drivers/serial/serial.c **** {
 192              		.loc 1 409 0
 193              		.cfi_startproc
 194              		@ args = 0, pretend = 0, frame = 0
 195              		@ frame_needed = 0, uses_anonymous_args = 0
 196              	.LVL15:
 197 0000 10B5     		push	{r4, lr}
 198              	.LCFI1:
 199              		.cfi_def_cfa_offset 8
 200              		.cfi_offset 4, -8
 201              		.cfi_offset 14, -4
 410:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_rx_fifo *rx_fifo = (struct rt_serial_rx_fifo *)serial->serial_rx;
 202              		.loc 1 410 0
 203 0002 846B     		ldr	r4, [r0, #56]
 204              	.LVL16:
 411:rt-thread/components/drivers/serial/serial.c **** 
 412:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(rx_fifo != RT_NULL);
 413:rt-thread/components/drivers/serial/serial.c **** 
 414:rt-thread/components/drivers/serial/serial.c ****     if (rx_fifo->get_index <= rx_fifo->put_index)
 205              		.loc 1 414 0
 206 0004 E288     		ldrh	r2, [r4, #6]
 207 0006 A388     		ldrh	r3, [r4, #4]
 208 0008 9A42     		cmp	r2, r3
 209 000a 12D8     		bhi	.L18
 415:rt-thread/components/drivers/serial/serial.c ****     {
 416:rt-thread/components/drivers/serial/serial.c ****         rx_fifo->put_index += len;
 210              		.loc 1 416 0
 211 000c 0B44     		add	r3, r3, r1
 212 000e 9BB2     		uxth	r3, r3
 213 0010 A380     		strh	r3, [r4, #4]	@ movhi
 417:rt-thread/components/drivers/serial/serial.c ****         /* beyond the fifo end */
 418:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->put_index >= serial->config.bufsz)
 214              		.loc 1 418 0
ARM GAS  /tmp/ccebIloK.s 			page 12


 215 0012 416B     		ldr	r1, [r0, #52]
 216              	.LVL17:
 217 0014 C1F38F21 		ubfx	r1, r1, #10, #16
 218 0018 8B42     		cmp	r3, r1
 219 001a 1BD3     		bcc	.L19
 419:rt-thread/components/drivers/serial/serial.c ****         {
 420:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->put_index %= serial->config.bufsz;
 220              		.loc 1 420 0
 221 001c B3FBF1F0 		udiv	r0, r3, r1
 222              	.LVL18:
 223 0020 01FB1033 		mls	r3, r1, r0, r3
 224 0024 9BB2     		uxth	r3, r3
 225 0026 A380     		strh	r3, [r4, #4]	@ movhi
 421:rt-thread/components/drivers/serial/serial.c ****             /* force overwrite get index */
 422:rt-thread/components/drivers/serial/serial.c ****             if (rx_fifo->put_index >= rx_fifo->get_index)
 226              		.loc 1 422 0
 227 0028 9A42     		cmp	r2, r3
 228 002a 13D8     		bhi	.L19
 423:rt-thread/components/drivers/serial/serial.c ****             {
 424:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->is_full = RT_TRUE;
 229              		.loc 1 424 0
 230 002c 0123     		movs	r3, #1
 231 002e A360     		str	r3, [r4, #8]
 232 0030 10E0     		b	.L19
 233              	.LVL19:
 234              	.L18:
 425:rt-thread/components/drivers/serial/serial.c ****             }
 426:rt-thread/components/drivers/serial/serial.c ****         }
 427:rt-thread/components/drivers/serial/serial.c ****     }
 428:rt-thread/components/drivers/serial/serial.c ****     else
 429:rt-thread/components/drivers/serial/serial.c ****     {
 430:rt-thread/components/drivers/serial/serial.c ****         rx_fifo->put_index += len;
 235              		.loc 1 430 0
 236 0032 0B44     		add	r3, r3, r1
 237 0034 9BB2     		uxth	r3, r3
 238 0036 A380     		strh	r3, [r4, #4]	@ movhi
 431:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->put_index >= rx_fifo->get_index)
 239              		.loc 1 431 0
 240 0038 9A42     		cmp	r2, r3
 241 003a 0BD8     		bhi	.L19
 432:rt-thread/components/drivers/serial/serial.c ****         {
 433:rt-thread/components/drivers/serial/serial.c ****             /* beyond the fifo end */
 434:rt-thread/components/drivers/serial/serial.c ****             if (rx_fifo->put_index >= serial->config.bufsz)
 242              		.loc 1 434 0
 243 003c 426B     		ldr	r2, [r0, #52]
 244 003e C2F38F22 		ubfx	r2, r2, #10, #16
 245 0042 9342     		cmp	r3, r2
 246 0044 04D3     		bcc	.L20
 435:rt-thread/components/drivers/serial/serial.c ****             {
 436:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->put_index %= serial->config.bufsz;
 247              		.loc 1 436 0
 248 0046 B3FBF2F1 		udiv	r1, r3, r2
 249              	.LVL20:
 250 004a 02FB1133 		mls	r3, r2, r1, r3
 251 004e A380     		strh	r3, [r4, #4]	@ movhi
 252              	.L20:
 437:rt-thread/components/drivers/serial/serial.c ****             }
ARM GAS  /tmp/ccebIloK.s 			page 13


 438:rt-thread/components/drivers/serial/serial.c ****             /* force overwrite get index */
 439:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->is_full = RT_TRUE;
 253              		.loc 1 439 0
 254 0050 0123     		movs	r3, #1
 255 0052 A360     		str	r3, [r4, #8]
 256              	.LVL21:
 257              	.L19:
 440:rt-thread/components/drivers/serial/serial.c ****         }
 441:rt-thread/components/drivers/serial/serial.c ****     }
 442:rt-thread/components/drivers/serial/serial.c ****     
 443:rt-thread/components/drivers/serial/serial.c ****     if(rx_fifo->is_full == RT_TRUE)
 258              		.loc 1 443 0
 259 0054 A368     		ldr	r3, [r4, #8]
 260 0056 012B     		cmp	r3, #1
 261 0058 00D0     		beq	.L23
 262              	.L17:
 263 005a 10BD     		pop	{r4, pc}
 264              	.LVL22:
 265              	.L23:
 444:rt-thread/components/drivers/serial/serial.c ****     {
 445:rt-thread/components/drivers/serial/serial.c ****         _serial_check_buffer_size();
 266              		.loc 1 445 0
 267 005c FFF7FEFF 		bl	_serial_check_buffer_size
 268              	.LVL23:
 446:rt-thread/components/drivers/serial/serial.c ****         rx_fifo->get_index = rx_fifo->put_index;
 269              		.loc 1 446 0
 270 0060 A388     		ldrh	r3, [r4, #4]
 271 0062 E380     		strh	r3, [r4, #6]	@ movhi
 447:rt-thread/components/drivers/serial/serial.c ****     }
 448:rt-thread/components/drivers/serial/serial.c **** }
 272              		.loc 1 448 0
 273 0064 F9E7     		b	.L17
 274              		.cfi_endproc
 275              	.LFE27:
 277              		.section	.text.rt_serial_init,"ax",%progbits
 278              		.align	1
 279              		.syntax unified
 280              		.thumb
 281              		.thumb_func
 282              		.fpu fpv4-sp-d16
 284              	rt_serial_init:
 285              	.LFB30:
 449:rt-thread/components/drivers/serial/serial.c **** 
 450:rt-thread/components/drivers/serial/serial.c **** /*
 451:rt-thread/components/drivers/serial/serial.c ****  * Serial DMA routines
 452:rt-thread/components/drivers/serial/serial.c ****  */
 453:rt-thread/components/drivers/serial/serial.c **** rt_inline int _serial_dma_rx(struct rt_serial_device *serial, rt_uint8_t *data, int length)
 454:rt-thread/components/drivers/serial/serial.c **** {
 455:rt-thread/components/drivers/serial/serial.c ****     rt_base_t level;
 456:rt-thread/components/drivers/serial/serial.c **** 
 457:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT((serial != RT_NULL) && (data != RT_NULL));
 458:rt-thread/components/drivers/serial/serial.c **** 
 459:rt-thread/components/drivers/serial/serial.c ****     level = rt_hw_interrupt_disable();
 460:rt-thread/components/drivers/serial/serial.c **** 
 461:rt-thread/components/drivers/serial/serial.c ****     if (serial->config.bufsz == 0)
 462:rt-thread/components/drivers/serial/serial.c ****     {
 463:rt-thread/components/drivers/serial/serial.c ****         int result = RT_EOK;
ARM GAS  /tmp/ccebIloK.s 			page 14


 464:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_rx_dma *rx_dma;
 465:rt-thread/components/drivers/serial/serial.c **** 
 466:rt-thread/components/drivers/serial/serial.c ****         rx_dma = (struct rt_serial_rx_dma*)serial->serial_rx;
 467:rt-thread/components/drivers/serial/serial.c ****         RT_ASSERT(rx_dma != RT_NULL);
 468:rt-thread/components/drivers/serial/serial.c **** 
 469:rt-thread/components/drivers/serial/serial.c ****         if (rx_dma->activated != RT_TRUE)
 470:rt-thread/components/drivers/serial/serial.c ****         {
 471:rt-thread/components/drivers/serial/serial.c ****             rx_dma->activated = RT_TRUE;
 472:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(serial->ops->dma_transmit != RT_NULL);
 473:rt-thread/components/drivers/serial/serial.c ****             serial->ops->dma_transmit(serial, data, length, RT_SERIAL_DMA_RX);
 474:rt-thread/components/drivers/serial/serial.c ****         }
 475:rt-thread/components/drivers/serial/serial.c ****         else result = -RT_EBUSY;
 476:rt-thread/components/drivers/serial/serial.c ****         rt_hw_interrupt_enable(level);
 477:rt-thread/components/drivers/serial/serial.c **** 
 478:rt-thread/components/drivers/serial/serial.c ****         if (result == RT_EOK) return length;
 479:rt-thread/components/drivers/serial/serial.c **** 
 480:rt-thread/components/drivers/serial/serial.c ****         rt_set_errno(result);
 481:rt-thread/components/drivers/serial/serial.c ****         return 0;
 482:rt-thread/components/drivers/serial/serial.c ****     }
 483:rt-thread/components/drivers/serial/serial.c ****     else
 484:rt-thread/components/drivers/serial/serial.c ****     {
 485:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_rx_fifo *rx_fifo = (struct rt_serial_rx_fifo *) serial->serial_rx;
 486:rt-thread/components/drivers/serial/serial.c ****         rt_size_t recv_len = 0, fifo_recved_len = rt_dma_calc_recved_len(serial);
 487:rt-thread/components/drivers/serial/serial.c **** 
 488:rt-thread/components/drivers/serial/serial.c ****         RT_ASSERT(rx_fifo != RT_NULL);
 489:rt-thread/components/drivers/serial/serial.c **** 
 490:rt-thread/components/drivers/serial/serial.c ****         if (length < (int)fifo_recved_len)
 491:rt-thread/components/drivers/serial/serial.c ****             recv_len = length;
 492:rt-thread/components/drivers/serial/serial.c ****         else
 493:rt-thread/components/drivers/serial/serial.c ****             recv_len = fifo_recved_len;
 494:rt-thread/components/drivers/serial/serial.c **** 
 495:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->get_index + recv_len < serial->config.bufsz)
 496:rt-thread/components/drivers/serial/serial.c ****             rt_memcpy(data, rx_fifo->buffer + rx_fifo->get_index, recv_len);
 497:rt-thread/components/drivers/serial/serial.c ****         else
 498:rt-thread/components/drivers/serial/serial.c ****         {
 499:rt-thread/components/drivers/serial/serial.c ****             rt_memcpy(data, rx_fifo->buffer + rx_fifo->get_index,
 500:rt-thread/components/drivers/serial/serial.c ****                     serial->config.bufsz - rx_fifo->get_index);
 501:rt-thread/components/drivers/serial/serial.c ****             rt_memcpy(data + serial->config.bufsz - rx_fifo->get_index, rx_fifo->buffer,
 502:rt-thread/components/drivers/serial/serial.c ****                     recv_len + rx_fifo->get_index - serial->config.bufsz);
 503:rt-thread/components/drivers/serial/serial.c ****         }
 504:rt-thread/components/drivers/serial/serial.c ****         rt_dma_recv_update_get_index(serial, recv_len);
 505:rt-thread/components/drivers/serial/serial.c ****         rt_hw_interrupt_enable(level);
 506:rt-thread/components/drivers/serial/serial.c ****         return recv_len;
 507:rt-thread/components/drivers/serial/serial.c ****     }
 508:rt-thread/components/drivers/serial/serial.c **** }
 509:rt-thread/components/drivers/serial/serial.c **** 
 510:rt-thread/components/drivers/serial/serial.c **** rt_inline int _serial_dma_tx(struct rt_serial_device *serial, const rt_uint8_t *data, int length)
 511:rt-thread/components/drivers/serial/serial.c **** {
 512:rt-thread/components/drivers/serial/serial.c ****     rt_base_t level;
 513:rt-thread/components/drivers/serial/serial.c ****     rt_err_t result;
 514:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_tx_dma *tx_dma;
 515:rt-thread/components/drivers/serial/serial.c **** 
 516:rt-thread/components/drivers/serial/serial.c ****     tx_dma = (struct rt_serial_tx_dma*)(serial->serial_tx);
 517:rt-thread/components/drivers/serial/serial.c **** 
 518:rt-thread/components/drivers/serial/serial.c ****     result = rt_data_queue_push(&(tx_dma->data_queue), data, length, RT_WAITING_FOREVER);
 519:rt-thread/components/drivers/serial/serial.c ****     if (result == RT_EOK)
 520:rt-thread/components/drivers/serial/serial.c ****     {
ARM GAS  /tmp/ccebIloK.s 			page 15


 521:rt-thread/components/drivers/serial/serial.c ****         level = rt_hw_interrupt_disable();
 522:rt-thread/components/drivers/serial/serial.c ****         if (tx_dma->activated != RT_TRUE)
 523:rt-thread/components/drivers/serial/serial.c ****         {
 524:rt-thread/components/drivers/serial/serial.c ****             tx_dma->activated = RT_TRUE;
 525:rt-thread/components/drivers/serial/serial.c ****             rt_hw_interrupt_enable(level);
 526:rt-thread/components/drivers/serial/serial.c **** 
 527:rt-thread/components/drivers/serial/serial.c ****             /* make a DMA transfer */
 528:rt-thread/components/drivers/serial/serial.c ****             serial->ops->dma_transmit(serial, (rt_uint8_t *)data, length, RT_SERIAL_DMA_TX);
 529:rt-thread/components/drivers/serial/serial.c ****         }
 530:rt-thread/components/drivers/serial/serial.c ****         else
 531:rt-thread/components/drivers/serial/serial.c ****         {
 532:rt-thread/components/drivers/serial/serial.c ****             rt_hw_interrupt_enable(level);
 533:rt-thread/components/drivers/serial/serial.c ****         }
 534:rt-thread/components/drivers/serial/serial.c **** 
 535:rt-thread/components/drivers/serial/serial.c ****         return length;
 536:rt-thread/components/drivers/serial/serial.c ****     }
 537:rt-thread/components/drivers/serial/serial.c ****     else
 538:rt-thread/components/drivers/serial/serial.c ****     {
 539:rt-thread/components/drivers/serial/serial.c ****         rt_set_errno(result);
 540:rt-thread/components/drivers/serial/serial.c ****         return 0;
 541:rt-thread/components/drivers/serial/serial.c ****     }
 542:rt-thread/components/drivers/serial/serial.c **** }
 543:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
 544:rt-thread/components/drivers/serial/serial.c **** 
 545:rt-thread/components/drivers/serial/serial.c **** /* RT-Thread Device Interface */
 546:rt-thread/components/drivers/serial/serial.c **** /*
 547:rt-thread/components/drivers/serial/serial.c ****  * This function initializes serial device.
 548:rt-thread/components/drivers/serial/serial.c ****  */
 549:rt-thread/components/drivers/serial/serial.c **** static rt_err_t rt_serial_init(struct rt_device *dev)
 550:rt-thread/components/drivers/serial/serial.c **** {
 286              		.loc 1 550 0
 287              		.cfi_startproc
 288              		@ args = 0, pretend = 0, frame = 0
 289              		@ frame_needed = 0, uses_anonymous_args = 0
 290              	.LVL24:
 291 0000 08B5     		push	{r3, lr}
 292              	.LCFI2:
 293              		.cfi_def_cfa_offset 8
 294              		.cfi_offset 3, -8
 295              		.cfi_offset 14, -4
 296              	.LVL25:
 551:rt-thread/components/drivers/serial/serial.c ****     rt_err_t result = RT_EOK;
 552:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 553:rt-thread/components/drivers/serial/serial.c **** 
 554:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(dev != RT_NULL);
 555:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)dev;
 556:rt-thread/components/drivers/serial/serial.c **** 
 557:rt-thread/components/drivers/serial/serial.c ****     /* initialize rx/tx */
 558:rt-thread/components/drivers/serial/serial.c ****     serial->serial_rx = RT_NULL;
 297              		.loc 1 558 0
 298 0002 0023     		movs	r3, #0
 299 0004 8363     		str	r3, [r0, #56]
 559:rt-thread/components/drivers/serial/serial.c ****     serial->serial_tx = RT_NULL;
 300              		.loc 1 559 0
 301 0006 C363     		str	r3, [r0, #60]
 560:rt-thread/components/drivers/serial/serial.c **** 
 561:rt-thread/components/drivers/serial/serial.c ****     /* apply configuration */
ARM GAS  /tmp/ccebIloK.s 			page 16


 562:rt-thread/components/drivers/serial/serial.c ****     if (serial->ops->configure)
 302              		.loc 1 562 0
 303 0008 C36A     		ldr	r3, [r0, #44]
 304 000a 1B68     		ldr	r3, [r3]
 305 000c 1BB1     		cbz	r3, .L26
 563:rt-thread/components/drivers/serial/serial.c ****         result = serial->ops->configure(serial, &serial->config);
 306              		.loc 1 563 0
 307 000e 00F13001 		add	r1, r0, #48
 308 0012 9847     		blx	r3
 309              	.LVL26:
 310 0014 08BD     		pop	{r3, pc}
 311              	.LVL27:
 312              	.L26:
 551:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 313              		.loc 1 551 0
 314 0016 0020     		movs	r0, #0
 315              	.LVL28:
 564:rt-thread/components/drivers/serial/serial.c **** 
 565:rt-thread/components/drivers/serial/serial.c ****     return result;
 566:rt-thread/components/drivers/serial/serial.c **** }
 316              		.loc 1 566 0
 317 0018 08BD     		pop	{r3, pc}
 318              		.cfi_endproc
 319              	.LFE30:
 321              		.section	.text.rt_serial_control,"ax",%progbits
 322              		.align	1
 323              		.syntax unified
 324              		.thumb
 325              		.thumb_func
 326              		.fpu fpv4-sp-d16
 328              	rt_serial_control:
 329              	.LFB35:
 567:rt-thread/components/drivers/serial/serial.c **** 
 568:rt-thread/components/drivers/serial/serial.c **** static rt_err_t rt_serial_open(struct rt_device *dev, rt_uint16_t oflag)
 569:rt-thread/components/drivers/serial/serial.c **** {
 570:rt-thread/components/drivers/serial/serial.c ****     rt_uint16_t stream_flag = 0;
 571:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 572:rt-thread/components/drivers/serial/serial.c **** 
 573:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(dev != RT_NULL);
 574:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)dev;
 575:rt-thread/components/drivers/serial/serial.c **** 
 576:rt-thread/components/drivers/serial/serial.c ****     LOG_D("open serial device: 0x%08x with open flag: 0x%04x",
 577:rt-thread/components/drivers/serial/serial.c ****         dev, oflag);
 578:rt-thread/components/drivers/serial/serial.c ****     /* check device flag with the open flag */
 579:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_DMA_RX) && !(dev->flag & RT_DEVICE_FLAG_DMA_RX))
 580:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 581:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_DMA_TX) && !(dev->flag & RT_DEVICE_FLAG_DMA_TX))
 582:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 583:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_INT_RX) && !(dev->flag & RT_DEVICE_FLAG_INT_RX))
 584:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 585:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_INT_TX) && !(dev->flag & RT_DEVICE_FLAG_INT_TX))
 586:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 587:rt-thread/components/drivers/serial/serial.c **** 
 588:rt-thread/components/drivers/serial/serial.c ****     /* keep steam flag */
 589:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_STREAM) || (dev->open_flag & RT_DEVICE_FLAG_STREAM))
 590:rt-thread/components/drivers/serial/serial.c ****         stream_flag = RT_DEVICE_FLAG_STREAM;
 591:rt-thread/components/drivers/serial/serial.c **** 
ARM GAS  /tmp/ccebIloK.s 			page 17


 592:rt-thread/components/drivers/serial/serial.c ****     /* get open flags */
 593:rt-thread/components/drivers/serial/serial.c ****     dev->open_flag = oflag & 0xff;
 594:rt-thread/components/drivers/serial/serial.c **** 
 595:rt-thread/components/drivers/serial/serial.c ****     /* initialize the Rx/Tx structure according to open flag */
 596:rt-thread/components/drivers/serial/serial.c ****     if (serial->serial_rx == RT_NULL)
 597:rt-thread/components/drivers/serial/serial.c ****     { 
 598:rt-thread/components/drivers/serial/serial.c ****         if (oflag & RT_DEVICE_FLAG_INT_RX)
 599:rt-thread/components/drivers/serial/serial.c ****         {
 600:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_rx_fifo* rx_fifo;
 601:rt-thread/components/drivers/serial/serial.c **** 
 602:rt-thread/components/drivers/serial/serial.c ****             rx_fifo = (struct rt_serial_rx_fifo*) rt_malloc (sizeof(struct rt_serial_rx_fifo) +
 603:rt-thread/components/drivers/serial/serial.c ****                 serial->config.bufsz);
 604:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(rx_fifo != RT_NULL);
 605:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->buffer = (rt_uint8_t*) (rx_fifo + 1);
 606:rt-thread/components/drivers/serial/serial.c ****             rt_memset(rx_fifo->buffer, 0, serial->config.bufsz);
 607:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->put_index = 0;
 608:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->get_index = 0;
 609:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->is_full = RT_FALSE;
 610:rt-thread/components/drivers/serial/serial.c **** 
 611:rt-thread/components/drivers/serial/serial.c ****             serial->serial_rx = rx_fifo;
 612:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_RX;
 613:rt-thread/components/drivers/serial/serial.c ****             /* configure low level device */
 614:rt-thread/components/drivers/serial/serial.c ****             serial->ops->control(serial, RT_DEVICE_CTRL_SET_INT, (void *)RT_DEVICE_FLAG_INT_RX);
 615:rt-thread/components/drivers/serial/serial.c ****         }
 616:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA        
 617:rt-thread/components/drivers/serial/serial.c ****         else if (oflag & RT_DEVICE_FLAG_DMA_RX)
 618:rt-thread/components/drivers/serial/serial.c ****         {
 619:rt-thread/components/drivers/serial/serial.c ****             if (serial->config.bufsz == 0) {
 620:rt-thread/components/drivers/serial/serial.c ****                 struct rt_serial_rx_dma* rx_dma;
 621:rt-thread/components/drivers/serial/serial.c **** 
 622:rt-thread/components/drivers/serial/serial.c ****                 rx_dma = (struct rt_serial_rx_dma*) rt_malloc (sizeof(struct rt_serial_rx_dma));
 623:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(rx_dma != RT_NULL);
 624:rt-thread/components/drivers/serial/serial.c ****                 rx_dma->activated = RT_FALSE;
 625:rt-thread/components/drivers/serial/serial.c **** 
 626:rt-thread/components/drivers/serial/serial.c ****                 serial->serial_rx = rx_dma;
 627:rt-thread/components/drivers/serial/serial.c ****             } else {
 628:rt-thread/components/drivers/serial/serial.c ****                 struct rt_serial_rx_fifo* rx_fifo;
 629:rt-thread/components/drivers/serial/serial.c **** 
 630:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo = (struct rt_serial_rx_fifo*) rt_malloc (sizeof(struct rt_serial_rx_fifo) +
 631:rt-thread/components/drivers/serial/serial.c ****                     serial->config.bufsz);
 632:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(rx_fifo != RT_NULL);
 633:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->buffer = (rt_uint8_t*) (rx_fifo + 1);
 634:rt-thread/components/drivers/serial/serial.c ****                 rt_memset(rx_fifo->buffer, 0, serial->config.bufsz);
 635:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->put_index = 0;
 636:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->get_index = 0;
 637:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->is_full = RT_FALSE;
 638:rt-thread/components/drivers/serial/serial.c ****                 serial->serial_rx = rx_fifo;
 639:rt-thread/components/drivers/serial/serial.c ****                 /* configure fifo address and length to low level device */
 640:rt-thread/components/drivers/serial/serial.c ****                 serial->ops->control(serial, RT_DEVICE_CTRL_CONFIG, (void *) RT_DEVICE_FLAG_DMA_RX)
 641:rt-thread/components/drivers/serial/serial.c ****             }
 642:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_DMA_RX;
 643:rt-thread/components/drivers/serial/serial.c ****         }
 644:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
 645:rt-thread/components/drivers/serial/serial.c ****         else
 646:rt-thread/components/drivers/serial/serial.c ****         {
 647:rt-thread/components/drivers/serial/serial.c ****             serial->serial_rx = RT_NULL;
 648:rt-thread/components/drivers/serial/serial.c ****         }
ARM GAS  /tmp/ccebIloK.s 			page 18


 649:rt-thread/components/drivers/serial/serial.c ****     }
 650:rt-thread/components/drivers/serial/serial.c ****     else
 651:rt-thread/components/drivers/serial/serial.c ****     {
 652:rt-thread/components/drivers/serial/serial.c ****         if (oflag & RT_DEVICE_FLAG_INT_RX)
 653:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_RX;
 654:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 655:rt-thread/components/drivers/serial/serial.c ****         else if (oflag & RT_DEVICE_FLAG_DMA_RX)
 656:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_DMA_RX;
 657:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */  
 658:rt-thread/components/drivers/serial/serial.c ****     }
 659:rt-thread/components/drivers/serial/serial.c **** 
 660:rt-thread/components/drivers/serial/serial.c ****     if (serial->serial_tx == RT_NULL)
 661:rt-thread/components/drivers/serial/serial.c ****     {
 662:rt-thread/components/drivers/serial/serial.c ****         if (oflag & RT_DEVICE_FLAG_INT_TX)
 663:rt-thread/components/drivers/serial/serial.c ****         {
 664:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_tx_fifo *tx_fifo;
 665:rt-thread/components/drivers/serial/serial.c **** 
 666:rt-thread/components/drivers/serial/serial.c ****             tx_fifo = (struct rt_serial_tx_fifo*) rt_malloc(sizeof(struct rt_serial_tx_fifo));
 667:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(tx_fifo != RT_NULL);
 668:rt-thread/components/drivers/serial/serial.c **** 
 669:rt-thread/components/drivers/serial/serial.c ****             rt_completion_init(&(tx_fifo->completion));
 670:rt-thread/components/drivers/serial/serial.c ****             serial->serial_tx = tx_fifo;
 671:rt-thread/components/drivers/serial/serial.c **** 
 672:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_TX;
 673:rt-thread/components/drivers/serial/serial.c ****             /* configure low level device */
 674:rt-thread/components/drivers/serial/serial.c ****             serial->ops->control(serial, RT_DEVICE_CTRL_SET_INT, (void *)RT_DEVICE_FLAG_INT_TX);
 675:rt-thread/components/drivers/serial/serial.c ****         }
 676:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 677:rt-thread/components/drivers/serial/serial.c ****         else if (oflag & RT_DEVICE_FLAG_DMA_TX)
 678:rt-thread/components/drivers/serial/serial.c ****         {
 679:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_tx_dma* tx_dma;
 680:rt-thread/components/drivers/serial/serial.c **** 
 681:rt-thread/components/drivers/serial/serial.c ****             tx_dma = (struct rt_serial_tx_dma*) rt_malloc (sizeof(struct rt_serial_tx_dma));
 682:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(tx_dma != RT_NULL);
 683:rt-thread/components/drivers/serial/serial.c ****             tx_dma->activated = RT_FALSE;
 684:rt-thread/components/drivers/serial/serial.c **** 
 685:rt-thread/components/drivers/serial/serial.c ****             rt_data_queue_init(&(tx_dma->data_queue), 8, 4, RT_NULL);
 686:rt-thread/components/drivers/serial/serial.c ****             serial->serial_tx = tx_dma;
 687:rt-thread/components/drivers/serial/serial.c **** 
 688:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_DMA_TX;
 689:rt-thread/components/drivers/serial/serial.c ****             /* configure low level device */
 690:rt-thread/components/drivers/serial/serial.c ****             serial->ops->control(serial, RT_DEVICE_CTRL_CONFIG, (void *)RT_DEVICE_FLAG_DMA_TX);
 691:rt-thread/components/drivers/serial/serial.c ****         }
 692:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
 693:rt-thread/components/drivers/serial/serial.c ****         else
 694:rt-thread/components/drivers/serial/serial.c ****         {
 695:rt-thread/components/drivers/serial/serial.c ****             serial->serial_tx = RT_NULL;
 696:rt-thread/components/drivers/serial/serial.c ****         }
 697:rt-thread/components/drivers/serial/serial.c ****     }
 698:rt-thread/components/drivers/serial/serial.c ****     else
 699:rt-thread/components/drivers/serial/serial.c ****     {
 700:rt-thread/components/drivers/serial/serial.c ****         if (oflag & RT_DEVICE_FLAG_INT_TX)
 701:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_TX;
 702:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 703:rt-thread/components/drivers/serial/serial.c ****         else if (oflag & RT_DEVICE_FLAG_DMA_TX)
 704:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_DMA_TX;
 705:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */    
ARM GAS  /tmp/ccebIloK.s 			page 19


 706:rt-thread/components/drivers/serial/serial.c ****     }
 707:rt-thread/components/drivers/serial/serial.c **** 
 708:rt-thread/components/drivers/serial/serial.c ****     /* set stream flag */
 709:rt-thread/components/drivers/serial/serial.c ****     dev->open_flag |= stream_flag;
 710:rt-thread/components/drivers/serial/serial.c **** 
 711:rt-thread/components/drivers/serial/serial.c ****     return RT_EOK;
 712:rt-thread/components/drivers/serial/serial.c **** }
 713:rt-thread/components/drivers/serial/serial.c **** 
 714:rt-thread/components/drivers/serial/serial.c **** static rt_err_t rt_serial_close(struct rt_device *dev)
 715:rt-thread/components/drivers/serial/serial.c **** {
 716:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 717:rt-thread/components/drivers/serial/serial.c **** 
 718:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(dev != RT_NULL);
 719:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)dev;
 720:rt-thread/components/drivers/serial/serial.c **** 
 721:rt-thread/components/drivers/serial/serial.c ****     /* this device has more reference count */
 722:rt-thread/components/drivers/serial/serial.c ****     if (dev->ref_count > 1) return RT_EOK;
 723:rt-thread/components/drivers/serial/serial.c **** 
 724:rt-thread/components/drivers/serial/serial.c ****     if (dev->open_flag & RT_DEVICE_FLAG_INT_RX)
 725:rt-thread/components/drivers/serial/serial.c ****     {
 726:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_rx_fifo* rx_fifo;
 727:rt-thread/components/drivers/serial/serial.c **** 
 728:rt-thread/components/drivers/serial/serial.c ****         rx_fifo = (struct rt_serial_rx_fifo*)serial->serial_rx;
 729:rt-thread/components/drivers/serial/serial.c ****         RT_ASSERT(rx_fifo != RT_NULL);
 730:rt-thread/components/drivers/serial/serial.c **** 
 731:rt-thread/components/drivers/serial/serial.c ****         rt_free(rx_fifo);
 732:rt-thread/components/drivers/serial/serial.c ****         serial->serial_rx = RT_NULL;
 733:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_INT_RX;
 734:rt-thread/components/drivers/serial/serial.c ****         /* configure low level device */
 735:rt-thread/components/drivers/serial/serial.c ****         serial->ops->control(serial, RT_DEVICE_CTRL_CLR_INT, (void*)RT_DEVICE_FLAG_INT_RX);
 736:rt-thread/components/drivers/serial/serial.c ****     }
 737:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 738:rt-thread/components/drivers/serial/serial.c ****     else if (dev->open_flag & RT_DEVICE_FLAG_DMA_RX)
 739:rt-thread/components/drivers/serial/serial.c ****     {
 740:rt-thread/components/drivers/serial/serial.c ****         if (serial->config.bufsz == 0) {
 741:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_rx_dma* rx_dma;
 742:rt-thread/components/drivers/serial/serial.c **** 
 743:rt-thread/components/drivers/serial/serial.c ****             rx_dma = (struct rt_serial_rx_dma*)serial->serial_rx;
 744:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(rx_dma != RT_NULL);
 745:rt-thread/components/drivers/serial/serial.c **** 
 746:rt-thread/components/drivers/serial/serial.c ****             rt_free(rx_dma);
 747:rt-thread/components/drivers/serial/serial.c ****         } else {
 748:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_rx_fifo* rx_fifo;
 749:rt-thread/components/drivers/serial/serial.c **** 
 750:rt-thread/components/drivers/serial/serial.c ****             rx_fifo = (struct rt_serial_rx_fifo*)serial->serial_rx;
 751:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(rx_fifo != RT_NULL);
 752:rt-thread/components/drivers/serial/serial.c **** 
 753:rt-thread/components/drivers/serial/serial.c ****             rt_free(rx_fifo);
 754:rt-thread/components/drivers/serial/serial.c ****         }
 755:rt-thread/components/drivers/serial/serial.c ****         /* configure low level device */
 756:rt-thread/components/drivers/serial/serial.c ****         serial->ops->control(serial, RT_DEVICE_CTRL_CLR_INT, (void *) RT_DEVICE_FLAG_DMA_RX);
 757:rt-thread/components/drivers/serial/serial.c ****         serial->serial_rx = RT_NULL;
 758:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_DMA_RX;
 759:rt-thread/components/drivers/serial/serial.c ****     }
 760:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
 761:rt-thread/components/drivers/serial/serial.c ****     
 762:rt-thread/components/drivers/serial/serial.c ****     if (dev->open_flag & RT_DEVICE_FLAG_INT_TX)
ARM GAS  /tmp/ccebIloK.s 			page 20


 763:rt-thread/components/drivers/serial/serial.c ****     {
 764:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_tx_fifo* tx_fifo;
 765:rt-thread/components/drivers/serial/serial.c **** 
 766:rt-thread/components/drivers/serial/serial.c ****         tx_fifo = (struct rt_serial_tx_fifo*)serial->serial_tx;
 767:rt-thread/components/drivers/serial/serial.c ****         RT_ASSERT(tx_fifo != RT_NULL);
 768:rt-thread/components/drivers/serial/serial.c **** 
 769:rt-thread/components/drivers/serial/serial.c ****         rt_free(tx_fifo);
 770:rt-thread/components/drivers/serial/serial.c ****         serial->serial_tx = RT_NULL;
 771:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_INT_TX;
 772:rt-thread/components/drivers/serial/serial.c ****         /* configure low level device */
 773:rt-thread/components/drivers/serial/serial.c ****         serial->ops->control(serial, RT_DEVICE_CTRL_CLR_INT, (void*)RT_DEVICE_FLAG_INT_TX);
 774:rt-thread/components/drivers/serial/serial.c ****     }
 775:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 776:rt-thread/components/drivers/serial/serial.c ****     else if (dev->open_flag & RT_DEVICE_FLAG_DMA_TX)
 777:rt-thread/components/drivers/serial/serial.c ****     {
 778:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_tx_dma* tx_dma;
 779:rt-thread/components/drivers/serial/serial.c **** 
 780:rt-thread/components/drivers/serial/serial.c ****         tx_dma = (struct rt_serial_tx_dma*)serial->serial_tx;
 781:rt-thread/components/drivers/serial/serial.c ****         RT_ASSERT(tx_dma != RT_NULL);
 782:rt-thread/components/drivers/serial/serial.c **** 
 783:rt-thread/components/drivers/serial/serial.c ****         rt_free(tx_dma);
 784:rt-thread/components/drivers/serial/serial.c ****         serial->serial_tx = RT_NULL;
 785:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_DMA_TX;
 786:rt-thread/components/drivers/serial/serial.c ****     }
 787:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
 788:rt-thread/components/drivers/serial/serial.c ****     return RT_EOK;
 789:rt-thread/components/drivers/serial/serial.c **** }
 790:rt-thread/components/drivers/serial/serial.c **** 
 791:rt-thread/components/drivers/serial/serial.c **** static rt_size_t rt_serial_read(struct rt_device *dev,
 792:rt-thread/components/drivers/serial/serial.c ****                                 rt_off_t          pos,
 793:rt-thread/components/drivers/serial/serial.c ****                                 void             *buffer,
 794:rt-thread/components/drivers/serial/serial.c ****                                 rt_size_t         size)
 795:rt-thread/components/drivers/serial/serial.c **** {
 796:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 797:rt-thread/components/drivers/serial/serial.c **** 
 798:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(dev != RT_NULL);
 799:rt-thread/components/drivers/serial/serial.c ****     if (size == 0) return 0;
 800:rt-thread/components/drivers/serial/serial.c **** 
 801:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)dev;
 802:rt-thread/components/drivers/serial/serial.c **** 
 803:rt-thread/components/drivers/serial/serial.c ****     if (dev->open_flag & RT_DEVICE_FLAG_INT_RX)
 804:rt-thread/components/drivers/serial/serial.c ****     {
 805:rt-thread/components/drivers/serial/serial.c ****         return _serial_int_rx(serial, (rt_uint8_t *)buffer, size);
 806:rt-thread/components/drivers/serial/serial.c ****     }
 807:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 808:rt-thread/components/drivers/serial/serial.c ****     else if (dev->open_flag & RT_DEVICE_FLAG_DMA_RX)
 809:rt-thread/components/drivers/serial/serial.c ****     {
 810:rt-thread/components/drivers/serial/serial.c ****         return _serial_dma_rx(serial, (rt_uint8_t *)buffer, size);
 811:rt-thread/components/drivers/serial/serial.c ****     }
 812:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */    
 813:rt-thread/components/drivers/serial/serial.c **** 
 814:rt-thread/components/drivers/serial/serial.c ****     return _serial_poll_rx(serial, (rt_uint8_t *)buffer, size);
 815:rt-thread/components/drivers/serial/serial.c **** }
 816:rt-thread/components/drivers/serial/serial.c **** 
 817:rt-thread/components/drivers/serial/serial.c **** static rt_size_t rt_serial_write(struct rt_device *dev,
 818:rt-thread/components/drivers/serial/serial.c ****                                  rt_off_t          pos,
 819:rt-thread/components/drivers/serial/serial.c ****                                  const void       *buffer,
ARM GAS  /tmp/ccebIloK.s 			page 21


 820:rt-thread/components/drivers/serial/serial.c ****                                  rt_size_t         size)
 821:rt-thread/components/drivers/serial/serial.c **** {
 822:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 823:rt-thread/components/drivers/serial/serial.c **** 
 824:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(dev != RT_NULL);
 825:rt-thread/components/drivers/serial/serial.c ****     if (size == 0) return 0;
 826:rt-thread/components/drivers/serial/serial.c **** 
 827:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)dev;
 828:rt-thread/components/drivers/serial/serial.c **** 
 829:rt-thread/components/drivers/serial/serial.c ****     if (dev->open_flag & RT_DEVICE_FLAG_INT_TX)
 830:rt-thread/components/drivers/serial/serial.c ****     {
 831:rt-thread/components/drivers/serial/serial.c ****         return _serial_int_tx(serial, (const rt_uint8_t *)buffer, size);
 832:rt-thread/components/drivers/serial/serial.c ****     }
 833:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA    
 834:rt-thread/components/drivers/serial/serial.c ****     else if (dev->open_flag & RT_DEVICE_FLAG_DMA_TX)
 835:rt-thread/components/drivers/serial/serial.c ****     {
 836:rt-thread/components/drivers/serial/serial.c ****         return _serial_dma_tx(serial, (const rt_uint8_t *)buffer, size);
 837:rt-thread/components/drivers/serial/serial.c ****     }
 838:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
 839:rt-thread/components/drivers/serial/serial.c ****     else
 840:rt-thread/components/drivers/serial/serial.c ****     {
 841:rt-thread/components/drivers/serial/serial.c ****         return _serial_poll_tx(serial, (const rt_uint8_t *)buffer, size);
 842:rt-thread/components/drivers/serial/serial.c ****     }
 843:rt-thread/components/drivers/serial/serial.c **** }
 844:rt-thread/components/drivers/serial/serial.c **** 
 845:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_POSIX_TERMIOS
 846:rt-thread/components/drivers/serial/serial.c **** struct speed_baudrate_item
 847:rt-thread/components/drivers/serial/serial.c **** {
 848:rt-thread/components/drivers/serial/serial.c ****     speed_t speed;
 849:rt-thread/components/drivers/serial/serial.c ****     int baudrate;
 850:rt-thread/components/drivers/serial/serial.c **** };
 851:rt-thread/components/drivers/serial/serial.c **** 
 852:rt-thread/components/drivers/serial/serial.c **** const static struct speed_baudrate_item _tbl[] =
 853:rt-thread/components/drivers/serial/serial.c **** {
 854:rt-thread/components/drivers/serial/serial.c ****     {B2400, BAUD_RATE_2400},
 855:rt-thread/components/drivers/serial/serial.c ****     {B4800, BAUD_RATE_4800},
 856:rt-thread/components/drivers/serial/serial.c ****     {B9600, BAUD_RATE_9600},
 857:rt-thread/components/drivers/serial/serial.c ****     {B19200, BAUD_RATE_19200},
 858:rt-thread/components/drivers/serial/serial.c ****     {B38400, BAUD_RATE_38400},
 859:rt-thread/components/drivers/serial/serial.c ****     {B57600, BAUD_RATE_57600},
 860:rt-thread/components/drivers/serial/serial.c ****     {B115200, BAUD_RATE_115200},
 861:rt-thread/components/drivers/serial/serial.c ****     {B230400, BAUD_RATE_230400},
 862:rt-thread/components/drivers/serial/serial.c ****     {B460800, BAUD_RATE_460800},
 863:rt-thread/components/drivers/serial/serial.c ****     {B921600, BAUD_RATE_921600},
 864:rt-thread/components/drivers/serial/serial.c ****     {B2000000, BAUD_RATE_2000000},
 865:rt-thread/components/drivers/serial/serial.c ****     {B3000000, BAUD_RATE_3000000},
 866:rt-thread/components/drivers/serial/serial.c **** };
 867:rt-thread/components/drivers/serial/serial.c **** 
 868:rt-thread/components/drivers/serial/serial.c **** static speed_t _get_speed(int baudrate)
 869:rt-thread/components/drivers/serial/serial.c **** {
 870:rt-thread/components/drivers/serial/serial.c ****     int index;
 871:rt-thread/components/drivers/serial/serial.c **** 
 872:rt-thread/components/drivers/serial/serial.c ****     for (index = 0; index < sizeof(_tbl)/sizeof(_tbl[0]); index ++)
 873:rt-thread/components/drivers/serial/serial.c ****     {
 874:rt-thread/components/drivers/serial/serial.c ****         if (_tbl[index].baudrate == baudrate)
 875:rt-thread/components/drivers/serial/serial.c ****             return _tbl[index].speed;
 876:rt-thread/components/drivers/serial/serial.c ****     }
ARM GAS  /tmp/ccebIloK.s 			page 22


 877:rt-thread/components/drivers/serial/serial.c **** 
 878:rt-thread/components/drivers/serial/serial.c ****     return B0;
 879:rt-thread/components/drivers/serial/serial.c **** }
 880:rt-thread/components/drivers/serial/serial.c **** 
 881:rt-thread/components/drivers/serial/serial.c **** static int _get_baudrate(speed_t speed)
 882:rt-thread/components/drivers/serial/serial.c **** {
 883:rt-thread/components/drivers/serial/serial.c ****     int index;
 884:rt-thread/components/drivers/serial/serial.c **** 
 885:rt-thread/components/drivers/serial/serial.c ****     for (index = 0; index < sizeof(_tbl)/sizeof(_tbl[0]); index ++)
 886:rt-thread/components/drivers/serial/serial.c ****     {
 887:rt-thread/components/drivers/serial/serial.c ****         if (_tbl[index].speed == speed)
 888:rt-thread/components/drivers/serial/serial.c ****             return _tbl[index].baudrate;
 889:rt-thread/components/drivers/serial/serial.c ****     }
 890:rt-thread/components/drivers/serial/serial.c **** 
 891:rt-thread/components/drivers/serial/serial.c ****     return 0;
 892:rt-thread/components/drivers/serial/serial.c **** }
 893:rt-thread/components/drivers/serial/serial.c **** 
 894:rt-thread/components/drivers/serial/serial.c **** static void _tc_flush(struct rt_serial_device *serial, int queue)
 895:rt-thread/components/drivers/serial/serial.c **** {
 896:rt-thread/components/drivers/serial/serial.c ****     rt_base_t level;
 897:rt-thread/components/drivers/serial/serial.c ****     int ch = -1;
 898:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_rx_fifo *rx_fifo = RT_NULL;
 899:rt-thread/components/drivers/serial/serial.c ****     struct rt_device *device = RT_NULL;
 900:rt-thread/components/drivers/serial/serial.c **** 
 901:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(serial != RT_NULL);
 902:rt-thread/components/drivers/serial/serial.c **** 
 903:rt-thread/components/drivers/serial/serial.c ****     device = &(serial->parent);
 904:rt-thread/components/drivers/serial/serial.c ****     rx_fifo = (struct rt_serial_rx_fifo *) serial->serial_rx;
 905:rt-thread/components/drivers/serial/serial.c **** 
 906:rt-thread/components/drivers/serial/serial.c ****     switch(queue)
 907:rt-thread/components/drivers/serial/serial.c ****     {
 908:rt-thread/components/drivers/serial/serial.c ****         case TCIFLUSH:
 909:rt-thread/components/drivers/serial/serial.c ****         case TCIOFLUSH:
 910:rt-thread/components/drivers/serial/serial.c **** 
 911:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(rx_fifo != RT_NULL);
 912:rt-thread/components/drivers/serial/serial.c **** 
 913:rt-thread/components/drivers/serial/serial.c ****             if((device->open_flag & RT_DEVICE_FLAG_INT_RX) || (device->open_flag & RT_DEVICE_FLAG_D
 914:rt-thread/components/drivers/serial/serial.c ****             {
 915:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(RT_NULL != rx_fifo);
 916:rt-thread/components/drivers/serial/serial.c ****                 level = rt_hw_interrupt_disable();
 917:rt-thread/components/drivers/serial/serial.c ****                 rt_memset(rx_fifo->buffer, 0, serial->config.bufsz);
 918:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->put_index = 0;
 919:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->get_index = 0;
 920:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->is_full = RT_FALSE;
 921:rt-thread/components/drivers/serial/serial.c ****                 rt_hw_interrupt_enable(level);
 922:rt-thread/components/drivers/serial/serial.c ****             }
 923:rt-thread/components/drivers/serial/serial.c ****             else
 924:rt-thread/components/drivers/serial/serial.c ****             {
 925:rt-thread/components/drivers/serial/serial.c ****                 while (1)
 926:rt-thread/components/drivers/serial/serial.c ****                 {
 927:rt-thread/components/drivers/serial/serial.c ****                     ch = serial->ops->getc(serial);
 928:rt-thread/components/drivers/serial/serial.c ****                     if (ch == -1) break;
 929:rt-thread/components/drivers/serial/serial.c ****                 }
 930:rt-thread/components/drivers/serial/serial.c ****             }
 931:rt-thread/components/drivers/serial/serial.c **** 
 932:rt-thread/components/drivers/serial/serial.c ****             break;
 933:rt-thread/components/drivers/serial/serial.c **** 
ARM GAS  /tmp/ccebIloK.s 			page 23


 934:rt-thread/components/drivers/serial/serial.c ****          case TCOFLUSH:
 935:rt-thread/components/drivers/serial/serial.c ****             break;
 936:rt-thread/components/drivers/serial/serial.c ****     }
 937:rt-thread/components/drivers/serial/serial.c **** 
 938:rt-thread/components/drivers/serial/serial.c **** }
 939:rt-thread/components/drivers/serial/serial.c **** 
 940:rt-thread/components/drivers/serial/serial.c **** #endif
 941:rt-thread/components/drivers/serial/serial.c **** 
 942:rt-thread/components/drivers/serial/serial.c **** static rt_err_t rt_serial_control(struct rt_device *dev,
 943:rt-thread/components/drivers/serial/serial.c ****                                   int              cmd,
 944:rt-thread/components/drivers/serial/serial.c ****                                   void             *args)
 945:rt-thread/components/drivers/serial/serial.c **** {
 330              		.loc 1 945 0
 331              		.cfi_startproc
 332              		@ args = 0, pretend = 0, frame = 0
 333              		@ frame_needed = 0, uses_anonymous_args = 0
 334              	.LVL29:
 946:rt-thread/components/drivers/serial/serial.c ****     rt_err_t ret = RT_EOK;
 947:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 948:rt-thread/components/drivers/serial/serial.c **** 
 949:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(dev != RT_NULL);
 950:rt-thread/components/drivers/serial/serial.c ****     serial = (struct rt_serial_device *)dev;
 951:rt-thread/components/drivers/serial/serial.c **** 
 952:rt-thread/components/drivers/serial/serial.c ****     switch (cmd)
 335              		.loc 1 952 0
 336 0000 0229     		cmp	r1, #2
 337 0002 0AD0     		beq	.L30
 945:rt-thread/components/drivers/serial/serial.c ****     rt_err_t ret = RT_EOK;
 338              		.loc 1 945 0
 339 0004 10B5     		push	{r4, lr}
 340              	.LCFI3:
 341              		.cfi_def_cfa_offset 8
 342              		.cfi_offset 4, -8
 343              		.cfi_offset 14, -4
 344 0006 0346     		mov	r3, r0
 345              		.loc 1 952 0
 346 0008 0329     		cmp	r1, #3
 347 000a 12D0     		beq	.L31
 348 000c 0129     		cmp	r1, #1
 349 000e 0AD0     		beq	.L43
 953:rt-thread/components/drivers/serial/serial.c ****     {
 954:rt-thread/components/drivers/serial/serial.c ****         case RT_DEVICE_CTRL_SUSPEND:
 955:rt-thread/components/drivers/serial/serial.c ****             /* suspend device */
 956:rt-thread/components/drivers/serial/serial.c ****             dev->flag |= RT_DEVICE_FLAG_SUSPENDED;
 957:rt-thread/components/drivers/serial/serial.c ****             break;
 958:rt-thread/components/drivers/serial/serial.c **** 
 959:rt-thread/components/drivers/serial/serial.c ****         case RT_DEVICE_CTRL_RESUME:
 960:rt-thread/components/drivers/serial/serial.c ****             /* resume device */
 961:rt-thread/components/drivers/serial/serial.c ****             dev->flag &= ~RT_DEVICE_FLAG_SUSPENDED;
 962:rt-thread/components/drivers/serial/serial.c ****             break;
 963:rt-thread/components/drivers/serial/serial.c **** 
 964:rt-thread/components/drivers/serial/serial.c ****         case RT_DEVICE_CTRL_CONFIG:
 965:rt-thread/components/drivers/serial/serial.c ****             if (args)
 966:rt-thread/components/drivers/serial/serial.c ****             {
 967:rt-thread/components/drivers/serial/serial.c ****                 struct serial_configure *pconfig = (struct serial_configure *) args;
 968:rt-thread/components/drivers/serial/serial.c ****                 if (pconfig->bufsz != serial->config.bufsz && serial->parent.ref_count)
 969:rt-thread/components/drivers/serial/serial.c ****                 {
ARM GAS  /tmp/ccebIloK.s 			page 24


 970:rt-thread/components/drivers/serial/serial.c ****                     /*can not change buffer size*/
 971:rt-thread/components/drivers/serial/serial.c ****                     return RT_EBUSY;
 972:rt-thread/components/drivers/serial/serial.c ****                 }
 973:rt-thread/components/drivers/serial/serial.c ****                 /* set serial configure */
 974:rt-thread/components/drivers/serial/serial.c ****                 serial->config = *pconfig;
 975:rt-thread/components/drivers/serial/serial.c ****                 if (serial->parent.ref_count)
 976:rt-thread/components/drivers/serial/serial.c ****                 {
 977:rt-thread/components/drivers/serial/serial.c ****                     /* serial device has been opened, to configure it */
 978:rt-thread/components/drivers/serial/serial.c ****                     serial->ops->configure(serial, (struct serial_configure *) args);
 979:rt-thread/components/drivers/serial/serial.c ****                 }
 980:rt-thread/components/drivers/serial/serial.c ****             }
 981:rt-thread/components/drivers/serial/serial.c **** 
 982:rt-thread/components/drivers/serial/serial.c ****             break;
 983:rt-thread/components/drivers/serial/serial.c **** 
 984:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_POSIX_TERMIOS
 985:rt-thread/components/drivers/serial/serial.c ****         case TCGETA:
 986:rt-thread/components/drivers/serial/serial.c ****             {
 987:rt-thread/components/drivers/serial/serial.c ****                 struct termios *tio = (struct termios*)args;
 988:rt-thread/components/drivers/serial/serial.c ****                 if (tio == RT_NULL) return -RT_EINVAL;
 989:rt-thread/components/drivers/serial/serial.c **** 
 990:rt-thread/components/drivers/serial/serial.c ****                 tio->c_iflag = 0;
 991:rt-thread/components/drivers/serial/serial.c ****                 tio->c_oflag = 0;
 992:rt-thread/components/drivers/serial/serial.c ****                 tio->c_lflag = 0;
 993:rt-thread/components/drivers/serial/serial.c **** 
 994:rt-thread/components/drivers/serial/serial.c ****                 /* update oflag for console device */
 995:rt-thread/components/drivers/serial/serial.c ****                 if (rt_console_get_device() == dev)
 996:rt-thread/components/drivers/serial/serial.c ****                     tio->c_oflag = OPOST | ONLCR;
 997:rt-thread/components/drivers/serial/serial.c **** 
 998:rt-thread/components/drivers/serial/serial.c ****                 /* set cflag */
 999:rt-thread/components/drivers/serial/serial.c ****                 tio->c_cflag = 0;
1000:rt-thread/components/drivers/serial/serial.c ****                 if (serial->config.data_bits == DATA_BITS_5)
1001:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag = CS5;
1002:rt-thread/components/drivers/serial/serial.c ****                 else if (serial->config.data_bits == DATA_BITS_6)
1003:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag = CS6;
1004:rt-thread/components/drivers/serial/serial.c ****                 else if (serial->config.data_bits == DATA_BITS_7)
1005:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag = CS7;
1006:rt-thread/components/drivers/serial/serial.c ****                 else if (serial->config.data_bits == DATA_BITS_8)
1007:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag = CS8;
1008:rt-thread/components/drivers/serial/serial.c **** 
1009:rt-thread/components/drivers/serial/serial.c ****                 if (serial->config.stop_bits == STOP_BITS_2)
1010:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag |= CSTOPB;
1011:rt-thread/components/drivers/serial/serial.c **** 
1012:rt-thread/components/drivers/serial/serial.c ****                 if (serial->config.parity == PARITY_EVEN)
1013:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag |= PARENB;
1014:rt-thread/components/drivers/serial/serial.c ****                 else if (serial->config.parity == PARITY_ODD)
1015:rt-thread/components/drivers/serial/serial.c ****                     tio->c_cflag |= (PARODD | PARENB);
1016:rt-thread/components/drivers/serial/serial.c **** 
1017:rt-thread/components/drivers/serial/serial.c ****                 cfsetospeed(tio, _get_speed(serial->config.baud_rate));
1018:rt-thread/components/drivers/serial/serial.c ****             }
1019:rt-thread/components/drivers/serial/serial.c ****             break;
1020:rt-thread/components/drivers/serial/serial.c **** 
1021:rt-thread/components/drivers/serial/serial.c ****         case TCSETAW:
1022:rt-thread/components/drivers/serial/serial.c ****         case TCSETAF:
1023:rt-thread/components/drivers/serial/serial.c ****         case TCSETA:
1024:rt-thread/components/drivers/serial/serial.c ****             {
1025:rt-thread/components/drivers/serial/serial.c ****                 int baudrate;
1026:rt-thread/components/drivers/serial/serial.c ****                 struct serial_configure config;
ARM GAS  /tmp/ccebIloK.s 			page 25


1027:rt-thread/components/drivers/serial/serial.c **** 
1028:rt-thread/components/drivers/serial/serial.c ****                 struct termios *tio = (struct termios*)args;
1029:rt-thread/components/drivers/serial/serial.c ****                 if (tio == RT_NULL) return -RT_EINVAL;
1030:rt-thread/components/drivers/serial/serial.c **** 
1031:rt-thread/components/drivers/serial/serial.c ****                 config = serial->config;
1032:rt-thread/components/drivers/serial/serial.c **** 
1033:rt-thread/components/drivers/serial/serial.c ****                 baudrate = _get_baudrate(cfgetospeed(tio));
1034:rt-thread/components/drivers/serial/serial.c ****                 config.baud_rate = baudrate;
1035:rt-thread/components/drivers/serial/serial.c **** 
1036:rt-thread/components/drivers/serial/serial.c ****                 switch (tio->c_cflag & CSIZE)
1037:rt-thread/components/drivers/serial/serial.c ****                 {
1038:rt-thread/components/drivers/serial/serial.c ****                 case CS5:
1039:rt-thread/components/drivers/serial/serial.c ****                     config.data_bits = DATA_BITS_5;
1040:rt-thread/components/drivers/serial/serial.c ****                     break;
1041:rt-thread/components/drivers/serial/serial.c ****                 case CS6:
1042:rt-thread/components/drivers/serial/serial.c ****                     config.data_bits = DATA_BITS_6;
1043:rt-thread/components/drivers/serial/serial.c ****                     break;
1044:rt-thread/components/drivers/serial/serial.c ****                 case CS7:
1045:rt-thread/components/drivers/serial/serial.c ****                     config.data_bits = DATA_BITS_7;
1046:rt-thread/components/drivers/serial/serial.c ****                     break;
1047:rt-thread/components/drivers/serial/serial.c ****                 default:
1048:rt-thread/components/drivers/serial/serial.c ****                     config.data_bits = DATA_BITS_8;
1049:rt-thread/components/drivers/serial/serial.c ****                     break;
1050:rt-thread/components/drivers/serial/serial.c ****                 }
1051:rt-thread/components/drivers/serial/serial.c **** 
1052:rt-thread/components/drivers/serial/serial.c ****                 if (tio->c_cflag & CSTOPB) config.stop_bits = STOP_BITS_2;
1053:rt-thread/components/drivers/serial/serial.c ****                 else config.stop_bits = STOP_BITS_1;
1054:rt-thread/components/drivers/serial/serial.c **** 
1055:rt-thread/components/drivers/serial/serial.c ****                 if (tio->c_cflag & PARENB)
1056:rt-thread/components/drivers/serial/serial.c ****                 {
1057:rt-thread/components/drivers/serial/serial.c ****                     if (tio->c_cflag & PARODD) config.parity = PARITY_ODD;
1058:rt-thread/components/drivers/serial/serial.c ****                     else config.parity = PARITY_EVEN;
1059:rt-thread/components/drivers/serial/serial.c ****                 }
1060:rt-thread/components/drivers/serial/serial.c ****                 else config.parity = PARITY_NONE;
1061:rt-thread/components/drivers/serial/serial.c **** 
1062:rt-thread/components/drivers/serial/serial.c ****                 serial->ops->configure(serial, &config);
1063:rt-thread/components/drivers/serial/serial.c ****             }
1064:rt-thread/components/drivers/serial/serial.c ****             break;
1065:rt-thread/components/drivers/serial/serial.c ****         case TCFLSH:
1066:rt-thread/components/drivers/serial/serial.c ****             {
1067:rt-thread/components/drivers/serial/serial.c ****                 int queue = (int)args;
1068:rt-thread/components/drivers/serial/serial.c **** 
1069:rt-thread/components/drivers/serial/serial.c ****                 _tc_flush(serial, queue);
1070:rt-thread/components/drivers/serial/serial.c ****             }
1071:rt-thread/components/drivers/serial/serial.c **** 
1072:rt-thread/components/drivers/serial/serial.c ****             break;
1073:rt-thread/components/drivers/serial/serial.c ****         case TCXONC:
1074:rt-thread/components/drivers/serial/serial.c ****             break;
1075:rt-thread/components/drivers/serial/serial.c **** #endif
1076:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_POSIX
1077:rt-thread/components/drivers/serial/serial.c ****         case FIONREAD:
1078:rt-thread/components/drivers/serial/serial.c ****             {
1079:rt-thread/components/drivers/serial/serial.c ****                 rt_size_t recved = 0;
1080:rt-thread/components/drivers/serial/serial.c ****                 rt_base_t level;
1081:rt-thread/components/drivers/serial/serial.c **** 
1082:rt-thread/components/drivers/serial/serial.c ****                 level = rt_hw_interrupt_disable();
1083:rt-thread/components/drivers/serial/serial.c ****                 recved = _serial_fifo_calc_recved_len(serial);
ARM GAS  /tmp/ccebIloK.s 			page 26


1084:rt-thread/components/drivers/serial/serial.c ****                 rt_hw_interrupt_enable(level);
1085:rt-thread/components/drivers/serial/serial.c **** 
1086:rt-thread/components/drivers/serial/serial.c ****                 *(rt_size_t *)args = recved;
1087:rt-thread/components/drivers/serial/serial.c ****             }
1088:rt-thread/components/drivers/serial/serial.c ****             break;
1089:rt-thread/components/drivers/serial/serial.c **** #endif
1090:rt-thread/components/drivers/serial/serial.c ****         default :
1091:rt-thread/components/drivers/serial/serial.c ****             /* control device */
1092:rt-thread/components/drivers/serial/serial.c ****             ret = serial->ops->control(serial, cmd, args);
 350              		.loc 1 1092 0
 351 0010 C06A     		ldr	r0, [r0, #44]
 352              	.LVL30:
 353 0012 4468     		ldr	r4, [r0, #4]
 354 0014 1846     		mov	r0, r3
 355 0016 A047     		blx	r4
 356              	.LVL31:
1093:rt-thread/components/drivers/serial/serial.c ****             break;
 357              		.loc 1 1093 0
 358 0018 10BD     		pop	{r4, pc}
 359              	.LVL32:
 360              	.L30:
 361              	.LCFI4:
 362              		.cfi_def_cfa_offset 0
 363              		.cfi_restore 4
 364              		.cfi_restore 14
 956:rt-thread/components/drivers/serial/serial.c ****             break;
 365              		.loc 1 956 0
 366 001a C38A     		ldrh	r3, [r0, #22]
 367 001c 43F02003 		orr	r3, r3, #32
 368 0020 C382     		strh	r3, [r0, #22]	@ movhi
 946:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 369              		.loc 1 946 0
 370 0022 0020     		movs	r0, #0
 371              	.LVL33:
 957:rt-thread/components/drivers/serial/serial.c **** 
 372              		.loc 1 957 0
 373 0024 7047     		bx	lr
 374              	.LVL34:
 375              	.L43:
 376              	.LCFI5:
 377              		.cfi_def_cfa_offset 8
 378              		.cfi_offset 4, -8
 379              		.cfi_offset 14, -4
 961:rt-thread/components/drivers/serial/serial.c ****             break;
 380              		.loc 1 961 0
 381 0026 C28A     		ldrh	r2, [r0, #22]
 382              	.LVL35:
 383 0028 22F02002 		bic	r2, r2, #32
 384 002c C282     		strh	r2, [r0, #22]	@ movhi
 946:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 385              		.loc 1 946 0
 386 002e 0020     		movs	r0, #0
 387              	.LVL36:
 962:rt-thread/components/drivers/serial/serial.c **** 
 388              		.loc 1 962 0
 389 0030 10BD     		pop	{r4, pc}
 390              	.LVL37:
ARM GAS  /tmp/ccebIloK.s 			page 27


 391              	.L31:
 965:rt-thread/components/drivers/serial/serial.c ****             {
 392              		.loc 1 965 0
 393 0032 E2B1     		cbz	r2, .L35
 394              	.LVL38:
 395              	.LBB4:
 968:rt-thread/components/drivers/serial/serial.c ****                 {
 396              		.loc 1 968 0
 397 0034 5168     		ldr	r1, [r2, #4]
 398              	.LVL39:
 399 0036 C1F38F20 		ubfx	r0, r1, #10, #16
 400              	.LVL40:
 401 003a 596B     		ldr	r1, [r3, #52]
 402 003c C1F38F21 		ubfx	r1, r1, #10, #16
 403 0040 8842     		cmp	r0, r1
 404 0042 03D0     		beq	.L34
 968:rt-thread/components/drivers/serial/serial.c ****                 {
 405              		.loc 1 968 0 is_stmt 0 discriminator 1
 406 0044 997E     		ldrb	r1, [r3, #26]	@ zero_extendqisi2
 407 0046 09B1     		cbz	r1, .L34
 971:rt-thread/components/drivers/serial/serial.c ****                 }
 408              		.loc 1 971 0 is_stmt 1
 409 0048 0720     		movs	r0, #7
 410 004a 10BD     		pop	{r4, pc}
 411              	.L34:
 974:rt-thread/components/drivers/serial/serial.c ****                 if (serial->parent.ref_count)
 412              		.loc 1 974 0
 413 004c 03F13004 		add	r4, r3, #48
 414 0050 92E80300 		ldm	r2, {r0, r1}
 415 0054 84E80300 		stm	r4, {r0, r1}
 975:rt-thread/components/drivers/serial/serial.c ****                 {
 416              		.loc 1 975 0
 417 0058 997E     		ldrb	r1, [r3, #26]	@ zero_extendqisi2
 418 005a 09B9     		cbnz	r1, .L44
 419              	.LBE4:
 946:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 420              		.loc 1 946 0
 421 005c 0020     		movs	r0, #0
1094:rt-thread/components/drivers/serial/serial.c ****     }
1095:rt-thread/components/drivers/serial/serial.c **** 
1096:rt-thread/components/drivers/serial/serial.c ****     return ret;
1097:rt-thread/components/drivers/serial/serial.c **** }
 422              		.loc 1 1097 0
 423 005e 10BD     		pop	{r4, pc}
 424              	.L44:
 425              	.LBB5:
 978:rt-thread/components/drivers/serial/serial.c ****                 }
 426              		.loc 1 978 0
 427 0060 D96A     		ldr	r1, [r3, #44]
 428 0062 0C68     		ldr	r4, [r1]
 429 0064 1146     		mov	r1, r2
 430 0066 1846     		mov	r0, r3
 431 0068 A047     		blx	r4
 432              	.LVL41:
 433              	.LBE5:
 946:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 434              		.loc 1 946 0
ARM GAS  /tmp/ccebIloK.s 			page 28


 435 006a 0020     		movs	r0, #0
 436 006c 10BD     		pop	{r4, pc}
 437              	.LVL42:
 438              	.L35:
 439 006e 0020     		movs	r0, #0
 440              	.LVL43:
 441 0070 10BD     		pop	{r4, pc}
 442              		.cfi_endproc
 443              	.LFE35:
 445              		.section	.text.rt_serial_write,"ax",%progbits
 446              		.align	1
 447              		.syntax unified
 448              		.thumb
 449              		.thumb_func
 450              		.fpu fpv4-sp-d16
 452              	rt_serial_write:
 453              	.LFB34:
 821:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 454              		.loc 1 821 0
 455              		.cfi_startproc
 456              		@ args = 0, pretend = 0, frame = 0
 457              		@ frame_needed = 0, uses_anonymous_args = 0
 458              	.LVL44:
 459 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 460              	.LCFI6:
 461              		.cfi_def_cfa_offset 24
 462              		.cfi_offset 4, -24
 463              		.cfi_offset 5, -20
 464              		.cfi_offset 6, -16
 465              		.cfi_offset 7, -12
 466              		.cfi_offset 8, -8
 467              		.cfi_offset 14, -4
 825:rt-thread/components/drivers/serial/serial.c **** 
 468              		.loc 1 825 0
 469 0004 1D46     		mov	r5, r3
 470 0006 002B     		cmp	r3, #0
 471 0008 5FD0     		beq	.L59
 472 000a 1446     		mov	r4, r2
 473 000c 0746     		mov	r7, r0
 474              	.LVL45:
 829:rt-thread/components/drivers/serial/serial.c ****     {
 475              		.loc 1 829 0
 476 000e 038B     		ldrh	r3, [r0, #24]
 477              	.LVL46:
 478 0010 13F4806F 		tst	r3, #1024
 479 0014 04D1     		bne	.L61
 834:rt-thread/components/drivers/serial/serial.c ****     {
 480              		.loc 1 834 0
 481 0016 13F4006F 		tst	r3, #2048
 482 001a 19D1     		bne	.L62
 483              	.LVL47:
 841:rt-thread/components/drivers/serial/serial.c ****     }
 484              		.loc 1 841 0
 485 001c 2E46     		mov	r6, r5
 486 001e 43E0     		b	.L56
 487              	.LVL48:
 488              	.L61:
ARM GAS  /tmp/ccebIloK.s 			page 29


 489              	.LBB12:
 490              	.LBB13:
 313:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(tx != RT_NULL);
 491              		.loc 1 313 0
 492 0020 D0F83C80 		ldr	r8, [r0, #60]
 493              	.LVL49:
 494 0024 2E46     		mov	r6, r5
 495 0026 04E0     		b	.L48
 496              	.LVL50:
 497              	.L64:
 320:rt-thread/components/drivers/serial/serial.c ****             continue;
 498              		.loc 1 320 0
 499 0028 4FF0FF31 		mov	r1, #-1
 500 002c 4046     		mov	r0, r8
 501 002e FFF7FEFF 		bl	rt_completion_wait
 502              	.LVL51:
 503              	.L48:
 316:rt-thread/components/drivers/serial/serial.c ****     {
 504              		.loc 1 316 0
 505 0032 56B1     		cbz	r6, .L63
 318:rt-thread/components/drivers/serial/serial.c ****         {
 506              		.loc 1 318 0
 507 0034 FB6A     		ldr	r3, [r7, #44]
 508 0036 9B68     		ldr	r3, [r3, #8]
 509 0038 2178     		ldrb	r1, [r4]	@ zero_extendqisi2
 510 003a 3846     		mov	r0, r7
 511 003c 9847     		blx	r3
 512              	.LVL52:
 513 003e B0F1FF3F 		cmp	r0, #-1
 514 0042 F1D0     		beq	.L64
 324:rt-thread/components/drivers/serial/serial.c ****     }
 515              		.loc 1 324 0
 516 0044 0134     		adds	r4, r4, #1
 517              	.LVL53:
 518 0046 013E     		subs	r6, r6, #1
 519              	.LVL54:
 520 0048 F3E7     		b	.L48
 521              	.L63:
 327:rt-thread/components/drivers/serial/serial.c **** }
 522              		.loc 1 327 0
 523 004a A81B     		subs	r0, r5, r6
 524              	.LVL55:
 525              	.LBE13:
 526              	.LBE12:
 831:rt-thread/components/drivers/serial/serial.c ****     }
 527              		.loc 1 831 0
 528 004c BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 529              	.LVL56:
 530              	.L62:
 836:rt-thread/components/drivers/serial/serial.c ****     }
 531              		.loc 1 836 0
 532 0050 A846     		mov	r8, r5
 533              	.LVL57:
 534              	.LBB14:
 535              	.LBB15:
 516:rt-thread/components/drivers/serial/serial.c **** 
 536              		.loc 1 516 0
ARM GAS  /tmp/ccebIloK.s 			page 30


 537 0052 C66B     		ldr	r6, [r0, #60]
 538              	.LVL58:
 518:rt-thread/components/drivers/serial/serial.c ****     if (result == RT_EOK)
 539              		.loc 1 518 0
 540 0054 4FF0FF33 		mov	r3, #-1
 541 0058 2A46     		mov	r2, r5
 542              	.LVL59:
 543 005a 2146     		mov	r1, r4
 544              	.LVL60:
 545 005c 301D     		adds	r0, r6, #4
 546              	.LVL61:
 547 005e FFF7FEFF 		bl	rt_data_queue_push
 548              	.LVL62:
 519:rt-thread/components/drivers/serial/serial.c ****     {
 549              		.loc 1 519 0
 550 0062 98B9     		cbnz	r0, .L53
 551              	.LVL63:
 521:rt-thread/components/drivers/serial/serial.c ****         if (tx_dma->activated != RT_TRUE)
 552              		.loc 1 521 0
 553 0064 FFF7FEFF 		bl	rt_hw_interrupt_disable
 554              	.LVL64:
 522:rt-thread/components/drivers/serial/serial.c ****         {
 555              		.loc 1 522 0
 556 0068 3368     		ldr	r3, [r6]
 557 006a 012B     		cmp	r3, #1
 558 006c 0BD0     		beq	.L54
 524:rt-thread/components/drivers/serial/serial.c ****             rt_hw_interrupt_enable(level);
 559              		.loc 1 524 0
 560 006e 0123     		movs	r3, #1
 561 0070 3360     		str	r3, [r6]
 525:rt-thread/components/drivers/serial/serial.c **** 
 562              		.loc 1 525 0
 563 0072 FFF7FEFF 		bl	rt_hw_interrupt_enable
 564              	.LVL65:
 528:rt-thread/components/drivers/serial/serial.c ****         }
 565              		.loc 1 528 0
 566 0076 FB6A     		ldr	r3, [r7, #44]
 567 0078 1E69     		ldr	r6, [r3, #16]
 568              	.LVL66:
 569 007a 0223     		movs	r3, #2
 570 007c 2A46     		mov	r2, r5
 571 007e 2146     		mov	r1, r4
 572 0080 3846     		mov	r0, r7
 573 0082 B047     		blx	r6
 574              	.LVL67:
 575 0084 06E0     		b	.L55
 576              	.LVL68:
 577              	.L54:
 532:rt-thread/components/drivers/serial/serial.c ****         }
 578              		.loc 1 532 0
 579 0086 FFF7FEFF 		bl	rt_hw_interrupt_enable
 580              	.LVL69:
 581 008a 03E0     		b	.L55
 582              	.LVL70:
 583              	.L53:
 539:rt-thread/components/drivers/serial/serial.c ****         return 0;
 584              		.loc 1 539 0
ARM GAS  /tmp/ccebIloK.s 			page 31


 585 008c FFF7FEFF 		bl	rt_set_errno
 586              	.LVL71:
 540:rt-thread/components/drivers/serial/serial.c ****     }
 587              		.loc 1 540 0
 588 0090 4FF00008 		mov	r8, #0
 589              	.LVL72:
 590              	.L55:
 591              	.LBE15:
 592              	.LBE14:
 836:rt-thread/components/drivers/serial/serial.c ****     }
 593              		.loc 1 836 0
 594 0094 4046     		mov	r0, r8
 595 0096 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 596              	.LVL73:
 597              	.L57:
 598              	.LBB16:
 599              	.LBB17:
 245:rt-thread/components/drivers/serial/serial.c **** 
 600              		.loc 1 245 0
 601 009a FA6A     		ldr	r2, [r7, #44]
 602 009c 9268     		ldr	r2, [r2, #8]
 603 009e 14F8011B 		ldrb	r1, [r4], #1	@ zero_extendqisi2
 604              	.LVL74:
 605 00a2 3846     		mov	r0, r7
 606 00a4 9047     		blx	r2
 607              	.LVL75:
 248:rt-thread/components/drivers/serial/serial.c ****     }
 608              		.loc 1 248 0
 609 00a6 013E     		subs	r6, r6, #1
 610              	.LVL76:
 611              	.L56:
 234:rt-thread/components/drivers/serial/serial.c ****     {
 612              		.loc 1 234 0
 613 00a8 66B1     		cbz	r6, .L65
 240:rt-thread/components/drivers/serial/serial.c ****         {
 614              		.loc 1 240 0
 615 00aa 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
 616 00ac 0A2A     		cmp	r2, #10
 617 00ae F4D1     		bne	.L57
 618 00b0 3B8B     		ldrh	r3, [r7, #24]
 619 00b2 13F0400F 		tst	r3, #64
 620 00b6 F0D0     		beq	.L57
 242:rt-thread/components/drivers/serial/serial.c ****         }
 621              		.loc 1 242 0
 622 00b8 FB6A     		ldr	r3, [r7, #44]
 623 00ba 9B68     		ldr	r3, [r3, #8]
 624 00bc 0D21     		movs	r1, #13
 625 00be 3846     		mov	r0, r7
 626 00c0 9847     		blx	r3
 627              	.LVL77:
 628 00c2 EAE7     		b	.L57
 629              	.L65:
 251:rt-thread/components/drivers/serial/serial.c **** }
 630              		.loc 1 251 0
 631 00c4 A81B     		subs	r0, r5, r6
 632              	.LVL78:
 633              	.LBE17:
ARM GAS  /tmp/ccebIloK.s 			page 32


 634              	.LBE16:
 841:rt-thread/components/drivers/serial/serial.c ****     }
 635              		.loc 1 841 0
 636 00c6 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 637              	.LVL79:
 638              	.L59:
 825:rt-thread/components/drivers/serial/serial.c **** 
 639              		.loc 1 825 0
 640 00ca 1846     		mov	r0, r3
 641              	.LVL80:
 843:rt-thread/components/drivers/serial/serial.c **** 
 642              		.loc 1 843 0
 643 00cc BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 644              		.cfi_endproc
 645              	.LFE34:
 647              		.section	.text.rt_serial_read,"ax",%progbits
 648              		.align	1
 649              		.syntax unified
 650              		.thumb
 651              		.thumb_func
 652              		.fpu fpv4-sp-d16
 654              	rt_serial_read:
 655              	.LFB33:
 795:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 656              		.loc 1 795 0
 657              		.cfi_startproc
 658              		@ args = 0, pretend = 0, frame = 0
 659              		@ frame_needed = 0, uses_anonymous_args = 0
 660              	.LVL81:
 661 0000 2DE9F843 		push	{r3, r4, r5, r6, r7, r8, r9, lr}
 662              	.LCFI7:
 663              		.cfi_def_cfa_offset 32
 664              		.cfi_offset 3, -32
 665              		.cfi_offset 4, -28
 666              		.cfi_offset 5, -24
 667              		.cfi_offset 6, -20
 668              		.cfi_offset 7, -16
 669              		.cfi_offset 8, -12
 670              		.cfi_offset 9, -8
 671              		.cfi_offset 14, -4
 799:rt-thread/components/drivers/serial/serial.c **** 
 672              		.loc 1 799 0
 673 0004 1C46     		mov	r4, r3
 674 0006 002B     		cmp	r3, #0
 675 0008 00F09980 		beq	.L85
 676 000c 0746     		mov	r7, r0
 677 000e 1546     		mov	r5, r2
 678              	.LVL82:
 803:rt-thread/components/drivers/serial/serial.c ****     {
 679              		.loc 1 803 0
 680 0010 038B     		ldrh	r3, [r0, #24]
 681              	.LVL83:
 682 0012 13F4807F 		tst	r3, #256
 683 0016 13D1     		bne	.L88
 808:rt-thread/components/drivers/serial/serial.c ****     {
 684              		.loc 1 808 0
 685 0018 13F4007F 		tst	r3, #512
ARM GAS  /tmp/ccebIloK.s 			page 33


 686 001c 3CD1     		bne	.L89
 814:rt-thread/components/drivers/serial/serial.c **** }
 687              		.loc 1 814 0
 688 001e 2646     		mov	r6, r4
 689              	.LVL84:
 690              	.L82:
 691              	.LBB27:
 692              	.LBB28:
 214:rt-thread/components/drivers/serial/serial.c ****     {
 693              		.loc 1 214 0
 694 0020 5CB1     		cbz	r4, .L83
 216:rt-thread/components/drivers/serial/serial.c ****         if (ch == -1) break;
 695              		.loc 1 216 0
 696 0022 FB6A     		ldr	r3, [r7, #44]
 697 0024 DB68     		ldr	r3, [r3, #12]
 698 0026 3846     		mov	r0, r7
 699 0028 9847     		blx	r3
 700              	.LVL85:
 217:rt-thread/components/drivers/serial/serial.c **** 
 701              		.loc 1 217 0
 702 002a B0F1FF3F 		cmp	r0, #-1
 703 002e 04D0     		beq	.L83
 219:rt-thread/components/drivers/serial/serial.c ****         data ++; length --;
 704              		.loc 1 219 0
 705 0030 05F8010B 		strb	r0, [r5], #1
 706              	.LVL86:
 220:rt-thread/components/drivers/serial/serial.c **** 
 707              		.loc 1 220 0
 708 0034 013C     		subs	r4, r4, #1
 709              	.LVL87:
 222:rt-thread/components/drivers/serial/serial.c ****     }
 710              		.loc 1 222 0
 711 0036 0A28     		cmp	r0, #10
 712 0038 F2D1     		bne	.L82
 713              	.LVL88:
 714              	.L83:
 225:rt-thread/components/drivers/serial/serial.c **** }
 715              		.loc 1 225 0
 716 003a 301B     		subs	r0, r6, r4
 717              	.LVL89:
 718              	.LBE28:
 719              	.LBE27:
 814:rt-thread/components/drivers/serial/serial.c **** }
 720              		.loc 1 814 0
 721 003c BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 722              	.LVL90:
 723              	.L88:
 805:rt-thread/components/drivers/serial/serial.c ****     }
 724              		.loc 1 805 0
 725 0040 A046     		mov	r8, r4
 726              	.LVL91:
 727              	.LBB29:
 728              	.LBB30:
 265:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(rx_fifo != RT_NULL);
 729              		.loc 1 265 0
 730 0042 866B     		ldr	r6, [r0, #56]
 731              	.LVL92:
ARM GAS  /tmp/ccebIloK.s 			page 34


 732 0044 0FE0     		b	.L69
 733              	.LVL93:
 734              	.L91:
 735              	.LBB31:
 278:rt-thread/components/drivers/serial/serial.c ****         {
 736              		.loc 1 278 0
 737 0046 B268     		ldr	r2, [r6, #8]
 738 0048 AAB9     		cbnz	r2, .L70
 281:rt-thread/components/drivers/serial/serial.c ****             break;
 739              		.loc 1 281 0
 740 004a FFF7FEFF 		bl	rt_hw_interrupt_enable
 741              	.LVL94:
 742              	.L71:
 743              	.LBE31:
 302:rt-thread/components/drivers/serial/serial.c **** }
 744              		.loc 1 302 0
 745 004e A8EB0400 		sub	r0, r8, r4
 746              	.LVL95:
 747              	.LBE30:
 748              	.LBE29:
 805:rt-thread/components/drivers/serial/serial.c ****     }
 749              		.loc 1 805 0
 750 0052 BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 751              	.LVL96:
 752              	.L72:
 753              	.LBB35:
 754              	.LBB34:
 755              	.LBB32:
 290:rt-thread/components/drivers/serial/serial.c ****         {
 756              		.loc 1 290 0
 757 0056 B368     		ldr	r3, [r6, #8]
 758 0058 012B     		cmp	r3, #1
 759 005a 1AD0     		beq	.L90
 760              	.L73:
 296:rt-thread/components/drivers/serial/serial.c **** 
 761              		.loc 1 296 0
 762 005c FFF7FEFF 		bl	rt_hw_interrupt_enable
 763              	.LVL97:
 298:rt-thread/components/drivers/serial/serial.c ****         data ++; length --;
 764              		.loc 1 298 0
 765 0060 05F8019B 		strb	r9, [r5], #1
 766              	.LVL98:
 299:rt-thread/components/drivers/serial/serial.c ****     }
 767              		.loc 1 299 0
 768 0064 013C     		subs	r4, r4, #1
 769              	.LVL99:
 770              	.L69:
 771              	.LBE32:
 269:rt-thread/components/drivers/serial/serial.c ****     {
 772              		.loc 1 269 0
 773 0066 002C     		cmp	r4, #0
 774 0068 F1D0     		beq	.L71
 775              	.LBB33:
 275:rt-thread/components/drivers/serial/serial.c **** 
 776              		.loc 1 275 0
 777 006a FFF7FEFF 		bl	rt_hw_interrupt_disable
 778              	.LVL100:
ARM GAS  /tmp/ccebIloK.s 			page 35


 278:rt-thread/components/drivers/serial/serial.c ****         {
 779              		.loc 1 278 0
 780 006e F388     		ldrh	r3, [r6, #6]
 781 0070 B288     		ldrh	r2, [r6, #4]
 782 0072 9342     		cmp	r3, r2
 783 0074 E7D0     		beq	.L91
 784              	.L70:
 286:rt-thread/components/drivers/serial/serial.c ****         rx_fifo->get_index += 1;
 785              		.loc 1 286 0
 786 0076 3268     		ldr	r2, [r6]
 787 0078 12F80390 		ldrb	r9, [r2, r3]	@ zero_extendqisi2
 788              	.LVL101:
 287:rt-thread/components/drivers/serial/serial.c ****         if (rx_fifo->get_index >= serial->config.bufsz) rx_fifo->get_index = 0;
 789              		.loc 1 287 0
 790 007c 0133     		adds	r3, r3, #1
 791 007e 9BB2     		uxth	r3, r3
 792 0080 F380     		strh	r3, [r6, #6]	@ movhi
 288:rt-thread/components/drivers/serial/serial.c **** 
 793              		.loc 1 288 0
 794 0082 7A6B     		ldr	r2, [r7, #52]
 795 0084 C2F38F22 		ubfx	r2, r2, #10, #16
 796 0088 9342     		cmp	r3, r2
 797 008a E4D3     		bcc	.L72
 798 008c 0023     		movs	r3, #0
 799 008e F380     		strh	r3, [r6, #6]	@ movhi
 800 0090 E1E7     		b	.L72
 801              	.L90:
 292:rt-thread/components/drivers/serial/serial.c ****         }
 802              		.loc 1 292 0
 803 0092 0023     		movs	r3, #0
 804 0094 B360     		str	r3, [r6, #8]
 805 0096 E1E7     		b	.L73
 806              	.LVL102:
 807              	.L89:
 808              	.LBE33:
 809              	.LBE34:
 810              	.LBE35:
 810:rt-thread/components/drivers/serial/serial.c ****     }
 811              		.loc 1 810 0
 812 0098 2646     		mov	r6, r4
 813              	.LVL103:
 814              	.LBB36:
 815              	.LBB37:
 459:rt-thread/components/drivers/serial/serial.c **** 
 816              		.loc 1 459 0
 817 009a FFF7FEFF 		bl	rt_hw_interrupt_disable
 818              	.LVL104:
 819 009e 8046     		mov	r8, r0
 820              	.LVL105:
 461:rt-thread/components/drivers/serial/serial.c ****     {
 821              		.loc 1 461 0
 822 00a0 7A6B     		ldr	r2, [r7, #52]
 823 00a2 284B     		ldr	r3, .L92
 824 00a4 1340     		ands	r3, r3, r2
 825 00a6 CBB9     		cbnz	r3, .L76
 826              	.LVL106:
 827              	.LBB38:
ARM GAS  /tmp/ccebIloK.s 			page 36


 466:rt-thread/components/drivers/serial/serial.c ****         RT_ASSERT(rx_dma != RT_NULL);
 828              		.loc 1 466 0
 829 00a8 BA6B     		ldr	r2, [r7, #56]
 830              	.LVL107:
 469:rt-thread/components/drivers/serial/serial.c ****         {
 831              		.loc 1 469 0
 832 00aa 1368     		ldr	r3, [r2]
 833 00ac 012B     		cmp	r3, #1
 834 00ae 12D0     		beq	.L86
 471:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(serial->ops->dma_transmit != RT_NULL);
 835              		.loc 1 471 0
 836 00b0 0123     		movs	r3, #1
 837 00b2 1360     		str	r3, [r2]
 473:rt-thread/components/drivers/serial/serial.c ****         }
 838              		.loc 1 473 0
 839 00b4 FA6A     		ldr	r2, [r7, #44]
 840              	.LVL108:
 841 00b6 D2F81090 		ldr	r9, [r2, #16]
 842 00ba 2246     		mov	r2, r4
 843 00bc 2946     		mov	r1, r5
 844 00be 3846     		mov	r0, r7
 845              	.LVL109:
 846 00c0 C847     		blx	r9
 847              	.LVL110:
 463:rt-thread/components/drivers/serial/serial.c ****         struct rt_serial_rx_dma *rx_dma;
 848              		.loc 1 463 0
 849 00c2 0024     		movs	r4, #0
 850              	.LVL111:
 851              	.L77:
 476:rt-thread/components/drivers/serial/serial.c **** 
 852              		.loc 1 476 0
 853 00c4 4046     		mov	r0, r8
 854 00c6 FFF7FEFF 		bl	rt_hw_interrupt_enable
 855              	.LVL112:
 478:rt-thread/components/drivers/serial/serial.c **** 
 856              		.loc 1 478 0
 857 00ca 1CB3     		cbz	r4, .L78
 480:rt-thread/components/drivers/serial/serial.c ****         return 0;
 858              		.loc 1 480 0
 859 00cc 2046     		mov	r0, r4
 860 00ce FFF7FEFF 		bl	rt_set_errno
 861              	.LVL113:
 481:rt-thread/components/drivers/serial/serial.c ****     }
 862              		.loc 1 481 0
 863 00d2 0026     		movs	r6, #0
 864              	.LVL114:
 865 00d4 1EE0     		b	.L78
 866              	.LVL115:
 867              	.L86:
 475:rt-thread/components/drivers/serial/serial.c ****         rt_hw_interrupt_enable(level);
 868              		.loc 1 475 0
 869 00d6 6FF00604 		mvn	r4, #6
 870              	.LVL116:
 871 00da F3E7     		b	.L77
 872              	.LVL117:
 873              	.L76:
 874              	.LBE38:
ARM GAS  /tmp/ccebIloK.s 			page 37


 875              	.LBB39:
 485:rt-thread/components/drivers/serial/serial.c ****         rt_size_t recv_len = 0, fifo_recved_len = rt_dma_calc_recved_len(serial);
 876              		.loc 1 485 0
 877 00dc BE6B     		ldr	r6, [r7, #56]
 878              	.LVL118:
 486:rt-thread/components/drivers/serial/serial.c **** 
 879              		.loc 1 486 0
 880 00de 3846     		mov	r0, r7
 881              	.LVL119:
 882 00e0 FFF7FEFF 		bl	rt_dma_calc_recved_len
 883              	.LVL120:
 490:rt-thread/components/drivers/serial/serial.c ****             recv_len = length;
 884              		.loc 1 490 0
 885 00e4 8442     		cmp	r4, r0
 886 00e6 00DB     		blt	.L79
 493:rt-thread/components/drivers/serial/serial.c **** 
 887              		.loc 1 493 0
 888 00e8 0446     		mov	r4, r0
 889              	.LVL121:
 890              	.L79:
 495:rt-thread/components/drivers/serial/serial.c ****             rt_memcpy(data, rx_fifo->buffer + rx_fifo->get_index, recv_len);
 891              		.loc 1 495 0
 892 00ea F388     		ldrh	r3, [r6, #6]
 893 00ec 1919     		adds	r1, r3, r4
 894 00ee 7A6B     		ldr	r2, [r7, #52]
 895 00f0 C2F38F22 		ubfx	r2, r2, #10, #16
 896 00f4 9142     		cmp	r1, r2
 897 00f6 10D2     		bcs	.L80
 496:rt-thread/components/drivers/serial/serial.c ****         else
 898              		.loc 1 496 0
 899 00f8 3168     		ldr	r1, [r6]
 900 00fa 2246     		mov	r2, r4
 901 00fc 1944     		add	r1, r1, r3
 902 00fe 2846     		mov	r0, r5
 903              	.LVL122:
 904 0100 FFF7FEFF 		bl	rt_memcpy
 905              	.LVL123:
 906              	.L81:
 504:rt-thread/components/drivers/serial/serial.c ****         rt_hw_interrupt_enable(level);
 907              		.loc 1 504 0
 908 0104 2146     		mov	r1, r4
 909 0106 3846     		mov	r0, r7
 910 0108 FFF7FEFF 		bl	rt_dma_recv_update_get_index
 911              	.LVL124:
 505:rt-thread/components/drivers/serial/serial.c ****         return recv_len;
 912              		.loc 1 505 0
 913 010c 4046     		mov	r0, r8
 914 010e FFF7FEFF 		bl	rt_hw_interrupt_enable
 915              	.LVL125:
 506:rt-thread/components/drivers/serial/serial.c ****     }
 916              		.loc 1 506 0
 917 0112 2646     		mov	r6, r4
 918              	.LVL126:
 919              	.L78:
 920              	.LBE39:
 921              	.LBE37:
 922              	.LBE36:
ARM GAS  /tmp/ccebIloK.s 			page 38


 810:rt-thread/components/drivers/serial/serial.c ****     }
 923              		.loc 1 810 0
 924 0114 3046     		mov	r0, r6
 925 0116 BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 926              	.LVL127:
 927              	.L80:
 928              	.LBB42:
 929              	.LBB41:
 930              	.LBB40:
 499:rt-thread/components/drivers/serial/serial.c ****                     serial->config.bufsz - rx_fifo->get_index);
 931              		.loc 1 499 0
 932 011a 3168     		ldr	r1, [r6]
 933 011c D21A     		subs	r2, r2, r3
 934 011e 1944     		add	r1, r1, r3
 935 0120 2846     		mov	r0, r5
 936              	.LVL128:
 937 0122 FFF7FEFF 		bl	rt_memcpy
 938              	.LVL129:
 501:rt-thread/components/drivers/serial/serial.c ****                     recv_len + rx_fifo->get_index - serial->config.bufsz);
 939              		.loc 1 501 0
 940 0126 7B6B     		ldr	r3, [r7, #52]
 941 0128 C3F38F23 		ubfx	r3, r3, #10, #16
 942 012c F288     		ldrh	r2, [r6, #6]
 943 012e 981A     		subs	r0, r3, r2
 502:rt-thread/components/drivers/serial/serial.c ****         }
 944              		.loc 1 502 0
 945 0130 2244     		add	r2, r2, r4
 501:rt-thread/components/drivers/serial/serial.c ****                     recv_len + rx_fifo->get_index - serial->config.bufsz);
 946              		.loc 1 501 0
 947 0132 D21A     		subs	r2, r2, r3
 948 0134 3168     		ldr	r1, [r6]
 949 0136 2844     		add	r0, r0, r5
 950 0138 FFF7FEFF 		bl	rt_memcpy
 951              	.LVL130:
 952 013c E2E7     		b	.L81
 953              	.LVL131:
 954              	.L85:
 955              	.LBE40:
 956              	.LBE41:
 957              	.LBE42:
 799:rt-thread/components/drivers/serial/serial.c **** 
 958              		.loc 1 799 0
 959 013e 1846     		mov	r0, r3
 960              	.LVL132:
 815:rt-thread/components/drivers/serial/serial.c **** 
 961              		.loc 1 815 0
 962 0140 BDE8F883 		pop	{r3, r4, r5, r6, r7, r8, r9, pc}
 963              	.LVL133:
 964              	.L93:
 965              		.align	2
 966              	.L92:
 967 0144 00FCFF03 		.word	67107840
 968              		.cfi_endproc
 969              	.LFE33:
 971              		.section	.text.rt_serial_close,"ax",%progbits
 972              		.align	1
 973              		.syntax unified
ARM GAS  /tmp/ccebIloK.s 			page 39


 974              		.thumb
 975              		.thumb_func
 976              		.fpu fpv4-sp-d16
 978              	rt_serial_close:
 979              	.LFB32:
 715:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 980              		.loc 1 715 0
 981              		.cfi_startproc
 982              		@ args = 0, pretend = 0, frame = 0
 983              		@ frame_needed = 0, uses_anonymous_args = 0
 984              	.LVL134:
 722:rt-thread/components/drivers/serial/serial.c **** 
 985              		.loc 1 722 0
 986 0000 837E     		ldrb	r3, [r0, #26]	@ zero_extendqisi2
 987 0002 012B     		cmp	r3, #1
 988 0004 01D9     		bls	.L105
 789:rt-thread/components/drivers/serial/serial.c **** 
 989              		.loc 1 789 0
 990 0006 0020     		movs	r0, #0
 991              	.LVL135:
 992 0008 7047     		bx	lr
 993              	.LVL136:
 994              	.L105:
 715:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 995              		.loc 1 715 0
 996 000a 10B5     		push	{r4, lr}
 997              	.LCFI8:
 998              		.cfi_def_cfa_offset 8
 999              		.cfi_offset 4, -8
 1000              		.cfi_offset 14, -4
 1001 000c 0446     		mov	r4, r0
 724:rt-thread/components/drivers/serial/serial.c ****     {
 1002              		.loc 1 724 0
 1003 000e 038B     		ldrh	r3, [r0, #24]
 1004 0010 13F4807F 		tst	r3, #256
 1005 0014 1FD1     		bne	.L106
 738:rt-thread/components/drivers/serial/serial.c ****     {
 1006              		.loc 1 738 0
 1007 0016 13F4007F 		tst	r3, #512
 1008 001a 13D0     		beq	.L97
 740:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_rx_dma* rx_dma;
 1009              		.loc 1 740 0
 1010 001c 426B     		ldr	r2, [r0, #52]
 1011 001e 264B     		ldr	r3, .L109
 1012 0020 1340     		ands	r3, r3, r2
 1013 0022 4BBB     		cbnz	r3, .L98
 1014              	.LVL137:
 1015              	.LBB43:
 746:rt-thread/components/drivers/serial/serial.c ****         } else {
 1016              		.loc 1 746 0
 1017 0024 806B     		ldr	r0, [r0, #56]
 1018              	.LVL138:
 1019 0026 FFF7FEFF 		bl	rt_free
 1020              	.LVL139:
 1021              	.L99:
 1022              	.LBE43:
 756:rt-thread/components/drivers/serial/serial.c ****         serial->serial_rx = RT_NULL;
ARM GAS  /tmp/ccebIloK.s 			page 40


 1023              		.loc 1 756 0
 1024 002a E36A     		ldr	r3, [r4, #44]
 1025 002c 5B68     		ldr	r3, [r3, #4]
 1026 002e 4FF40072 		mov	r2, #512
 1027 0032 1121     		movs	r1, #17
 1028 0034 2046     		mov	r0, r4
 1029 0036 9847     		blx	r3
 1030              	.LVL140:
 757:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_DMA_RX;
 1031              		.loc 1 757 0
 1032 0038 0023     		movs	r3, #0
 1033 003a A363     		str	r3, [r4, #56]
 758:rt-thread/components/drivers/serial/serial.c ****     }
 1034              		.loc 1 758 0
 1035 003c 238B     		ldrh	r3, [r4, #24]
 1036 003e 23F40073 		bic	r3, r3, #512
 1037 0042 2383     		strh	r3, [r4, #24]	@ movhi
 1038              	.L97:
 762:rt-thread/components/drivers/serial/serial.c ****     {
 1039              		.loc 1 762 0
 1040 0044 238B     		ldrh	r3, [r4, #24]
 1041 0046 13F4806F 		tst	r3, #1024
 1042 004a 19D1     		bne	.L107
 776:rt-thread/components/drivers/serial/serial.c ****     {
 1043              		.loc 1 776 0
 1044 004c 13F4006F 		tst	r3, #2048
 1045 0050 27D1     		bne	.L108
 1046              	.L95:
 789:rt-thread/components/drivers/serial/serial.c **** 
 1047              		.loc 1 789 0
 1048 0052 0020     		movs	r0, #0
 1049 0054 10BD     		pop	{r4, pc}
 1050              	.LVL141:
 1051              	.L106:
 1052              	.LBB44:
 731:rt-thread/components/drivers/serial/serial.c ****         serial->serial_rx = RT_NULL;
 1053              		.loc 1 731 0
 1054 0056 806B     		ldr	r0, [r0, #56]
 1055              	.LVL142:
 1056 0058 FFF7FEFF 		bl	rt_free
 1057              	.LVL143:
 732:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_INT_RX;
 1058              		.loc 1 732 0
 1059 005c 0023     		movs	r3, #0
 1060 005e A363     		str	r3, [r4, #56]
 733:rt-thread/components/drivers/serial/serial.c ****         /* configure low level device */
 1061              		.loc 1 733 0
 1062 0060 238B     		ldrh	r3, [r4, #24]
 1063 0062 23F48073 		bic	r3, r3, #256
 1064 0066 2383     		strh	r3, [r4, #24]	@ movhi
 735:rt-thread/components/drivers/serial/serial.c ****     }
 1065              		.loc 1 735 0
 1066 0068 E36A     		ldr	r3, [r4, #44]
 1067 006a 5B68     		ldr	r3, [r3, #4]
 1068 006c 4FF48072 		mov	r2, #256
 1069 0070 1121     		movs	r1, #17
 1070 0072 2046     		mov	r0, r4
ARM GAS  /tmp/ccebIloK.s 			page 41


 1071 0074 9847     		blx	r3
 1072              	.LVL144:
 1073              	.LBE44:
 1074 0076 E5E7     		b	.L97
 1075              	.LVL145:
 1076              	.L98:
 1077              	.LBB45:
 753:rt-thread/components/drivers/serial/serial.c ****         }
 1078              		.loc 1 753 0
 1079 0078 806B     		ldr	r0, [r0, #56]
 1080              	.LVL146:
 1081 007a FFF7FEFF 		bl	rt_free
 1082              	.LVL147:
 1083 007e D4E7     		b	.L99
 1084              	.L107:
 1085              	.LVL148:
 1086              	.LBE45:
 1087              	.LBB46:
 769:rt-thread/components/drivers/serial/serial.c ****         serial->serial_tx = RT_NULL;
 1088              		.loc 1 769 0
 1089 0080 E06B     		ldr	r0, [r4, #60]
 1090 0082 FFF7FEFF 		bl	rt_free
 1091              	.LVL149:
 770:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_INT_TX;
 1092              		.loc 1 770 0
 1093 0086 0023     		movs	r3, #0
 1094 0088 E363     		str	r3, [r4, #60]
 771:rt-thread/components/drivers/serial/serial.c ****         /* configure low level device */
 1095              		.loc 1 771 0
 1096 008a 238B     		ldrh	r3, [r4, #24]
 1097 008c 23F48063 		bic	r3, r3, #1024
 1098 0090 2383     		strh	r3, [r4, #24]	@ movhi
 773:rt-thread/components/drivers/serial/serial.c ****     }
 1099              		.loc 1 773 0
 1100 0092 E36A     		ldr	r3, [r4, #44]
 1101 0094 5B68     		ldr	r3, [r3, #4]
 1102 0096 4FF48062 		mov	r2, #1024
 1103 009a 1121     		movs	r1, #17
 1104 009c 2046     		mov	r0, r4
 1105 009e 9847     		blx	r3
 1106              	.LVL150:
 1107              	.LBE46:
 1108 00a0 D7E7     		b	.L95
 1109              	.L108:
 1110              	.LVL151:
 1111              	.LBB47:
 783:rt-thread/components/drivers/serial/serial.c ****         serial->serial_tx = RT_NULL;
 1112              		.loc 1 783 0
 1113 00a2 E06B     		ldr	r0, [r4, #60]
 1114 00a4 FFF7FEFF 		bl	rt_free
 1115              	.LVL152:
 784:rt-thread/components/drivers/serial/serial.c ****         dev->open_flag &= ~RT_DEVICE_FLAG_DMA_TX;
 1116              		.loc 1 784 0
 1117 00a8 0023     		movs	r3, #0
 1118 00aa E363     		str	r3, [r4, #60]
 785:rt-thread/components/drivers/serial/serial.c ****     }
 1119              		.loc 1 785 0
ARM GAS  /tmp/ccebIloK.s 			page 42


 1120 00ac 238B     		ldrh	r3, [r4, #24]
 1121 00ae 23F40063 		bic	r3, r3, #2048
 1122 00b2 2383     		strh	r3, [r4, #24]	@ movhi
 1123 00b4 CDE7     		b	.L95
 1124              	.L110:
 1125 00b6 00BF     		.align	2
 1126              	.L109:
 1127 00b8 00FCFF03 		.word	67107840
 1128              	.LBE47:
 1129              		.cfi_endproc
 1130              	.LFE32:
 1132              		.section	.text.rt_serial_open,"ax",%progbits
 1133              		.align	1
 1134              		.syntax unified
 1135              		.thumb
 1136              		.thumb_func
 1137              		.fpu fpv4-sp-d16
 1139              	rt_serial_open:
 1140              	.LFB31:
 569:rt-thread/components/drivers/serial/serial.c ****     rt_uint16_t stream_flag = 0;
 1141              		.loc 1 569 0
 1142              		.cfi_startproc
 1143              		@ args = 0, pretend = 0, frame = 0
 1144              		@ frame_needed = 0, uses_anonymous_args = 0
 1145              	.LVL153:
 1146 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1147              	.LCFI9:
 1148              		.cfi_def_cfa_offset 24
 1149              		.cfi_offset 4, -24
 1150              		.cfi_offset 5, -20
 1151              		.cfi_offset 6, -16
 1152              		.cfi_offset 7, -12
 1153              		.cfi_offset 8, -8
 1154              		.cfi_offset 14, -4
 1155              	.LVL154:
 579:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1156              		.loc 1 579 0
 1157 0004 11F4007E 		ands	lr, r1, #512
 1158 0008 04D0     		beq	.L112
 579:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1159              		.loc 1 579 0 is_stmt 0 discriminator 1
 1160 000a C38A     		ldrh	r3, [r0, #22]
 1161 000c 13F4007F 		tst	r3, #512
 1162 0010 00F0D980 		beq	.L130
 1163              	.L112:
 581:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1164              		.loc 1 581 0 is_stmt 1
 1165 0014 11F40066 		ands	r6, r1, #2048
 1166 0018 04D0     		beq	.L114
 581:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1167              		.loc 1 581 0 is_stmt 0 discriminator 1
 1168 001a C38A     		ldrh	r3, [r0, #22]
 1169 001c 13F4006F 		tst	r3, #2048
 1170 0020 00F0D580 		beq	.L131
 1171              	.L114:
 583:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1172              		.loc 1 583 0 is_stmt 1
ARM GAS  /tmp/ccebIloK.s 			page 43


 1173 0024 11F48073 		ands	r3, r1, #256
 1174 0028 04D0     		beq	.L115
 583:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1175              		.loc 1 583 0 is_stmt 0 discriminator 1
 1176 002a C28A     		ldrh	r2, [r0, #22]
 1177 002c 12F4807F 		tst	r2, #256
 1178 0030 00F0D180 		beq	.L132
 1179              	.L115:
 585:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1180              		.loc 1 585 0 is_stmt 1
 1181 0034 11F48065 		ands	r5, r1, #1024
 1182 0038 04D0     		beq	.L116
 585:rt-thread/components/drivers/serial/serial.c ****         return -RT_EIO;
 1183              		.loc 1 585 0 is_stmt 0 discriminator 1
 1184 003a C28A     		ldrh	r2, [r0, #22]
 1185 003c 12F4806F 		tst	r2, #1024
 1186 0040 00F0CD80 		beq	.L133
 1187              	.L116:
 589:rt-thread/components/drivers/serial/serial.c ****         stream_flag = RT_DEVICE_FLAG_STREAM;
 1188              		.loc 1 589 0 is_stmt 1
 1189 0044 11F0400F 		tst	r1, #64
 1190 0048 05D1     		bne	.L134
 589:rt-thread/components/drivers/serial/serial.c ****         stream_flag = RT_DEVICE_FLAG_STREAM;
 1191              		.loc 1 589 0 is_stmt 0 discriminator 1
 1192 004a 028B     		ldrh	r2, [r0, #24]
 1193 004c 12F0400F 		tst	r2, #64
 1194 0050 1CD1     		bne	.L135
 570:rt-thread/components/drivers/serial/serial.c ****     struct rt_serial_device *serial;
 1195              		.loc 1 570 0 is_stmt 1
 1196 0052 0024     		movs	r4, #0
 1197 0054 00E0     		b	.L117
 1198              	.L134:
 590:rt-thread/components/drivers/serial/serial.c **** 
 1199              		.loc 1 590 0
 1200 0056 4024     		movs	r4, #64
 1201              	.L117:
 1202 0058 0746     		mov	r7, r0
 1203              	.LVL155:
 593:rt-thread/components/drivers/serial/serial.c **** 
 1204              		.loc 1 593 0
 1205 005a C9B2     		uxtb	r1, r1
 1206              	.LVL156:
 1207 005c 0183     		strh	r1, [r0, #24]	@ movhi
 596:rt-thread/components/drivers/serial/serial.c ****     { 
 1208              		.loc 1 596 0
 1209 005e 826B     		ldr	r2, [r0, #56]
 1210 0060 B2B1     		cbz	r2, .L137
 652:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_RX;
 1211              		.loc 1 652 0
 1212 0062 002B     		cmp	r3, #0
 1213 0064 70D0     		beq	.L124
 653:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 1214              		.loc 1 653 0
 1215 0066 41F48071 		orr	r1, r1, #256
 1216 006a 0183     		strh	r1, [r0, #24]	@ movhi
 1217              	.LVL157:
 1218              	.L120:
ARM GAS  /tmp/ccebIloK.s 			page 44


 660:rt-thread/components/drivers/serial/serial.c ****     {
 1219              		.loc 1 660 0
 1220 006c FB6B     		ldr	r3, [r7, #60]
 1221 006e 002B     		cmp	r3, #0
 1222 0070 71D0     		beq	.L138
 700:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_TX;
 1223              		.loc 1 700 0
 1224 0072 002D     		cmp	r5, #0
 1225 0074 00F09F80 		beq	.L129
 701:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
 1226              		.loc 1 701 0
 1227 0078 3B8B     		ldrh	r3, [r7, #24]
 1228 007a 43F48063 		orr	r3, r3, #1024
 1229 007e 3B83     		strh	r3, [r7, #24]	@ movhi
 1230              	.L127:
 709:rt-thread/components/drivers/serial/serial.c **** 
 1231              		.loc 1 709 0
 1232 0080 3B8B     		ldrh	r3, [r7, #24]
 1233 0082 1C43     		orrs	r4, r4, r3
 1234              	.LVL158:
 1235 0084 3C83     		strh	r4, [r7, #24]	@ movhi
 711:rt-thread/components/drivers/serial/serial.c **** }
 1236              		.loc 1 711 0
 1237 0086 0020     		movs	r0, #0
 1238 0088 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1239              	.LVL159:
 1240              	.L135:
 590:rt-thread/components/drivers/serial/serial.c **** 
 1241              		.loc 1 590 0
 1242 008c 4024     		movs	r4, #64
 1243 008e E3E7     		b	.L117
 1244              	.LVL160:
 1245              	.L137:
 598:rt-thread/components/drivers/serial/serial.c ****         {
 1246              		.loc 1 598 0
 1247 0090 8BB9     		cbnz	r3, .L139
 617:rt-thread/components/drivers/serial/serial.c ****         {
 1248              		.loc 1 617 0
 1249 0092 BEF1000F 		cmp	lr, #0
 1250 0096 54D0     		beq	.L121
 619:rt-thread/components/drivers/serial/serial.c ****                 struct rt_serial_rx_dma* rx_dma;
 1251              		.loc 1 619 0
 1252 0098 426B     		ldr	r2, [r0, #52]
 1253 009a 534B     		ldr	r3, .L142
 1254 009c 1340     		ands	r3, r3, r2
 1255 009e 7BBB     		cbnz	r3, .L122
 1256              	.LBB48:
 622:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(rx_dma != RT_NULL);
 1257              		.loc 1 622 0
 1258 00a0 0420     		movs	r0, #4
 1259              	.LVL161:
 1260 00a2 FFF7FEFF 		bl	rt_malloc
 1261              	.LVL162:
 624:rt-thread/components/drivers/serial/serial.c **** 
 1262              		.loc 1 624 0
 1263 00a6 0023     		movs	r3, #0
 1264 00a8 0360     		str	r3, [r0]
ARM GAS  /tmp/ccebIloK.s 			page 45


 626:rt-thread/components/drivers/serial/serial.c ****             } else {
 1265              		.loc 1 626 0
 1266 00aa B863     		str	r0, [r7, #56]
 1267              	.LVL163:
 1268              	.L123:
 1269              	.LBE48:
 642:rt-thread/components/drivers/serial/serial.c ****         }
 1270              		.loc 1 642 0
 1271 00ac 3B8B     		ldrh	r3, [r7, #24]
 1272 00ae 43F40073 		orr	r3, r3, #512
 1273 00b2 3B83     		strh	r3, [r7, #24]	@ movhi
 1274 00b4 DAE7     		b	.L120
 1275              	.LVL164:
 1276              	.L139:
 1277              	.LBB49:
 603:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(rx_fifo != RT_NULL);
 1278              		.loc 1 603 0
 1279 00b6 406B     		ldr	r0, [r0, #52]
 1280              	.LVL165:
 1281 00b8 C0F38F20 		ubfx	r0, r0, #10, #16
 602:rt-thread/components/drivers/serial/serial.c ****                 serial->config.bufsz);
 1282              		.loc 1 602 0
 1283 00bc 0C30     		adds	r0, r0, #12
 1284 00be FFF7FEFF 		bl	rt_malloc
 1285              	.LVL166:
 1286 00c2 8046     		mov	r8, r0
 1287              	.LVL167:
 605:rt-thread/components/drivers/serial/serial.c ****             rt_memset(rx_fifo->buffer, 0, serial->config.bufsz);
 1288              		.loc 1 605 0
 1289 00c4 0C30     		adds	r0, r0, #12
 1290              	.LVL168:
 1291 00c6 C8F80000 		str	r0, [r8]
 606:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->put_index = 0;
 1292              		.loc 1 606 0
 1293 00ca 7A6B     		ldr	r2, [r7, #52]
 1294 00cc C2F38F22 		ubfx	r2, r2, #10, #16
 1295 00d0 0021     		movs	r1, #0
 1296 00d2 FFF7FEFF 		bl	rt_memset
 1297              	.LVL169:
 607:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->get_index = 0;
 1298              		.loc 1 607 0
 1299 00d6 0023     		movs	r3, #0
 1300 00d8 A8F80430 		strh	r3, [r8, #4]	@ movhi
 608:rt-thread/components/drivers/serial/serial.c ****             rx_fifo->is_full = RT_FALSE;
 1301              		.loc 1 608 0
 1302 00dc A8F80630 		strh	r3, [r8, #6]	@ movhi
 609:rt-thread/components/drivers/serial/serial.c **** 
 1303              		.loc 1 609 0
 1304 00e0 C8F80830 		str	r3, [r8, #8]
 611:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_INT_RX;
 1305              		.loc 1 611 0
 1306 00e4 C7F83880 		str	r8, [r7, #56]
 612:rt-thread/components/drivers/serial/serial.c ****             /* configure low level device */
 1307              		.loc 1 612 0
 1308 00e8 3B8B     		ldrh	r3, [r7, #24]
 1309 00ea 43F48073 		orr	r3, r3, #256
 1310 00ee 3B83     		strh	r3, [r7, #24]	@ movhi
ARM GAS  /tmp/ccebIloK.s 			page 46


 614:rt-thread/components/drivers/serial/serial.c ****         }
 1311              		.loc 1 614 0
 1312 00f0 FB6A     		ldr	r3, [r7, #44]
 1313 00f2 5B68     		ldr	r3, [r3, #4]
 1314 00f4 4FF48072 		mov	r2, #256
 1315 00f8 1021     		movs	r1, #16
 1316 00fa 3846     		mov	r0, r7
 1317 00fc 9847     		blx	r3
 1318              	.LVL170:
 1319              	.LBE49:
 1320 00fe B5E7     		b	.L120
 1321              	.LVL171:
 1322              	.L122:
 1323              	.LBB50:
 631:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(rx_fifo != RT_NULL);
 1324              		.loc 1 631 0
 1325 0100 406B     		ldr	r0, [r0, #52]
 1326              	.LVL172:
 1327 0102 C0F38F20 		ubfx	r0, r0, #10, #16
 630:rt-thread/components/drivers/serial/serial.c ****                     serial->config.bufsz);
 1328              		.loc 1 630 0
 1329 0106 0C30     		adds	r0, r0, #12
 1330 0108 FFF7FEFF 		bl	rt_malloc
 1331              	.LVL173:
 1332 010c 8046     		mov	r8, r0
 1333              	.LVL174:
 633:rt-thread/components/drivers/serial/serial.c ****                 rt_memset(rx_fifo->buffer, 0, serial->config.bufsz);
 1334              		.loc 1 633 0
 1335 010e 0C30     		adds	r0, r0, #12
 1336              	.LVL175:
 1337 0110 C8F80000 		str	r0, [r8]
 634:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->put_index = 0;
 1338              		.loc 1 634 0
 1339 0114 7A6B     		ldr	r2, [r7, #52]
 1340 0116 C2F38F22 		ubfx	r2, r2, #10, #16
 1341 011a 0021     		movs	r1, #0
 1342 011c FFF7FEFF 		bl	rt_memset
 1343              	.LVL176:
 635:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->get_index = 0;
 1344              		.loc 1 635 0
 1345 0120 0023     		movs	r3, #0
 1346 0122 A8F80430 		strh	r3, [r8, #4]	@ movhi
 636:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->is_full = RT_FALSE;
 1347              		.loc 1 636 0
 1348 0126 A8F80630 		strh	r3, [r8, #6]	@ movhi
 637:rt-thread/components/drivers/serial/serial.c ****                 serial->serial_rx = rx_fifo;
 1349              		.loc 1 637 0
 1350 012a C8F80830 		str	r3, [r8, #8]
 638:rt-thread/components/drivers/serial/serial.c ****                 /* configure fifo address and length to low level device */
 1351              		.loc 1 638 0
 1352 012e C7F83880 		str	r8, [r7, #56]
 640:rt-thread/components/drivers/serial/serial.c ****             }
 1353              		.loc 1 640 0
 1354 0132 FB6A     		ldr	r3, [r7, #44]
 1355 0134 5B68     		ldr	r3, [r3, #4]
 1356 0136 4FF40072 		mov	r2, #512
 1357 013a 0321     		movs	r1, #3
ARM GAS  /tmp/ccebIloK.s 			page 47


 1358 013c 3846     		mov	r0, r7
 1359 013e 9847     		blx	r3
 1360              	.LVL177:
 1361 0140 B4E7     		b	.L123
 1362              	.LVL178:
 1363              	.L121:
 1364              	.LBE50:
 647:rt-thread/components/drivers/serial/serial.c ****         }
 1365              		.loc 1 647 0
 1366 0142 0023     		movs	r3, #0
 1367 0144 8363     		str	r3, [r0, #56]
 1368 0146 91E7     		b	.L120
 1369              	.L124:
 655:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_DMA_RX;
 1370              		.loc 1 655 0
 1371 0148 BEF1000F 		cmp	lr, #0
 1372 014c 8ED0     		beq	.L120
 656:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */  
 1373              		.loc 1 656 0
 1374 014e 41F40071 		orr	r1, r1, #512
 1375 0152 0183     		strh	r1, [r0, #24]	@ movhi
 1376 0154 8AE7     		b	.L120
 1377              	.LVL179:
 1378              	.L138:
 662:rt-thread/components/drivers/serial/serial.c ****         {
 1379              		.loc 1 662 0
 1380 0156 1DB9     		cbnz	r5, .L140
 677:rt-thread/components/drivers/serial/serial.c ****         {
 1381              		.loc 1 677 0
 1382 0158 AEB9     		cbnz	r6, .L141
 695:rt-thread/components/drivers/serial/serial.c ****         }
 1383              		.loc 1 695 0
 1384 015a 0023     		movs	r3, #0
 1385 015c FB63     		str	r3, [r7, #60]
 1386 015e 8FE7     		b	.L127
 1387              	.L140:
 1388              	.LBB51:
 666:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(tx_fifo != RT_NULL);
 1389              		.loc 1 666 0
 1390 0160 0C20     		movs	r0, #12
 1391 0162 FFF7FEFF 		bl	rt_malloc
 1392              	.LVL180:
 1393 0166 0546     		mov	r5, r0
 1394              	.LVL181:
 669:rt-thread/components/drivers/serial/serial.c ****             serial->serial_tx = tx_fifo;
 1395              		.loc 1 669 0
 1396 0168 FFF7FEFF 		bl	rt_completion_init
 1397              	.LVL182:
 670:rt-thread/components/drivers/serial/serial.c **** 
 1398              		.loc 1 670 0
 1399 016c FD63     		str	r5, [r7, #60]
 672:rt-thread/components/drivers/serial/serial.c ****             /* configure low level device */
 1400              		.loc 1 672 0
 1401 016e 3B8B     		ldrh	r3, [r7, #24]
 1402 0170 43F48063 		orr	r3, r3, #1024
 1403 0174 3B83     		strh	r3, [r7, #24]	@ movhi
 674:rt-thread/components/drivers/serial/serial.c ****         }
ARM GAS  /tmp/ccebIloK.s 			page 48


 1404              		.loc 1 674 0
 1405 0176 FB6A     		ldr	r3, [r7, #44]
 1406 0178 5B68     		ldr	r3, [r3, #4]
 1407 017a 4FF48062 		mov	r2, #1024
 1408 017e 1021     		movs	r1, #16
 1409 0180 3846     		mov	r0, r7
 1410 0182 9847     		blx	r3
 1411              	.LVL183:
 1412              	.LBE51:
 1413 0184 7CE7     		b	.L127
 1414              	.LVL184:
 1415              	.L141:
 1416              	.LBB52:
 681:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(tx_dma != RT_NULL);
 1417              		.loc 1 681 0
 1418 0186 2820     		movs	r0, #40
 1419 0188 FFF7FEFF 		bl	rt_malloc
 1420              	.LVL185:
 1421 018c 0546     		mov	r5, r0
 1422              	.LVL186:
 683:rt-thread/components/drivers/serial/serial.c **** 
 1423              		.loc 1 683 0
 1424 018e 0023     		movs	r3, #0
 1425 0190 40F8043B 		str	r3, [r0], #4
 1426              	.LVL187:
 685:rt-thread/components/drivers/serial/serial.c ****             serial->serial_tx = tx_dma;
 1427              		.loc 1 685 0
 1428 0194 0422     		movs	r2, #4
 1429 0196 0821     		movs	r1, #8
 1430 0198 FFF7FEFF 		bl	rt_data_queue_init
 1431              	.LVL188:
 686:rt-thread/components/drivers/serial/serial.c **** 
 1432              		.loc 1 686 0
 1433 019c FD63     		str	r5, [r7, #60]
 688:rt-thread/components/drivers/serial/serial.c ****             /* configure low level device */
 1434              		.loc 1 688 0
 1435 019e 3B8B     		ldrh	r3, [r7, #24]
 1436 01a0 43F40063 		orr	r3, r3, #2048
 1437 01a4 3B83     		strh	r3, [r7, #24]	@ movhi
 690:rt-thread/components/drivers/serial/serial.c ****         }
 1438              		.loc 1 690 0
 1439 01a6 FB6A     		ldr	r3, [r7, #44]
 1440 01a8 5B68     		ldr	r3, [r3, #4]
 1441 01aa 4FF40062 		mov	r2, #2048
 1442 01ae 0321     		movs	r1, #3
 1443 01b0 3846     		mov	r0, r7
 1444 01b2 9847     		blx	r3
 1445              	.LVL189:
 1446              	.LBE52:
 1447 01b4 64E7     		b	.L127
 1448              	.LVL190:
 1449              	.L129:
 703:rt-thread/components/drivers/serial/serial.c ****             dev->open_flag |= RT_DEVICE_FLAG_DMA_TX;
 1450              		.loc 1 703 0
 1451 01b6 002E     		cmp	r6, #0
 1452 01b8 3FF462AF 		beq	.L127
 704:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */    
ARM GAS  /tmp/ccebIloK.s 			page 49


 1453              		.loc 1 704 0
 1454 01bc 3B8B     		ldrh	r3, [r7, #24]
 1455 01be 43F40063 		orr	r3, r3, #2048
 1456 01c2 3B83     		strh	r3, [r7, #24]	@ movhi
 1457 01c4 5CE7     		b	.L127
 1458              	.LVL191:
 1459              	.L130:
 580:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_DMA_TX) && !(dev->flag & RT_DEVICE_FLAG_DMA_TX))
 1460              		.loc 1 580 0
 1461 01c6 6FF00700 		mvn	r0, #7
 1462              	.LVL192:
 1463 01ca BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1464              	.LVL193:
 1465              	.L131:
 582:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_INT_RX) && !(dev->flag & RT_DEVICE_FLAG_INT_RX))
 1466              		.loc 1 582 0
 1467 01ce 6FF00700 		mvn	r0, #7
 1468              	.LVL194:
 1469 01d2 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1470              	.LVL195:
 1471              	.L132:
 584:rt-thread/components/drivers/serial/serial.c ****     if ((oflag & RT_DEVICE_FLAG_INT_TX) && !(dev->flag & RT_DEVICE_FLAG_INT_TX))
 1472              		.loc 1 584 0
 1473 01d6 6FF00700 		mvn	r0, #7
 1474              	.LVL196:
 1475 01da BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1476              	.LVL197:
 1477              	.L133:
 586:rt-thread/components/drivers/serial/serial.c **** 
 1478              		.loc 1 586 0
 1479 01de 6FF00700 		mvn	r0, #7
 1480              	.LVL198:
 712:rt-thread/components/drivers/serial/serial.c **** 
 1481              		.loc 1 712 0
 1482 01e2 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1483              	.L143:
 1484 01e6 00BF     		.align	2
 1485              	.L142:
 1486 01e8 00FCFF03 		.word	67107840
 1487              		.cfi_endproc
 1488              	.LFE31:
 1490              		.section	.text.rt_hw_serial_register,"ax",%progbits
 1491              		.align	1
 1492              		.global	rt_hw_serial_register
 1493              		.syntax unified
 1494              		.thumb
 1495              		.thumb_func
 1496              		.fpu fpv4-sp-d16
 1498              	rt_hw_serial_register:
 1499              	.LFB36:
1098:rt-thread/components/drivers/serial/serial.c **** 
1099:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_DEVICE_OPS
1100:rt-thread/components/drivers/serial/serial.c **** const static struct rt_device_ops serial_ops = 
1101:rt-thread/components/drivers/serial/serial.c **** {
1102:rt-thread/components/drivers/serial/serial.c ****     rt_serial_init,
1103:rt-thread/components/drivers/serial/serial.c ****     rt_serial_open,
1104:rt-thread/components/drivers/serial/serial.c ****     rt_serial_close,
ARM GAS  /tmp/ccebIloK.s 			page 50


1105:rt-thread/components/drivers/serial/serial.c ****     rt_serial_read,
1106:rt-thread/components/drivers/serial/serial.c ****     rt_serial_write,
1107:rt-thread/components/drivers/serial/serial.c ****     rt_serial_control
1108:rt-thread/components/drivers/serial/serial.c **** };
1109:rt-thread/components/drivers/serial/serial.c **** #endif
1110:rt-thread/components/drivers/serial/serial.c **** 
1111:rt-thread/components/drivers/serial/serial.c **** /*
1112:rt-thread/components/drivers/serial/serial.c ****  * serial register
1113:rt-thread/components/drivers/serial/serial.c ****  */
1114:rt-thread/components/drivers/serial/serial.c **** rt_err_t rt_hw_serial_register(struct rt_serial_device *serial,
1115:rt-thread/components/drivers/serial/serial.c ****                                const char              *name,
1116:rt-thread/components/drivers/serial/serial.c ****                                rt_uint32_t              flag,
1117:rt-thread/components/drivers/serial/serial.c ****                                void                    *data)
1118:rt-thread/components/drivers/serial/serial.c **** {
 1500              		.loc 1 1118 0
 1501              		.cfi_startproc
 1502              		@ args = 0, pretend = 0, frame = 0
 1503              		@ frame_needed = 0, uses_anonymous_args = 0
 1504              	.LVL199:
 1505 0000 38B5     		push	{r3, r4, r5, lr}
 1506              	.LCFI10:
 1507              		.cfi_def_cfa_offset 16
 1508              		.cfi_offset 3, -16
 1509              		.cfi_offset 4, -12
 1510              		.cfi_offset 5, -8
 1511              		.cfi_offset 14, -4
 1512              	.LVL200:
1119:rt-thread/components/drivers/serial/serial.c ****     rt_err_t ret;
1120:rt-thread/components/drivers/serial/serial.c ****     struct rt_device *device;
1121:rt-thread/components/drivers/serial/serial.c ****     RT_ASSERT(serial != RT_NULL);
1122:rt-thread/components/drivers/serial/serial.c **** 
1123:rt-thread/components/drivers/serial/serial.c ****     device = &(serial->parent);
1124:rt-thread/components/drivers/serial/serial.c **** 
1125:rt-thread/components/drivers/serial/serial.c ****     device->type        = RT_Device_Class_Char;
 1513              		.loc 1 1125 0
 1514 0002 0025     		movs	r5, #0
 1515 0004 0575     		strb	r5, [r0, #20]
1126:rt-thread/components/drivers/serial/serial.c ****     device->rx_indicate = RT_NULL;
 1516              		.loc 1 1126 0
 1517 0006 C561     		str	r5, [r0, #28]
1127:rt-thread/components/drivers/serial/serial.c ****     device->tx_complete = RT_NULL;
 1518              		.loc 1 1127 0
 1519 0008 0562     		str	r5, [r0, #32]
1128:rt-thread/components/drivers/serial/serial.c **** 
1129:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_USING_DEVICE_OPS
1130:rt-thread/components/drivers/serial/serial.c ****     device->ops         = &serial_ops;
 1520              		.loc 1 1130 0
 1521 000a 034D     		ldr	r5, .L146
 1522 000c 4562     		str	r5, [r0, #36]
1131:rt-thread/components/drivers/serial/serial.c **** #else
1132:rt-thread/components/drivers/serial/serial.c ****     device->init        = rt_serial_init;
1133:rt-thread/components/drivers/serial/serial.c ****     device->open        = rt_serial_open;
1134:rt-thread/components/drivers/serial/serial.c ****     device->close       = rt_serial_close;
1135:rt-thread/components/drivers/serial/serial.c ****     device->read        = rt_serial_read;
1136:rt-thread/components/drivers/serial/serial.c ****     device->write       = rt_serial_write;
1137:rt-thread/components/drivers/serial/serial.c ****     device->control     = rt_serial_control;
1138:rt-thread/components/drivers/serial/serial.c **** #endif
ARM GAS  /tmp/ccebIloK.s 			page 51


1139:rt-thread/components/drivers/serial/serial.c ****     device->user_data   = data;
 1523              		.loc 1 1139 0
 1524 000e 8362     		str	r3, [r0, #40]
1140:rt-thread/components/drivers/serial/serial.c **** 
1141:rt-thread/components/drivers/serial/serial.c ****     /* register a character device */
1142:rt-thread/components/drivers/serial/serial.c ****     ret = rt_device_register(device, name, flag);
 1525              		.loc 1 1142 0
 1526 0010 92B2     		uxth	r2, r2
 1527              	.LVL201:
 1528 0012 FFF7FEFF 		bl	rt_device_register
 1529              	.LVL202:
1143:rt-thread/components/drivers/serial/serial.c **** 
1144:rt-thread/components/drivers/serial/serial.c **** #if defined(RT_USING_POSIX)
1145:rt-thread/components/drivers/serial/serial.c ****     /* set fops */
1146:rt-thread/components/drivers/serial/serial.c ****     device->fops        = &_serial_fops;
1147:rt-thread/components/drivers/serial/serial.c **** #endif
1148:rt-thread/components/drivers/serial/serial.c **** 
1149:rt-thread/components/drivers/serial/serial.c ****     return ret;
1150:rt-thread/components/drivers/serial/serial.c **** }
 1530              		.loc 1 1150 0
 1531 0016 38BD     		pop	{r3, r4, r5, pc}
 1532              	.L147:
 1533              		.align	2
 1534              	.L146:
 1535 0018 00000000 		.word	.LANCHOR1
 1536              		.cfi_endproc
 1537              	.LFE36:
 1539              		.section	.text.rt_hw_serial_isr,"ax",%progbits
 1540              		.align	1
 1541              		.global	rt_hw_serial_isr
 1542              		.syntax unified
 1543              		.thumb
 1544              		.thumb_func
 1545              		.fpu fpv4-sp-d16
 1547              	rt_hw_serial_isr:
 1548              	.LFB37:
1151:rt-thread/components/drivers/serial/serial.c **** 
1152:rt-thread/components/drivers/serial/serial.c **** /* ISR for serial interrupt */
1153:rt-thread/components/drivers/serial/serial.c **** void rt_hw_serial_isr(struct rt_serial_device *serial, int event)
1154:rt-thread/components/drivers/serial/serial.c **** {
 1549              		.loc 1 1154 0
 1550              		.cfi_startproc
 1551              		@ args = 0, pretend = 0, frame = 16
 1552              		@ frame_needed = 0, uses_anonymous_args = 0
 1553              	.LVL203:
 1554 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 1555              	.LCFI11:
 1556              		.cfi_def_cfa_offset 20
 1557              		.cfi_offset 4, -20
 1558              		.cfi_offset 5, -16
 1559              		.cfi_offset 6, -12
 1560              		.cfi_offset 7, -8
 1561              		.cfi_offset 14, -4
 1562 0002 85B0     		sub	sp, sp, #20
 1563              	.LCFI12:
 1564              		.cfi_def_cfa_offset 40
 1565 0004 0546     		mov	r5, r0
ARM GAS  /tmp/ccebIloK.s 			page 52


1155:rt-thread/components/drivers/serial/serial.c ****     switch (event & 0xff)
 1566              		.loc 1 1155 0
 1567 0006 CBB2     		uxtb	r3, r1
 1568 0008 013B     		subs	r3, r3, #1
 1569 000a 032B     		cmp	r3, #3
 1570 000c 4FD8     		bhi	.L148
 1571 000e DFE803F0 		tbb	[pc, r3]
 1572              	.L151:
 1573 0012 02       		.byte	(.L150-.L151)/2
 1574 0013 4B       		.byte	(.L152-.L151)/2
 1575 0014 71       		.byte	(.L153-.L151)/2
 1576 0015 50       		.byte	(.L154-.L151)/2
 1577              		.p2align 1
 1578              	.L150:
 1579              	.LVL204:
 1580              	.LBB53:
1156:rt-thread/components/drivers/serial/serial.c ****     {
1157:rt-thread/components/drivers/serial/serial.c ****         case RT_SERIAL_EVENT_RX_IND:
1158:rt-thread/components/drivers/serial/serial.c ****         {
1159:rt-thread/components/drivers/serial/serial.c ****             int ch = -1;
1160:rt-thread/components/drivers/serial/serial.c ****             rt_base_t level;
1161:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_rx_fifo* rx_fifo;
1162:rt-thread/components/drivers/serial/serial.c **** 
1163:rt-thread/components/drivers/serial/serial.c ****             /* interrupt mode receive */
1164:rt-thread/components/drivers/serial/serial.c ****             rx_fifo = (struct rt_serial_rx_fifo*)serial->serial_rx;
 1581              		.loc 1 1164 0
 1582 0016 846B     		ldr	r4, [r0, #56]
 1583              	.LVL205:
 1584 0018 06E0     		b	.L159
 1585              	.LVL206:
 1586              	.L156:
1165:rt-thread/components/drivers/serial/serial.c ****             RT_ASSERT(rx_fifo != RT_NULL);
1166:rt-thread/components/drivers/serial/serial.c **** 
1167:rt-thread/components/drivers/serial/serial.c ****             while (1)
1168:rt-thread/components/drivers/serial/serial.c ****             {
1169:rt-thread/components/drivers/serial/serial.c ****                 ch = serial->ops->getc(serial);
1170:rt-thread/components/drivers/serial/serial.c ****                 if (ch == -1) break;
1171:rt-thread/components/drivers/serial/serial.c **** 
1172:rt-thread/components/drivers/serial/serial.c **** 
1173:rt-thread/components/drivers/serial/serial.c ****                 /* disable interrupt */
1174:rt-thread/components/drivers/serial/serial.c ****                 level = rt_hw_interrupt_disable();
1175:rt-thread/components/drivers/serial/serial.c **** 
1176:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->buffer[rx_fifo->put_index] = ch;
1177:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->put_index += 1;
1178:rt-thread/components/drivers/serial/serial.c ****                 if (rx_fifo->put_index >= serial->config.bufsz) rx_fifo->put_index = 0;
1179:rt-thread/components/drivers/serial/serial.c **** 
1180:rt-thread/components/drivers/serial/serial.c ****                 /* if the next position is read index, discard this 'read char' */
1181:rt-thread/components/drivers/serial/serial.c ****                 if (rx_fifo->put_index == rx_fifo->get_index)
 1587              		.loc 1 1181 0
 1588 001a A288     		ldrh	r2, [r4, #4]
 1589 001c E388     		ldrh	r3, [r4, #6]
 1590 001e 9A42     		cmp	r2, r3
 1591 0020 1CD0     		beq	.L167
 1592              	.LVL207:
 1593              	.L157:
1182:rt-thread/components/drivers/serial/serial.c ****                 {
1183:rt-thread/components/drivers/serial/serial.c ****                     rx_fifo->get_index += 1;
ARM GAS  /tmp/ccebIloK.s 			page 53


1184:rt-thread/components/drivers/serial/serial.c ****                     rx_fifo->is_full = RT_TRUE;
1185:rt-thread/components/drivers/serial/serial.c ****                     if (rx_fifo->get_index >= serial->config.bufsz) rx_fifo->get_index = 0;
1186:rt-thread/components/drivers/serial/serial.c **** 
1187:rt-thread/components/drivers/serial/serial.c ****                     _serial_check_buffer_size();
1188:rt-thread/components/drivers/serial/serial.c ****                 }
1189:rt-thread/components/drivers/serial/serial.c **** 
1190:rt-thread/components/drivers/serial/serial.c ****                 /* enable interrupt */
1191:rt-thread/components/drivers/serial/serial.c ****                 rt_hw_interrupt_enable(level);
 1594              		.loc 1 1191 0
 1595 0022 3046     		mov	r0, r6
 1596 0024 FFF7FEFF 		bl	rt_hw_interrupt_enable
 1597              	.LVL208:
 1598              	.L159:
1169:rt-thread/components/drivers/serial/serial.c ****                 if (ch == -1) break;
 1599              		.loc 1 1169 0
 1600 0028 EB6A     		ldr	r3, [r5, #44]
 1601 002a DB68     		ldr	r3, [r3, #12]
 1602 002c 2846     		mov	r0, r5
 1603 002e 9847     		blx	r3
 1604              	.LVL209:
 1605 0030 0746     		mov	r7, r0
 1606              	.LVL210:
1170:rt-thread/components/drivers/serial/serial.c **** 
 1607              		.loc 1 1170 0
 1608 0032 B0F1FF3F 		cmp	r0, #-1
 1609 0036 20D0     		beq	.L155
1174:rt-thread/components/drivers/serial/serial.c **** 
 1610              		.loc 1 1174 0
 1611 0038 FFF7FEFF 		bl	rt_hw_interrupt_disable
 1612              	.LVL211:
 1613 003c 0646     		mov	r6, r0
 1614              	.LVL212:
1176:rt-thread/components/drivers/serial/serial.c ****                 rx_fifo->put_index += 1;
 1615              		.loc 1 1176 0
 1616 003e 2268     		ldr	r2, [r4]
 1617 0040 A388     		ldrh	r3, [r4, #4]
 1618 0042 D754     		strb	r7, [r2, r3]
1177:rt-thread/components/drivers/serial/serial.c ****                 if (rx_fifo->put_index >= serial->config.bufsz) rx_fifo->put_index = 0;
 1619              		.loc 1 1177 0
 1620 0044 A388     		ldrh	r3, [r4, #4]
 1621 0046 0133     		adds	r3, r3, #1
 1622 0048 9BB2     		uxth	r3, r3
 1623 004a A380     		strh	r3, [r4, #4]	@ movhi
1178:rt-thread/components/drivers/serial/serial.c **** 
 1624              		.loc 1 1178 0
 1625 004c 6A6B     		ldr	r2, [r5, #52]
 1626 004e C2F38F22 		ubfx	r2, r2, #10, #16
 1627 0052 9342     		cmp	r3, r2
 1628 0054 E1D3     		bcc	.L156
1178:rt-thread/components/drivers/serial/serial.c **** 
 1629              		.loc 1 1178 0 is_stmt 0 discriminator 1
 1630 0056 0023     		movs	r3, #0
 1631 0058 A380     		strh	r3, [r4, #4]	@ movhi
 1632 005a DEE7     		b	.L156
 1633              	.L167:
1183:rt-thread/components/drivers/serial/serial.c ****                     rx_fifo->is_full = RT_TRUE;
 1634              		.loc 1 1183 0 is_stmt 1
ARM GAS  /tmp/ccebIloK.s 			page 54


 1635 005c 0133     		adds	r3, r3, #1
 1636 005e 9BB2     		uxth	r3, r3
 1637 0060 E380     		strh	r3, [r4, #6]	@ movhi
1184:rt-thread/components/drivers/serial/serial.c ****                     if (rx_fifo->get_index >= serial->config.bufsz) rx_fifo->get_index = 0;
 1638              		.loc 1 1184 0
 1639 0062 0122     		movs	r2, #1
 1640 0064 A260     		str	r2, [r4, #8]
1185:rt-thread/components/drivers/serial/serial.c **** 
 1641              		.loc 1 1185 0
 1642 0066 6A6B     		ldr	r2, [r5, #52]
 1643 0068 C2F38F22 		ubfx	r2, r2, #10, #16
 1644 006c 9342     		cmp	r3, r2
 1645 006e 01D3     		bcc	.L158
1185:rt-thread/components/drivers/serial/serial.c **** 
 1646              		.loc 1 1185 0 is_stmt 0 discriminator 1
 1647 0070 0023     		movs	r3, #0
 1648 0072 E380     		strh	r3, [r4, #6]	@ movhi
 1649              	.L158:
1187:rt-thread/components/drivers/serial/serial.c ****                 }
 1650              		.loc 1 1187 0 is_stmt 1
 1651 0074 FFF7FEFF 		bl	_serial_check_buffer_size
 1652              	.LVL213:
 1653 0078 D3E7     		b	.L157
 1654              	.LVL214:
 1655              	.L155:
1192:rt-thread/components/drivers/serial/serial.c ****             }
1193:rt-thread/components/drivers/serial/serial.c **** 
1194:rt-thread/components/drivers/serial/serial.c ****             /* invoke callback */
1195:rt-thread/components/drivers/serial/serial.c ****             if (serial->parent.rx_indicate != RT_NULL)
 1656              		.loc 1 1195 0
 1657 007a EB69     		ldr	r3, [r5, #28]
 1658 007c BBB1     		cbz	r3, .L148
 1659              	.LBB54:
1196:rt-thread/components/drivers/serial/serial.c ****             {
1197:rt-thread/components/drivers/serial/serial.c ****                 rt_size_t rx_length;
1198:rt-thread/components/drivers/serial/serial.c **** 
1199:rt-thread/components/drivers/serial/serial.c ****                 /* get rx length */
1200:rt-thread/components/drivers/serial/serial.c ****                 level = rt_hw_interrupt_disable();
 1660              		.loc 1 1200 0
 1661 007e FFF7FEFF 		bl	rt_hw_interrupt_disable
 1662              	.LVL215:
1201:rt-thread/components/drivers/serial/serial.c ****                 rx_length = (rx_fifo->put_index >= rx_fifo->get_index)? (rx_fifo->put_index - rx_fi
 1663              		.loc 1 1201 0
 1664 0082 A288     		ldrh	r2, [r4, #4]
 1665 0084 E488     		ldrh	r4, [r4, #6]
 1666              	.LVL216:
 1667 0086 A242     		cmp	r2, r4
 1668 0088 08D3     		bcc	.L160
 1669              		.loc 1 1201 0 is_stmt 0 discriminator 1
 1670 008a 141B     		subs	r4, r2, r4
 1671              	.L161:
 1672              	.LVL217:
1202:rt-thread/components/drivers/serial/serial.c ****                     (serial->config.bufsz - (rx_fifo->get_index - rx_fifo->put_index));
1203:rt-thread/components/drivers/serial/serial.c ****                 rt_hw_interrupt_enable(level);
 1673              		.loc 1 1203 0 is_stmt 1 discriminator 4
 1674 008c FFF7FEFF 		bl	rt_hw_interrupt_enable
 1675              	.LVL218:
ARM GAS  /tmp/ccebIloK.s 			page 55


1204:rt-thread/components/drivers/serial/serial.c **** 
1205:rt-thread/components/drivers/serial/serial.c ****                 if (rx_length)
 1676              		.loc 1 1205 0 discriminator 4
 1677 0090 6CB1     		cbz	r4, .L148
1206:rt-thread/components/drivers/serial/serial.c ****                 {
1207:rt-thread/components/drivers/serial/serial.c ****                     serial->parent.rx_indicate(&serial->parent, rx_length);
 1678              		.loc 1 1207 0
 1679 0092 EB69     		ldr	r3, [r5, #28]
 1680 0094 2146     		mov	r1, r4
 1681 0096 2846     		mov	r0, r5
 1682 0098 9847     		blx	r3
 1683              	.LVL219:
 1684 009a 08E0     		b	.L148
 1685              	.LVL220:
 1686              	.L160:
1202:rt-thread/components/drivers/serial/serial.c ****                 rt_hw_interrupt_enable(level);
 1687              		.loc 1 1202 0 discriminator 2
 1688 009c 6B6B     		ldr	r3, [r5, #52]
 1689 009e C3F38F23 		ubfx	r3, r3, #10, #16
 1690 00a2 A41A     		subs	r4, r4, r2
 1691 00a4 1C1B     		subs	r4, r3, r4
 1692 00a6 F1E7     		b	.L161
 1693              	.LVL221:
 1694              	.L152:
 1695              	.LBE54:
 1696              	.LBE53:
 1697              	.LBB55:
1208:rt-thread/components/drivers/serial/serial.c ****                 }
1209:rt-thread/components/drivers/serial/serial.c ****             }
1210:rt-thread/components/drivers/serial/serial.c ****             break;
1211:rt-thread/components/drivers/serial/serial.c ****         }
1212:rt-thread/components/drivers/serial/serial.c ****         case RT_SERIAL_EVENT_TX_DONE:
1213:rt-thread/components/drivers/serial/serial.c ****         {
1214:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_tx_fifo* tx_fifo;
1215:rt-thread/components/drivers/serial/serial.c **** 
1216:rt-thread/components/drivers/serial/serial.c ****             tx_fifo = (struct rt_serial_tx_fifo*)serial->serial_tx;
1217:rt-thread/components/drivers/serial/serial.c ****             rt_completion_done(&(tx_fifo->completion));
 1698              		.loc 1 1217 0
 1699 00a8 C06B     		ldr	r0, [r0, #60]
 1700              	.LVL222:
 1701 00aa FFF7FEFF 		bl	rt_completion_done
 1702              	.LVL223:
 1703              	.L148:
 1704              	.LBE55:
1218:rt-thread/components/drivers/serial/serial.c ****             break;
1219:rt-thread/components/drivers/serial/serial.c ****         }
1220:rt-thread/components/drivers/serial/serial.c **** #ifdef RT_SERIAL_USING_DMA
1221:rt-thread/components/drivers/serial/serial.c ****         case RT_SERIAL_EVENT_TX_DMADONE:
1222:rt-thread/components/drivers/serial/serial.c ****         {
1223:rt-thread/components/drivers/serial/serial.c ****             const void *data_ptr;
1224:rt-thread/components/drivers/serial/serial.c ****             rt_size_t data_size;
1225:rt-thread/components/drivers/serial/serial.c ****             const void *last_data_ptr;
1226:rt-thread/components/drivers/serial/serial.c ****             struct rt_serial_tx_dma *tx_dma;
1227:rt-thread/components/drivers/serial/serial.c **** 
1228:rt-thread/components/drivers/serial/serial.c ****             tx_dma = (struct rt_serial_tx_dma*) serial->serial_tx;
1229:rt-thread/components/drivers/serial/serial.c **** 
1230:rt-thread/components/drivers/serial/serial.c ****             rt_data_queue_pop(&(tx_dma->data_queue), &last_data_ptr, &data_size, 0);
ARM GAS  /tmp/ccebIloK.s 			page 56


1231:rt-thread/components/drivers/serial/serial.c ****             if (rt_data_queue_peak(&(tx_dma->data_queue), &data_ptr, &data_size) == RT_EOK)
1232:rt-thread/components/drivers/serial/serial.c ****             {
1233:rt-thread/components/drivers/serial/serial.c ****                 /* transmit next data node */
1234:rt-thread/components/drivers/serial/serial.c ****                 tx_dma->activated = RT_TRUE;
1235:rt-thread/components/drivers/serial/serial.c ****                 serial->ops->dma_transmit(serial, (rt_uint8_t *)data_ptr, data_size, RT_SERIAL_DMA_
1236:rt-thread/components/drivers/serial/serial.c ****             }
1237:rt-thread/components/drivers/serial/serial.c ****             else
1238:rt-thread/components/drivers/serial/serial.c ****             {
1239:rt-thread/components/drivers/serial/serial.c ****                 tx_dma->activated = RT_FALSE;
1240:rt-thread/components/drivers/serial/serial.c ****             }
1241:rt-thread/components/drivers/serial/serial.c **** 
1242:rt-thread/components/drivers/serial/serial.c ****             /* invoke callback */
1243:rt-thread/components/drivers/serial/serial.c ****             if (serial->parent.tx_complete != RT_NULL)
1244:rt-thread/components/drivers/serial/serial.c ****             {
1245:rt-thread/components/drivers/serial/serial.c ****                 serial->parent.tx_complete(&serial->parent, (void*)last_data_ptr);
1246:rt-thread/components/drivers/serial/serial.c ****             }
1247:rt-thread/components/drivers/serial/serial.c ****             break;
1248:rt-thread/components/drivers/serial/serial.c ****         }
1249:rt-thread/components/drivers/serial/serial.c ****         case RT_SERIAL_EVENT_RX_DMADONE:
1250:rt-thread/components/drivers/serial/serial.c ****         {
1251:rt-thread/components/drivers/serial/serial.c ****             int length;
1252:rt-thread/components/drivers/serial/serial.c ****             rt_base_t level;
1253:rt-thread/components/drivers/serial/serial.c **** 
1254:rt-thread/components/drivers/serial/serial.c ****             /* get DMA rx length */
1255:rt-thread/components/drivers/serial/serial.c ****             length = (event & (~0xff)) >> 8;
1256:rt-thread/components/drivers/serial/serial.c **** 
1257:rt-thread/components/drivers/serial/serial.c ****             if (serial->config.bufsz == 0)
1258:rt-thread/components/drivers/serial/serial.c ****             {
1259:rt-thread/components/drivers/serial/serial.c ****                 struct rt_serial_rx_dma* rx_dma;
1260:rt-thread/components/drivers/serial/serial.c **** 
1261:rt-thread/components/drivers/serial/serial.c ****                 rx_dma = (struct rt_serial_rx_dma*) serial->serial_rx;
1262:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(rx_dma != RT_NULL);
1263:rt-thread/components/drivers/serial/serial.c **** 
1264:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(serial->parent.rx_indicate != RT_NULL);
1265:rt-thread/components/drivers/serial/serial.c ****                 serial->parent.rx_indicate(&(serial->parent), length);
1266:rt-thread/components/drivers/serial/serial.c ****                 rx_dma->activated = RT_FALSE;
1267:rt-thread/components/drivers/serial/serial.c ****             }
1268:rt-thread/components/drivers/serial/serial.c ****             else
1269:rt-thread/components/drivers/serial/serial.c ****             {
1270:rt-thread/components/drivers/serial/serial.c ****                 /* disable interrupt */
1271:rt-thread/components/drivers/serial/serial.c ****                 level = rt_hw_interrupt_disable();
1272:rt-thread/components/drivers/serial/serial.c ****                 /* update fifo put index */
1273:rt-thread/components/drivers/serial/serial.c ****                 rt_dma_recv_update_put_index(serial, length);
1274:rt-thread/components/drivers/serial/serial.c ****                 /* calculate received total length */
1275:rt-thread/components/drivers/serial/serial.c ****                 length = rt_dma_calc_recved_len(serial);
1276:rt-thread/components/drivers/serial/serial.c ****                 /* enable interrupt */
1277:rt-thread/components/drivers/serial/serial.c ****                 rt_hw_interrupt_enable(level);
1278:rt-thread/components/drivers/serial/serial.c ****                 /* invoke callback */
1279:rt-thread/components/drivers/serial/serial.c ****                 if (serial->parent.rx_indicate != RT_NULL)
1280:rt-thread/components/drivers/serial/serial.c ****                 {
1281:rt-thread/components/drivers/serial/serial.c ****                     serial->parent.rx_indicate(&(serial->parent), length);
1282:rt-thread/components/drivers/serial/serial.c ****                 }
1283:rt-thread/components/drivers/serial/serial.c ****             }
1284:rt-thread/components/drivers/serial/serial.c ****             break;
1285:rt-thread/components/drivers/serial/serial.c ****         }
1286:rt-thread/components/drivers/serial/serial.c **** #endif /* RT_SERIAL_USING_DMA */
1287:rt-thread/components/drivers/serial/serial.c ****     }
ARM GAS  /tmp/ccebIloK.s 			page 57


1288:rt-thread/components/drivers/serial/serial.c **** }
 1705              		.loc 1 1288 0
 1706 00ae 05B0     		add	sp, sp, #20
 1707              	.LCFI13:
 1708              		.cfi_remember_state
 1709              		.cfi_def_cfa_offset 20
 1710              		@ sp needed
 1711 00b0 F0BD     		pop	{r4, r5, r6, r7, pc}
 1712              	.LVL224:
 1713              	.L154:
 1714              	.LCFI14:
 1715              		.cfi_restore_state
 1716              	.LBB56:
1228:rt-thread/components/drivers/serial/serial.c **** 
 1717              		.loc 1 1228 0
 1718 00b2 C66B     		ldr	r6, [r0, #60]
 1719              	.LVL225:
1230:rt-thread/components/drivers/serial/serial.c ****             if (rt_data_queue_peak(&(tx_dma->data_queue), &data_ptr, &data_size) == RT_EOK)
 1720              		.loc 1 1230 0
 1721 00b4 341D     		adds	r4, r6, #4
 1722 00b6 0023     		movs	r3, #0
 1723 00b8 02AA     		add	r2, sp, #8
 1724 00ba 03A9     		add	r1, sp, #12
 1725              	.LVL226:
 1726 00bc 2046     		mov	r0, r4
 1727              	.LVL227:
 1728 00be FFF7FEFF 		bl	rt_data_queue_pop
 1729              	.LVL228:
1231:rt-thread/components/drivers/serial/serial.c ****             {
 1730              		.loc 1 1231 0
 1731 00c2 02AA     		add	r2, sp, #8
 1732 00c4 01A9     		add	r1, sp, #4
 1733 00c6 2046     		mov	r0, r4
 1734 00c8 FFF7FEFF 		bl	rt_data_queue_peak
 1735              	.LVL229:
 1736 00cc 40B1     		cbz	r0, .L168
1239:rt-thread/components/drivers/serial/serial.c ****             }
 1737              		.loc 1 1239 0
 1738 00ce 0023     		movs	r3, #0
 1739 00d0 3360     		str	r3, [r6]
 1740              	.L163:
1243:rt-thread/components/drivers/serial/serial.c ****             {
 1741              		.loc 1 1243 0
 1742 00d2 2B6A     		ldr	r3, [r5, #32]
 1743 00d4 002B     		cmp	r3, #0
 1744 00d6 EAD0     		beq	.L148
1245:rt-thread/components/drivers/serial/serial.c ****             }
 1745              		.loc 1 1245 0
 1746 00d8 0399     		ldr	r1, [sp, #12]
 1747 00da 2846     		mov	r0, r5
 1748 00dc 9847     		blx	r3
 1749              	.LVL230:
 1750 00de E6E7     		b	.L148
 1751              	.L168:
1234:rt-thread/components/drivers/serial/serial.c ****                 serial->ops->dma_transmit(serial, (rt_uint8_t *)data_ptr, data_size, RT_SERIAL_DMA_
 1752              		.loc 1 1234 0
 1753 00e0 0123     		movs	r3, #1
ARM GAS  /tmp/ccebIloK.s 			page 58


 1754 00e2 3360     		str	r3, [r6]
1235:rt-thread/components/drivers/serial/serial.c ****             }
 1755              		.loc 1 1235 0
 1756 00e4 EB6A     		ldr	r3, [r5, #44]
 1757 00e6 1C69     		ldr	r4, [r3, #16]
 1758 00e8 0223     		movs	r3, #2
 1759 00ea 029A     		ldr	r2, [sp, #8]
 1760 00ec 0199     		ldr	r1, [sp, #4]
 1761 00ee 2846     		mov	r0, r5
 1762 00f0 A047     		blx	r4
 1763              	.LVL231:
 1764 00f2 EEE7     		b	.L163
 1765              	.LVL232:
 1766              	.L153:
 1767              	.LBE56:
 1768              	.LBB57:
1255:rt-thread/components/drivers/serial/serial.c **** 
 1769              		.loc 1 1255 0
 1770 00f4 0C12     		asrs	r4, r1, #8
 1771              	.LVL233:
1257:rt-thread/components/drivers/serial/serial.c ****             {
 1772              		.loc 1 1257 0
 1773 00f6 426B     		ldr	r2, [r0, #52]
 1774 00f8 0F4B     		ldr	r3, .L170
 1775 00fa 1340     		ands	r3, r3, r2
 1776 00fc A3B1     		cbz	r3, .L169
1271:rt-thread/components/drivers/serial/serial.c ****                 /* update fifo put index */
 1777              		.loc 1 1271 0
 1778 00fe FFF7FEFF 		bl	rt_hw_interrupt_disable
 1779              	.LVL234:
 1780 0102 0646     		mov	r6, r0
 1781              	.LVL235:
1273:rt-thread/components/drivers/serial/serial.c ****                 /* calculate received total length */
 1782              		.loc 1 1273 0
 1783 0104 2146     		mov	r1, r4
 1784 0106 2846     		mov	r0, r5
 1785              	.LVL236:
 1786 0108 FFF7FEFF 		bl	rt_dma_recv_update_put_index
 1787              	.LVL237:
1275:rt-thread/components/drivers/serial/serial.c ****                 /* enable interrupt */
 1788              		.loc 1 1275 0
 1789 010c 2846     		mov	r0, r5
 1790 010e FFF7FEFF 		bl	rt_dma_calc_recved_len
 1791              	.LVL238:
 1792 0112 0446     		mov	r4, r0
 1793              	.LVL239:
1277:rt-thread/components/drivers/serial/serial.c ****                 /* invoke callback */
 1794              		.loc 1 1277 0
 1795 0114 3046     		mov	r0, r6
 1796              	.LVL240:
 1797 0116 FFF7FEFF 		bl	rt_hw_interrupt_enable
 1798              	.LVL241:
1279:rt-thread/components/drivers/serial/serial.c ****                 {
 1799              		.loc 1 1279 0
 1800 011a EB69     		ldr	r3, [r5, #28]
 1801 011c 002B     		cmp	r3, #0
 1802 011e C6D0     		beq	.L148
ARM GAS  /tmp/ccebIloK.s 			page 59


1281:rt-thread/components/drivers/serial/serial.c ****                 }
 1803              		.loc 1 1281 0
 1804 0120 2146     		mov	r1, r4
 1805 0122 2846     		mov	r0, r5
 1806 0124 9847     		blx	r3
 1807              	.LVL242:
 1808              	.LBE57:
 1809              		.loc 1 1288 0
 1810 0126 C2E7     		b	.L148
 1811              	.LVL243:
 1812              	.L169:
 1813              	.LBB59:
 1814              	.LBB58:
1261:rt-thread/components/drivers/serial/serial.c ****                 RT_ASSERT(rx_dma != RT_NULL);
 1815              		.loc 1 1261 0
 1816 0128 866B     		ldr	r6, [r0, #56]
 1817              	.LVL244:
1265:rt-thread/components/drivers/serial/serial.c ****                 rx_dma->activated = RT_FALSE;
 1818              		.loc 1 1265 0
 1819 012a C369     		ldr	r3, [r0, #28]
 1820 012c 2146     		mov	r1, r4
 1821              	.LVL245:
 1822 012e 9847     		blx	r3
 1823              	.LVL246:
1266:rt-thread/components/drivers/serial/serial.c ****             }
 1824              		.loc 1 1266 0
 1825 0130 0023     		movs	r3, #0
 1826 0132 3360     		str	r3, [r6]
 1827              	.LBE58:
 1828 0134 BBE7     		b	.L148
 1829              	.L171:
 1830 0136 00BF     		.align	2
 1831              	.L170:
 1832 0138 00FCFF03 		.word	67107840
 1833              	.LBE59:
 1834              		.cfi_endproc
 1835              	.LFE37:
 1837              		.section	.bss.already_output.7187,"aw",%nobits
 1838              		.align	2
 1839              		.set	.LANCHOR0,. + 0
 1842              	already_output.7187:
 1843 0000 00000000 		.space	4
 1844              		.section	.rodata.serial_ops,"a",%progbits
 1845              		.align	2
 1846              		.set	.LANCHOR1,. + 0
 1849              	serial_ops:
 1850 0000 00000000 		.word	rt_serial_init
 1851 0004 00000000 		.word	rt_serial_open
 1852 0008 00000000 		.word	rt_serial_close
 1853 000c 00000000 		.word	rt_serial_read
 1854 0010 00000000 		.word	rt_serial_write
 1855 0014 00000000 		.word	rt_serial_control
 1856              		.text
 1857              	.Letext0:
 1858              		.file 2 "rt-thread/include/rtdef.h"
 1859              		.file 3 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/lock.h"
 1860              		.file 4 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/_types.h"
ARM GAS  /tmp/ccebIloK.s 			page 60


 1861              		.file 5 "/opt/gcc-arm-none-eabi-6-2017-q2-update/lib/gcc/arm-none-eabi/6.3.1/include/stddef.h"
 1862              		.file 6 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/reent.h"
 1863              		.file 7 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/time.h"
 1864              		.file 8 "/opt/gcc-arm-none-eabi-6-2017-q2-update/arm-none-eabi/include/sys/errno.h"
 1865              		.file 9 "rt-thread/components/finsh/finsh_api.h"
 1866              		.file 10 "rt-thread/components/drivers/include/ipc/completion.h"
 1867              		.file 11 "rt-thread/components/drivers/include/ipc/dataqueue.h"
 1868              		.file 12 "rt-thread/components/drivers/include/drivers/serial.h"
 1869              		.file 13 "rt-thread/include/rthw.h"
 1870              		.file 14 "rt-thread/include/rtthread.h"
ARM GAS  /tmp/ccebIloK.s 			page 61


DEFINED SYMBOLS
                            *ABS*:0000000000000000 serial.c
     /tmp/ccebIloK.s:18     .text._serial_check_buffer_size:0000000000000000 $t
     /tmp/ccebIloK.s:24     .text._serial_check_buffer_size:0000000000000000 _serial_check_buffer_size
     /tmp/ccebIloK.s:45     .text._serial_check_buffer_size:0000000000000010 $d
     /tmp/ccebIloK.s:50     .text._serial_fifo_calc_recved_len:0000000000000000 $t
     /tmp/ccebIloK.s:56     .text._serial_fifo_calc_recved_len:0000000000000000 _serial_fifo_calc_recved_len
     /tmp/ccebIloK.s:109    .text.rt_dma_calc_recved_len:0000000000000000 $t
     /tmp/ccebIloK.s:115    .text.rt_dma_calc_recved_len:0000000000000000 rt_dma_calc_recved_len
     /tmp/ccebIloK.s:136    .text.rt_dma_recv_update_get_index:0000000000000000 $t
     /tmp/ccebIloK.s:142    .text.rt_dma_recv_update_get_index:0000000000000000 rt_dma_recv_update_get_index
     /tmp/ccebIloK.s:184    .text.rt_dma_recv_update_put_index:0000000000000000 $t
     /tmp/ccebIloK.s:190    .text.rt_dma_recv_update_put_index:0000000000000000 rt_dma_recv_update_put_index
     /tmp/ccebIloK.s:278    .text.rt_serial_init:0000000000000000 $t
     /tmp/ccebIloK.s:284    .text.rt_serial_init:0000000000000000 rt_serial_init
     /tmp/ccebIloK.s:322    .text.rt_serial_control:0000000000000000 $t
     /tmp/ccebIloK.s:328    .text.rt_serial_control:0000000000000000 rt_serial_control
     /tmp/ccebIloK.s:446    .text.rt_serial_write:0000000000000000 $t
     /tmp/ccebIloK.s:452    .text.rt_serial_write:0000000000000000 rt_serial_write
     /tmp/ccebIloK.s:648    .text.rt_serial_read:0000000000000000 $t
     /tmp/ccebIloK.s:654    .text.rt_serial_read:0000000000000000 rt_serial_read
     /tmp/ccebIloK.s:967    .text.rt_serial_read:0000000000000144 $d
     /tmp/ccebIloK.s:972    .text.rt_serial_close:0000000000000000 $t
     /tmp/ccebIloK.s:978    .text.rt_serial_close:0000000000000000 rt_serial_close
     /tmp/ccebIloK.s:1127   .text.rt_serial_close:00000000000000b8 $d
     /tmp/ccebIloK.s:1133   .text.rt_serial_open:0000000000000000 $t
     /tmp/ccebIloK.s:1139   .text.rt_serial_open:0000000000000000 rt_serial_open
     /tmp/ccebIloK.s:1486   .text.rt_serial_open:00000000000001e8 $d
     /tmp/ccebIloK.s:1491   .text.rt_hw_serial_register:0000000000000000 $t
     /tmp/ccebIloK.s:1498   .text.rt_hw_serial_register:0000000000000000 rt_hw_serial_register
     /tmp/ccebIloK.s:1535   .text.rt_hw_serial_register:0000000000000018 $d
     /tmp/ccebIloK.s:1540   .text.rt_hw_serial_isr:0000000000000000 $t
     /tmp/ccebIloK.s:1547   .text.rt_hw_serial_isr:0000000000000000 rt_hw_serial_isr
     /tmp/ccebIloK.s:1573   .text.rt_hw_serial_isr:0000000000000012 $d
     /tmp/ccebIloK.s:1577   .text.rt_hw_serial_isr:0000000000000016 $t
     /tmp/ccebIloK.s:1832   .text.rt_hw_serial_isr:0000000000000138 $d
     /tmp/ccebIloK.s:1838   .bss.already_output.7187:0000000000000000 $d
     /tmp/ccebIloK.s:1842   .bss.already_output.7187:0000000000000000 already_output.7187
     /tmp/ccebIloK.s:1845   .rodata.serial_ops:0000000000000000 $d
     /tmp/ccebIloK.s:1849   .rodata.serial_ops:0000000000000000 serial_ops
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
rt_completion_wait
rt_data_queue_push
rt_hw_interrupt_disable
rt_hw_interrupt_enable
rt_set_errno
rt_memcpy
rt_free
rt_malloc
rt_memset
rt_completion_init
rt_data_queue_init
rt_device_register
rt_completion_done
rt_data_queue_pop
ARM GAS  /tmp/ccebIloK.s 			page 62


rt_data_queue_peak
